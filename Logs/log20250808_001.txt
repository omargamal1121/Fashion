2025-08-08 03:51:43.850 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:51:43.961 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:51:44.005 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 03:51:44.031 +03:00 [INF] Applying migration '20250808005123_add-webhook'.
2025-08-08 03:51:44.446 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PaymentProviders` DROP FOREIGN KEY `FK_PaymentProviders_PaymentMethods_PaymentMethodId`;
2025-08-08 03:51:44.466 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PaymentProviders` DROP INDEX `IX_PaymentProviders_PaymentMethodId`;
2025-08-08 03:51:44.476 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PaymentProviders` DROP COLUMN `IsActive`;
2025-08-08 03:51:44.483 +03:00 [ERR] Failed executing DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PaymentProviders` RENAME COLUMN `PaymentMethodId` TO `Provider`;
2025-08-08 03:53:15.432 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:53:15.528 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:53:15.559 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 03:53:15.582 +03:00 [INF] Applying migration '20250808005123_add-webhook'.
2025-08-08 03:53:15.815 +03:00 [ERR] Failed executing DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PaymentProviders` DROP FOREIGN KEY `FK_PaymentProviders_PaymentMethods_PaymentMethodId`;
2025-08-08 03:53:45.005 +03:00 [INF] Executed DbCommand (506ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP DATABASE `Fashion_Site`;
2025-08-08 03:54:38.880 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE `Fashion_Site`;
2025-08-08 03:54:39.277 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `__EFMigrationsHistory` (
    `MigrationId` varchar(150) CHARACTER SET utf8mb4 NOT NULL,
    `ProductVersion` varchar(32) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK___EFMigrationsHistory` PRIMARY KEY (`MigrationId`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.305 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:54:39.311 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 03:54:39.333 +03:00 [INF] Applying migration '20250808005421_intial'.
2025-08-08 03:54:39.610 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER DATABASE CHARACTER SET utf8mb4;
2025-08-08 03:54:39.624 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetRoles` (
    `Id` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Name` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `ConcurrencyStamp` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetRoles` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.638 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Collections` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NULL,
    `DisplayOrder` int NOT NULL,
    `IsActive` tinyint(1) NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Collections` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.651 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `PaymentProviders` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `ApiEndpoint` varchar(100) CHARACTER SET utf8mb4 NOT NULL,
    `PublicKey` varchar(200) CHARACTER SET utf8mb4 NULL,
    `PrivateKey` varchar(200) CHARACTER SET utf8mb4 NULL,
    `Provider` int NOT NULL,
    `Hmac` longtext CHARACTER SET utf8mb4 NULL,
    `IframeId` longtext CHARACTER SET utf8mb4 NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_PaymentProviders` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.666 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Warehouses` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `Address` varchar(200) CHARACTER SET utf8mb4 NOT NULL,
    `Phone` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `Email` varchar(100) CHARACTER SET utf8mb4 NULL,
    `Description` varchar(500) CHARACTER SET utf8mb4 NULL,
    `IsActive` tinyint(1) NOT NULL,
    `ManagerName` longtext CHARACTER SET utf8mb4 NULL,
    `ManagerPhone` longtext CHARACTER SET utf8mb4 NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Warehouses` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.700 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetRoleClaims` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `RoleId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ClaimType` longtext CHARACTER SET utf8mb4 NULL,
    `ClaimValue` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetRoleClaims` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_AspNetRoleClaims_AspNetRoles_RoleId` FOREIGN KEY (`RoleId`) REFERENCES `AspNetRoles` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.732 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `PaymentMethods` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `Method` int NOT NULL,
    `PaymentProviderId` int NOT NULL,
    `IsActive` tinyint(1) NOT NULL,
    `IntegrationId` longtext CHARACTER SET utf8mb4 NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_PaymentMethods` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_PaymentMethods_PaymentProviders_PaymentProviderId` FOREIGN KEY (`PaymentProviderId`) REFERENCES `PaymentProviders` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.744 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `adminOperationsLogs` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `AdminId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `OperationType` int NOT NULL,
    `ItemId` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Timestamp` datetime(6) NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_adminOperationsLogs` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.820 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserClaims` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ClaimType` longtext CHARACTER SET utf8mb4 NULL,
    `ClaimValue` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetUserClaims` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.832 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserLogins` (
    `LoginProvider` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ProviderKey` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ProviderDisplayName` longtext CHARACTER SET utf8mb4 NULL,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_AspNetUserLogins` PRIMARY KEY (`LoginProvider`, `ProviderKey`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.864 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserRoles` (
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `RoleId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_AspNetUserRoles` PRIMARY KEY (`UserId`, `RoleId`),
    CONSTRAINT `FK_AspNetUserRoles_AspNetRoles_RoleId` FOREIGN KEY (`RoleId`) REFERENCES `AspNetRoles` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.876 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUsers` (
    `Id` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Discriminator` varchar(13) CHARACTER SET utf8mb4 NOT NULL,
    `Name` longtext CHARACTER SET utf8mb4 NULL,
    `Age` int NULL,
    `ProfilePicture` longtext CHARACTER SET utf8mb4 NULL,
    `CreateAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    `LastVisit` datetime(6) NULL,
    `ImageId` int NULL,
    `UserName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedUserName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `Email` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedEmail` varchar(256) CHARACTER SET utf8mb4 NULL,
    `EmailConfirmed` tinyint(1) NOT NULL,
    `PasswordHash` longtext CHARACTER SET utf8mb4 NULL,
    `SecurityStamp` longtext CHARACTER SET utf8mb4 NULL,
    `ConcurrencyStamp` longtext CHARACTER SET utf8mb4 NULL,
    `PhoneNumber` longtext CHARACTER SET utf8mb4 NULL,
    `PhoneNumberConfirmed` tinyint(1) NOT NULL,
    `TwoFactorEnabled` tinyint(1) NOT NULL,
    `LockoutEnd` datetime(6) NULL,
    `LockoutEnabled` tinyint(1) NOT NULL,
    `AccessFailedCount` int NOT NULL,
    CONSTRAINT `PK_AspNetUsers` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.889 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserTokens` (
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `LoginProvider` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Name` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Value` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetUserTokens` PRIMARY KEY (`UserId`, `LoginProvider`, `Name`),
    CONSTRAINT `FK_AspNetUserTokens_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:39.924 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Cart` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `UserId` longtext CHARACTER SET utf8mb4 NOT NULL,
    `CustomerId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `CheckoutDate` datetime(6) NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Cart` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Cart_AspNetUsers_CustomerId` FOREIGN KEY (`CustomerId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:42.576 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `CustomerAddresses` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `CustomerId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `PhoneNumber` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `Country` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `State` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `City` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `StreetAddress` varchar(200) CHARACTER SET utf8mb4 NOT NULL,
    `PostalCode` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `AddressType` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `IsDefault` tinyint(1) NOT NULL,
    `AdditionalNotes` varchar(500) CHARACTER SET utf8mb4 NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_CustomerAddresses` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_CustomerAddresses_AspNetUsers_CustomerId` FOREIGN KEY (`CustomerId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:42.610 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `userOperationsLogs` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `OperationType` int NOT NULL,
    `ItemId` int NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Timestamp` datetime(6) NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_userOperationsLogs` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_userOperationsLogs_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:42.642 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Orders` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `CustomerId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `CustomerAddressId` int NOT NULL,
    `OrderNumber` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `Status` int NOT NULL,
    `Subtotal` decimal(18,2) NOT NULL,
    `TaxAmount` decimal(18,2) NOT NULL,
    `ShippingCost` decimal(18,2) NOT NULL,
    `DiscountAmount` decimal(18,2) NOT NULL,
    `Total` decimal(18,2) NOT NULL,
    `Notes` varchar(500) CHARACTER SET utf8mb4 NULL,
    `ShippedAt` datetime(6) NULL,
    `DeliveredAt` datetime(6) NULL,
    `CancelledAt` datetime(6) NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Orders` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Orders_AspNetUsers_CustomerId` FOREIGN KEY (`CustomerId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_Orders_CustomerAddresses_CustomerAddressId` FOREIGN KEY (`CustomerAddressId`) REFERENCES `CustomerAddresses` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:42.679 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Payments` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `CustomerId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `PaymentMethodId` int NOT NULL,
    `PaymentProviderId` int NOT NULL,
    `Amount` decimal(18,2) NOT NULL,
    `PaymentDate` datetime(6) NOT NULL,
    `OrderId` int NOT NULL,
    `Status` int NOT NULL,
    `TransactionId` varchar(100) CHARACTER SET utf8mb4 NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Payments` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Payments_AspNetUsers_CustomerId` FOREIGN KEY (`CustomerId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_Payments_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `Orders` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_Payments_PaymentMethods_PaymentMethodId` FOREIGN KEY (`PaymentMethodId`) REFERENCES `PaymentMethods` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_Payments_PaymentProviders_PaymentProviderId` FOREIGN KEY (`PaymentProviderId`) REFERENCES `PaymentProviders` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:45.245 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ReturnRequests` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `OrderId` int NOT NULL,
    `CustomerId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `RequestDate` datetime(6) NOT NULL,
    `Status` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Reason` longtext CHARACTER SET utf8mb4 NOT NULL,
    `AdminComment` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_ReturnRequests` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_ReturnRequests_AspNetUsers_CustomerId` FOREIGN KEY (`CustomerId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_ReturnRequests_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `Orders` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:45.277 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `PaymentWebhooks` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `TransactionId` bigint NOT NULL,
    `OrderId` int NOT NULL,
    `PaymentId` int NULL,
    `PaymentMethod` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `Success` tinyint(1) NOT NULL,
    `Status` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `AmountCents` decimal(18,2) NOT NULL,
    `Currency` varchar(10) CHARACTER SET utf8mb4 NOT NULL,
    `SourceSubType` varchar(50) CHARACTER SET utf8mb4 NULL,
    `SourceIssuer` varchar(100) CHARACTER SET utf8mb4 NULL,
    `CardLast4` varchar(20) CHARACTER SET utf8mb4 NULL,
    `PaymentProvider` varchar(50) CHARACTER SET utf8mb4 NULL,
    `ProviderOrderId` varchar(100) CHARACTER SET utf8mb4 NULL,
    `RawData` varchar(500) CHARACTER SET utf8mb4 NULL,
    `HmacVerified` tinyint(1) NOT NULL,
    `ErrorMessage` varchar(500) CHARACTER SET utf8mb4 NULL,
    `AuthorizationCode` varchar(100) CHARACTER SET utf8mb4 NULL,
    `ReceiptNumber` varchar(100) CHARACTER SET utf8mb4 NULL,
    `Is3DSecure` tinyint(1) NULL,
    `IsCapture` tinyint(1) NULL,
    `IsVoided` tinyint(1) NULL,
    `IsRefunded` tinyint(1) NULL,
    `IntegrationId` varchar(50) CHARACTER SET utf8mb4 NULL,
    `ProfileId` varchar(50) CHARACTER SET utf8mb4 NULL,
    `ProcessedAt` datetime(6) NULL,
    `RetryCount` int NOT NULL,
    `WebhookUniqueKey` varchar(100) CHARACTER SET utf8mb4 NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_PaymentWebhooks` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `Orders` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_PaymentWebhooks_Payments_PaymentId` FOREIGN KEY (`PaymentId`) REFERENCES `Payments` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:45.308 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `CartItems` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `CartId` int NOT NULL,
    `ProductId` int NOT NULL,
    `ProductVariantId` int NULL,
    `Quantity` int NOT NULL,
    `UnitPrice` decimal(18,2) NOT NULL,
    `AddedAt` datetime(6) NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_CartItems` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_CartItems_Cart_CartId` FOREIGN KEY (`CartId`) REFERENCES `Cart` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:45.322 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Categories` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `Description` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `DisplayOrder` int NOT NULL,
    `IsActive` tinyint(1) NOT NULL,
    `ImageId` int NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Categories` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:48.095 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Discount` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `Description` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `DiscountPercent` decimal(18,2) NOT NULL,
    `StartDate` datetime(6) NOT NULL,
    `EndDate` datetime(6) NOT NULL,
    `IsActive` tinyint(1) NOT NULL,
    `CategoryId` int NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Discount` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Discount_Categories_CategoryId` FOREIGN KEY (`CategoryId`) REFERENCES `Categories` (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:48.130 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Images` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Url` longtext CHARACTER SET utf8mb4 NOT NULL,
    `AltText` longtext CHARACTER SET utf8mb4 NULL,
    `Title` longtext CHARACTER SET utf8mb4 NULL,
    `Width` int NULL,
    `Height` int NULL,
    `FileSize` bigint NULL,
    `UploadDate` datetime(6) NOT NULL,
    `CustomerId` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Folder` longtext CHARACTER SET utf8mb4 NULL,
    `IsMain` tinyint(1) NOT NULL,
    `FileType` longtext CHARACTER SET utf8mb4 NULL,
    `CategoryId` int NULL,
    `SubCategoryId` int NULL,
    `ProductId` int NULL,
    `CollectionId` int NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Images` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Images_Categories_CategoryId` FOREIGN KEY (`CategoryId`) REFERENCES `Categories` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_Images_Collections_CollectionId` FOREIGN KEY (`CollectionId`) REFERENCES `Collections` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:48.161 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `SubCategories` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `CategoryId` int NOT NULL,
    `IsActive` tinyint(1) NOT NULL,
    `ImageId` int NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_SubCategories` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_SubCategories_Categories_CategoryId` FOREIGN KEY (`CategoryId`) REFERENCES `Categories` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_SubCategories_Images_ImageId` FOREIGN KEY (`ImageId`) REFERENCES `Images` (`Id`)
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:48.195 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Products` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` varchar(20) CHARACTER SET utf8mb4 NOT NULL,
    `Description` varchar(50) CHARACTER SET utf8mb4 NOT NULL,
    `SubCategoryId` int NOT NULL,
    `Quantity` int NOT NULL,
    `DiscountId` int NULL,
    `Price` decimal(18,2) NOT NULL,
    `fitType` int NOT NULL,
    `Gender` int NOT NULL,
    `IsActive` tinyint(1) NOT NULL,
    `ImageId` int NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_Products` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Products_Discount_DiscountId` FOREIGN KEY (`DiscountId`) REFERENCES `Discount` (`Id`) ON DELETE SET NULL,
    CONSTRAINT `FK_Products_Images_ImageId` FOREIGN KEY (`ImageId`) REFERENCES `Images` (`Id`),
    CONSTRAINT `FK_Products_SubCategories_SubCategoryId` FOREIGN KEY (`SubCategoryId`) REFERENCES `SubCategories` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:50.719 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Items` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `OrderId` int NOT NULL,
    `ProductId` int NOT NULL,
    `Quantity` int NOT NULL,
    `AddedAt` datetime(6) NOT NULL,
    CONSTRAINT `PK_Items` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Items_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `Orders` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_Items_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:50.753 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ProductCollections` (
    `ProductId` int NOT NULL,
    `CollectionId` int NOT NULL,
    `Id` int NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_ProductCollections` PRIMARY KEY (`ProductId`, `CollectionId`),
    CONSTRAINT `FK_ProductCollections_Collections_CollectionId` FOREIGN KEY (`CollectionId`) REFERENCES `Collections` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_ProductCollections_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:50.778 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ProductInventory` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `ProductId` int NOT NULL,
    `WarehouseId` int NOT NULL,
    `Quantity` int NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_ProductInventory` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_ProductInventory_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_ProductInventory_Warehouses_WarehouseId` FOREIGN KEY (`WarehouseId`) REFERENCES `Warehouses` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:50.808 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ProductVariants` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Color` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Size` int NULL,
    `Waist` int NULL,
    `Length` int NULL,
    `Quantity` int NOT NULL,
    `ProductId` int NOT NULL,
    `IsActive` tinyint(1) NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_ProductVariants` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_ProductVariants_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:50.840 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ReturnRequestProducts` (
    `ReturnRequestId` int NOT NULL,
    `ProductId` int NOT NULL,
    `Quantity` int NOT NULL,
    CONSTRAINT `PK_ReturnRequestProducts` PRIMARY KEY (`ReturnRequestId`, `ProductId`),
    CONSTRAINT `FK_ReturnRequestProducts_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_ReturnRequestProducts_ReturnRequests_ReturnRequestId` FOREIGN KEY (`ReturnRequestId`) REFERENCES `ReturnRequests` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:50.867 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Reviews` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `ProductId` int NOT NULL,
    `CustomerId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Rating` int NOT NULL,
    `Comment` varchar(1000) CHARACTER SET utf8mb4 NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    CONSTRAINT `PK_Reviews` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Reviews_AspNetUsers_CustomerId` FOREIGN KEY (`CustomerId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_Reviews_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:53.772 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `WishlistItems` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `ProductId` int NOT NULL,
    `CustomerId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_WishlistItems` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_WishlistItems_AspNetUsers_CustomerId` FOREIGN KEY (`CustomerId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_WishlistItems_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:53.807 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `OrderItem` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `OrderId` int NOT NULL,
    `ProductId` int NOT NULL,
    `ProductVariantId` int NOT NULL,
    `Quantity` int NOT NULL,
    `UnitPrice` decimal(18,2) NOT NULL,
    `TotalPrice` decimal(18,2) NOT NULL,
    `OrderedAt` datetime(6) NOT NULL,
    `CreatedAt` datetime(6) NULL,
    `ModifiedAt` datetime(6) NULL,
    `DeletedAt` datetime(6) NULL,
    CONSTRAINT `PK_OrderItem` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_OrderItem_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `Orders` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_OrderItem_ProductVariants_ProductVariantId` FOREIGN KEY (`ProductVariantId`) REFERENCES `ProductVariants` (`Id`) ON DELETE RESTRICT,
    CONSTRAINT `FK_OrderItem_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE RESTRICT
) CHARACTER SET=utf8mb4;
2025-08-08 03:54:53.822 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_adminOperationsLogs_AdminId` ON `adminOperationsLogs` (`AdminId`);
2025-08-08 03:54:53.842 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetRoleClaims_RoleId` ON `AspNetRoleClaims` (`RoleId`);
2025-08-08 03:54:53.858 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `RoleNameIndex` ON `AspNetRoles` (`NormalizedName`);
2025-08-08 03:54:53.877 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserClaims_UserId` ON `AspNetUserClaims` (`UserId`);
2025-08-08 03:54:53.893 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserLogins_UserId` ON `AspNetUserLogins` (`UserId`);
2025-08-08 03:54:53.912 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserRoles_RoleId` ON `AspNetUserRoles` (`RoleId`);
2025-08-08 03:54:53.929 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `EmailIndex` ON `AspNetUsers` (`NormalizedEmail`);
2025-08-08 03:54:53.945 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUsers_ImageId` ON `AspNetUsers` (`ImageId`);
2025-08-08 03:54:53.959 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `UserNameIndex` ON `AspNetUsers` (`NormalizedUserName`);
2025-08-08 03:54:53.979 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Cart_CustomerId` ON `Cart` (`CustomerId`);
2025-08-08 03:54:53.997 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_CartItems_CartId` ON `CartItems` (`CartId`);
2025-08-08 03:54:54.008 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_CartItems_ProductId` ON `CartItems` (`ProductId`);
2025-08-08 03:54:54.019 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_CartItems_ProductVariantId` ON `CartItems` (`ProductVariantId`);
2025-08-08 03:54:54.033 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Categories_ImageId` ON `Categories` (`ImageId`);
2025-08-08 03:54:54.064 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_CustomerAddresses_CustomerId` ON `CustomerAddresses` (`CustomerId`);
2025-08-08 03:54:56.248 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Discount_CategoryId` ON `Discount` (`CategoryId`);
2025-08-08 03:54:56.266 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Images_CategoryId` ON `Images` (`CategoryId`);
2025-08-08 03:54:56.285 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Images_CollectionId` ON `Images` (`CollectionId`);
2025-08-08 03:54:56.295 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Images_ProductId` ON `Images` (`ProductId`);
2025-08-08 03:54:56.307 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Images_SubCategoryId` ON `Images` (`SubCategoryId`);
2025-08-08 03:54:56.324 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Items_OrderId` ON `Items` (`OrderId`);
2025-08-08 03:54:56.337 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Items_ProductId` ON `Items` (`ProductId`);
2025-08-08 03:54:56.354 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_OrderItem_OrderId` ON `OrderItem` (`OrderId`);
2025-08-08 03:54:56.368 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_OrderItem_ProductId` ON `OrderItem` (`ProductId`);
2025-08-08 03:54:56.381 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_OrderItem_ProductVariantId` ON `OrderItem` (`ProductVariantId`);
2025-08-08 03:54:56.401 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Orders_CustomerAddressId` ON `Orders` (`CustomerAddressId`);
2025-08-08 03:54:56.417 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Orders_CustomerId` ON `Orders` (`CustomerId`);
2025-08-08 03:54:56.437 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_PaymentMethods_PaymentProviderId` ON `PaymentMethods` (`PaymentProviderId`);
2025-08-08 03:54:56.457 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Payments_CustomerId` ON `Payments` (`CustomerId`);
2025-08-08 03:54:56.477 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `IX_Payments_OrderId` ON `Payments` (`OrderId`);
2025-08-08 03:54:56.494 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Payments_PaymentMethodId` ON `Payments` (`PaymentMethodId`);
2025-08-08 03:54:56.509 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Payments_PaymentProviderId` ON `Payments` (`PaymentProviderId`);
2025-08-08 03:54:56.526 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_PaymentWebhooks_OrderId` ON `PaymentWebhooks` (`OrderId`);
2025-08-08 03:54:56.541 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_PaymentWebhooks_PaymentId` ON `PaymentWebhooks` (`PaymentId`);
2025-08-08 03:54:56.557 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ProductCollections_CollectionId` ON `ProductCollections` (`CollectionId`);
2025-08-08 03:54:56.573 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ProductInventory_ProductId` ON `ProductInventory` (`ProductId`);
2025-08-08 03:54:56.588 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ProductInventory_WarehouseId` ON `ProductInventory` (`WarehouseId`);
2025-08-08 03:54:56.606 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Products_DiscountId` ON `Products` (`DiscountId`);
2025-08-08 03:54:58.269 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Products_ImageId` ON `Products` (`ImageId`);
2025-08-08 03:54:58.307 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Products_SubCategoryId` ON `Products` (`SubCategoryId`);
2025-08-08 03:54:58.326 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ProductVariants_ProductId` ON `ProductVariants` (`ProductId`);
2025-08-08 03:54:58.346 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ReturnRequestProducts_ProductId` ON `ReturnRequestProducts` (`ProductId`);
2025-08-08 03:54:58.367 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ReturnRequests_CustomerId` ON `ReturnRequests` (`CustomerId`);
2025-08-08 03:54:58.383 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ReturnRequests_OrderId` ON `ReturnRequests` (`OrderId`);
2025-08-08 03:54:58.402 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Reviews_CustomerId` ON `Reviews` (`CustomerId`);
2025-08-08 03:54:58.417 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Reviews_ProductId` ON `Reviews` (`ProductId`);
2025-08-08 03:54:58.437 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_SubCategories_CategoryId` ON `SubCategories` (`CategoryId`);
2025-08-08 03:54:58.453 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_SubCategories_ImageId` ON `SubCategories` (`ImageId`);
2025-08-08 03:54:58.475 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_userOperationsLogs_UserId` ON `userOperationsLogs` (`UserId`);
2025-08-08 03:54:58.498 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_WishlistItems_CustomerId` ON `WishlistItems` (`CustomerId`);
2025-08-08 03:54:58.514 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_WishlistItems_ProductId` ON `WishlistItems` (`ProductId`);
2025-08-08 03:54:58.576 +03:00 [INF] Executed DbCommand (62ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `adminOperationsLogs` ADD CONSTRAINT `FK_adminOperationsLogs_AspNetUsers_AdminId` FOREIGN KEY (`AdminId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE RESTRICT;
2025-08-08 03:54:58.634 +03:00 [INF] Executed DbCommand (57ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUserClaims` ADD CONSTRAINT `FK_AspNetUserClaims_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE;
2025-08-08 03:54:58.687 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUserLogins` ADD CONSTRAINT `FK_AspNetUserLogins_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE;
2025-08-08 03:54:58.771 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUserRoles` ADD CONSTRAINT `FK_AspNetUserRoles_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE;
2025-08-08 03:54:58.834 +03:00 [INF] Executed DbCommand (63ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` ADD CONSTRAINT `FK_AspNetUsers_Images_ImageId` FOREIGN KEY (`ImageId`) REFERENCES `Images` (`Id`) ON DELETE CASCADE;
2025-08-08 03:54:58.893 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `CartItems` ADD CONSTRAINT `FK_CartItems_ProductVariants_ProductVariantId` FOREIGN KEY (`ProductVariantId`) REFERENCES `ProductVariants` (`Id`) ON DELETE SET NULL;
2025-08-08 03:54:58.948 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `CartItems` ADD CONSTRAINT `FK_CartItems_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE RESTRICT;
2025-08-08 03:55:00.001 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Categories` ADD CONSTRAINT `FK_Categories_Images_ImageId` FOREIGN KEY (`ImageId`) REFERENCES `Images` (`Id`);
2025-08-08 03:55:00.071 +03:00 [INF] Executed DbCommand (69ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Images` ADD CONSTRAINT `FK_Images_Products_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `Products` (`Id`) ON DELETE RESTRICT;
2025-08-08 03:55:00.137 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Images` ADD CONSTRAINT `FK_Images_SubCategories_SubCategoryId` FOREIGN KEY (`SubCategoryId`) REFERENCES `SubCategories` (`Id`) ON DELETE CASCADE;
2025-08-08 03:55:00.143 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20250808005421_intial', '8.0.13');
2025-08-08 03:55:10.983 +03:00 [INF] Start installing Hangfire SQL objects...
2025-08-08 03:55:11.402 +03:00 [INF] Hangfire SQL objects installed.
2025-08-08 03:55:13.388 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:55:13.407 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:55:13.437 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 03:55:13.460 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 03:55:13.506 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 03:55:13.962 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 03:55:13.997 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 03:55:14.212 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (Size = 4000), @p2='?' (Size = 256), @p3='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `AspNetRoles` (`Id`, `ConcurrencyStamp`, `Name`, `NormalizedName`)
VALUES (@p0, @p1, @p2, @p3);
2025-08-08 03:55:14.234 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 03:55:14.241 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 03:55:14.252 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (Size = 4000), @p2='?' (Size = 256), @p3='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `AspNetRoles` (`Id`, `ConcurrencyStamp`, `Name`, `NormalizedName`)
VALUES (@p0, @p1, @p2, @p3);
2025-08-08 03:55:14.287 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 03:55:14.413 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-08 03:55:14.426 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 03:55:14.634 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (Size = 13), @p7='?' (Size = 256), @p8='?' (DbType = Boolean), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (Size = 4000), @p21='?' (DbType = Boolean), @p22='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `AspNetUsers` (`Id`, `AccessFailedCount`, `Age`, `ConcurrencyStamp`, `CreateAt`, `DeletedAt`, `Discriminator`, `Email`, `EmailConfirmed`, `ImageId`, `LastVisit`, `LockoutEnabled`, `LockoutEnd`, `Name`, `NormalizedEmail`, `NormalizedUserName`, `PasswordHash`, `PhoneNumber`, `PhoneNumberConfirmed`, `ProfilePicture`, `SecurityStamp`, `TwoFactorEnabled`, `UserName`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22);
2025-08-08 03:55:14.653 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-08-08 03:55:14.704 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255), @__p_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`UserId`, `a`.`RoleId`
FROM `AspNetUserRoles` AS `a`
WHERE (`a`.`UserId` = @__p_0) AND (`a`.`RoleId` = @__p_1)
LIMIT 1
2025-08-08 03:55:14.715 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-08-08 03:55:14.740 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-08 03:55:14.750 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 03:55:14.809 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (Size = 255), @p23='?' (Size = 255), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Size = 4000), @p24='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = DateTime), @p7='?' (Size = 256), @p8='?' (DbType = Boolean), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (Size = 4000), @p21='?' (DbType = Boolean), @p22='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetUserRoles` (`RoleId`, `UserId`)
VALUES (@p0, @p1);
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p2, `Age` = @p3, `ConcurrencyStamp` = @p4, `CreateAt` = @p5, `DeletedAt` = @p6, `Email` = @p7, `EmailConfirmed` = @p8, `ImageId` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `ProfilePicture` = @p19, `SecurityStamp` = @p20, `TwoFactorEnabled` = @p21, `UserName` = @p22
WHERE `Id` = @p23 AND `ConcurrencyStamp` = @p24;
SELECT ROW_COUNT();
2025-08-08 03:55:15.545 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 03:55:15.676 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 03:55:15.765 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 03:55:15.767 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 03:55:15.773 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 03:55:15.774 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 03:55:15.803 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 03:55:15.815 +03:00 [INF] Hosting environment: Development
2025-08-08 03:55:15.820 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 03:55:15.832 +03:00 [INF] Server mrrobot:24200:bd6573d7 successfully announced in 26.9505 ms
2025-08-08 03:55:15.839 +03:00 [INF] Server mrrobot:24200:bd6573d7 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 03:55:15.917 +03:00 [INF] Server mrrobot:24200:bd6573d7 all the dispatchers started
2025-08-08 03:55:16.720 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 03:55:17.013 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 294.4532ms
2025-08-08 03:55:17.116 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 03:55:17.128 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 03:55:17.176 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 03:55:17.182 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 66.2261ms
2025-08-08 03:55:17.198 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 22.2435ms
2025-08-08 03:55:17.278 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 150.023ms
2025-08-08 03:55:17.379 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 03:55:17.589 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce). See inner exception
 ---> Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate schema for type - E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodDto]]. See inner exception
 ---> System.InvalidOperationException: Can't use schemaId "$PaymentMethodDto" for type "$E_Commerce.Services.PaymentMethodDto". The same schemaId is already used for type "$E_Commerce.DtoModels.OrderDtos.PaymentMethodDto"
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaRepository.RegisterType(Type type, String schemaId)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForType(Type modelType, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchema(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.CreateArraySchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.<>c__DisplayClass12_0.<GenerateConcreteSchema>b__1()
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForMember(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, DataProperty dataProperty)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.CreateObjectSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.<>c__DisplayClass12_0.<GenerateConcreteSchema>b__3()
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForMember(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, DataProperty dataProperty)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.CreateObjectSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.<>c__DisplayClass12_0.<GenerateConcreteSchema>b__3()
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForType(Type modelType, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchema(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateSchema(Type type, SchemaRepository schemaRepository, PropertyInfo propertyInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateSchema(Type type, SchemaRepository schemaRepository, PropertyInfo propertyInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.CreateResponseMediaType(Type modelType, SchemaRepository schemaRespository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.<>c__DisplayClass42_0.<GenerateResponse>b__2(String contentType)
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateResponse(ApiDescription apiDescription, SchemaRepository schemaRepository, String statusCode, ApiResponseType apiResponseType)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateResponses(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-08 03:55:17.616 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 237.0993ms
2025-08-08 03:57:20.194 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 03:57:22.410 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:57:22.427 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 03:57:22.461 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 03:57:22.486 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 03:57:22.521 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 03:57:22.958 +03:00 [INF] Executed DbCommand (50ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 03:57:23.043 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 03:57:23.079 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 03:57:23.671 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 03:57:23.789 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 03:57:23.817 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 03:57:23.818 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 03:57:23.820 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 03:57:23.822 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 03:57:23.865 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 03:57:23.874 +03:00 [INF] Hosting environment: Development
2025-08-08 03:57:23.880 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 03:57:23.887 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 03:57:23.892 +03:00 [INF] Server mrrobot:11196:876d3bf8 successfully announced in 22.7948 ms
2025-08-08 03:57:23.904 +03:00 [INF] Server mrrobot:11196:876d3bf8 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 03:57:24.065 +03:00 [INF] Server mrrobot:11196:876d3bf8 all the dispatchers started
2025-08-08 03:57:24.205 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 318.0567ms
2025-08-08 03:57:24.228 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 03:57:24.230 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 03:57:24.233 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 03:57:24.238 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 9.4303ms
2025-08-08 03:57:24.250 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 16.3849ms
2025-08-08 03:57:24.301 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 71.0787ms
2025-08-08 03:57:24.415 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 03:57:24.519 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce). See inner exception
 ---> Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate schema for type - E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodDto]]. See inner exception
 ---> System.InvalidOperationException: Can't use schemaId "$PaymentMethodDto" for type "$E_Commerce.Services.PaymentMethodDto". The same schemaId is already used for type "$E_Commerce.DtoModels.OrderDtos.PaymentMethodDto"
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaRepository.RegisterType(Type type, String schemaId)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForType(Type modelType, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchema(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.CreateArraySchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.<>c__DisplayClass12_0.<GenerateConcreteSchema>b__1()
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForMember(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, DataProperty dataProperty)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.CreateObjectSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.<>c__DisplayClass12_0.<GenerateConcreteSchema>b__3()
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForMember(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, DataProperty dataProperty)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.CreateObjectSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.<>c__DisplayClass12_0.<GenerateConcreteSchema>b__3()
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForType(Type modelType, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchema(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateSchema(Type type, SchemaRepository schemaRepository, PropertyInfo propertyInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateSchema(Type type, SchemaRepository schemaRepository, PropertyInfo propertyInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.CreateResponseMediaType(Type modelType, SchemaRepository schemaRespository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.<>c__DisplayClass42_0.<GenerateResponse>b__2(String contentType)
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateResponse(ApiDescription apiDescription, SchemaRepository schemaRepository, String statusCode, ApiResponseType apiResponseType)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateResponses(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-08 03:57:24.556 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 140.6713ms
2025-08-08 04:02:44.431 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 04:02:46.255 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:02:46.274 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:02:46.305 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 04:02:46.331 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 04:02:46.377 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 04:02:46.787 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:02:46.869 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:02:46.900 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 04:02:47.450 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 04:02:47.571 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 04:02:47.604 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:02:47.617 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 04:02:47.631 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 04:02:47.633 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 04:02:47.643 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 04:02:47.673 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 04:02:47.683 +03:00 [INF] Hosting environment: Development
2025-08-08 04:02:47.693 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 04:02:47.696 +03:00 [INF] Server mrrobot:21176:bfbbbcaf successfully announced in 18.2942 ms
2025-08-08 04:02:47.748 +03:00 [INF] Server mrrobot:21176:bfbbbcaf is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 04:02:47.758 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 04:02:47.871 +03:00 [INF] Server mrrobot:21176:bfbbbcaf all the dispatchers started
2025-08-08 04:02:47.927 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 323.4378ms
2025-08-08 04:02:47.959 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:02:47.964 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 5.6192ms
2025-08-08 04:02:47.993 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:02:48.000 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:02:48.011 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.9536ms
2025-08-08 04:02:48.044 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 50.7137ms
2025-08-08 04:02:48.542 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:02:48.773 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 231.1799ms
2025-08-08 04:07:47.775 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 04:13:47.993 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:13:48.472 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 489.7116ms
2025-08-08 04:13:48.700 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/favicon.ico - null null
2025-08-08 04:13:48.713 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 04:13:48.874 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:13:48.897 +03:00 [INF] No cached response available for this request.
2025-08-08 04:13:48.907 +03:00 [INF] The response could not be cached for this request.
2025-08-08 04:13:48.909 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/favicon.ico - 404 0 null 208.7459ms
2025-08-08 04:13:48.919 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5069/favicon.ico, Response status code: 404
2025-08-08 04:15:35.057 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json 70
2025-08-08 04:15:35.110 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
 ---> Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken.ReadToken(String encodedJson)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken..ctor(String jwtEncodedString)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ReadToken(String token, TokenValidationParameters validationParameters)
   --- End of inner exception stack trace ---
2025-08-08 04:15:35.131 +03:00 [INF] Bearer was not authenticated. Failure message: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
2025-08-08 04:15:35.134 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:15:35.141 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-08 04:15:35.220 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-08 04:15:35.736 +03:00 [INF] In LoginAsync Method 
2025-08-08 04:15:35.765 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 04:15:35.905 +03:00 [INF] 🔐 Generating Access Token for User ID: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:15:36.049 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-08-08 04:15:36.104 +03:00 [INF] ✅ Access Token generated successfully for User ID: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:15:36.109 +03:00 [INF] 🔑 Generating Refresh Token for User ID: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:15:36.129 +03:00 [INF] RefreshToken Generated
2025-08-08 04:15:36.177 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:15:36.230 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 999.0316ms
2025-08-08 04:15:36.241 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-08 04:15:36.257 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 200 1403 application/json; charset=utf-8 1200.0518ms
2025-08-08 04:22:08.202 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:22:08.255 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 54.1994ms
2025-08-08 04:22:08.367 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:22:08.372 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 5.3861ms
2025-08-08 04:22:08.397 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:22:08.403 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.9304ms
2025-08-08 04:22:08.429 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:22:08.457 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.1257ms
2025-08-08 04:22:09.252 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:22:09.433 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 181.1402ms
2025-08-08 04:22:46.043 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/PaymentProvider - multipart/form-data; boundary=--------------------------273388350398663206172785 1216
2025-08-08 04:22:46.202 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:22:46.404 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:22:46.420 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.Create (E-Commerce)'
2025-08-08 04:22:46.433 +03:00 [INF] Route matched with {action = "Create", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Create(E_Commerce.Services.CreatePaymentProviderDto) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-08-08 04:22:46.490 +03:00 [INF] Starting CreatePaymentProvider for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:22:46.535 +03:00 [INF] Creating payment provider: paymob
2025-08-08 04:22:46.541 +03:00 [INF] Executing CreateAsync for entity PaymentProvider
2025-08-08 04:22:46.666 +03:00 [INF] PaymentProvider added successfully (pending save)
2025-08-08 04:22:46.855 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (Size = 50), @p7='?' (Size = 200), @p8='?' (DbType = Int32), @p9='?' (Size = -1)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `PaymentProviders` (`ApiEndpoint`, `CreatedAt`, `DeletedAt`, `Hmac`, `IframeId`, `ModifiedAt`, `Name`, `PrivateKey`, `Provider`, `PublicKey`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `PaymentProviders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:22:46.908 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:22:46.911 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:22:46.942 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:22:46.986 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:22:47.007 +03:00 [INF] Payment provider created successfully with ID 1
2025-08-08 04:22:47.016 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:22:47.028 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.Create (E-Commerce) in 590.6064ms
2025-08-08 04:22:47.032 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.Create (E-Commerce)'
2025-08-08 04:22:47.035 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/PaymentProvider - 200 122 application/json; charset=utf-8 991.6929ms
2025-08-08 04:23:01.594 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - null null
2025-08-08 04:23:01.607 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:23:01.614 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:23:01.620 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-08-08 04:23:01.628 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentProviderDto]]]] GetAll(System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-08-08 04:23:01.643 +03:00 [INF] GetAll PaymentProviders | isDeleted: , Page: 1, PageSize: 10
2025-08-08 04:23:01.652 +03:00 [INF] Getting cache for key: paymentproviders__page1_size10
2025-08-08 04:23:01.667 +03:00 [WRN] Cache miss for key: paymentproviders__page1_size10
2025-08-08 04:23:01.669 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 04:23:01.708 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`
FROM `PaymentProviders` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-08 04:23:01.839 +03:00 [INF] Fetched payment providers from DB and cached result.
2025-08-08 04:23:01.842 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:23:01.852 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce) in 220.279ms
2025-08-08 04:23:01.855 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-08-08 04:23:01.857 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - 200 220 application/json; charset=utf-8 262.47ms
2025-08-08 04:23:09.418 +03:00 [INF] Setting cache for key: paymentproviders__page1_size10
2025-08-08 04:23:09.476 +03:00 [INF] Cache set successfully for key: paymentproviders__page1_size10 with tags: [PaymentProviderCache]
2025-08-08 04:23:45.192 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/PaymentMethod - multipart/form-data; boundary=--------------------------962625566501368728981970 512
2025-08-08 04:23:45.208 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:23:45.223 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:23:45.230 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.CreatePaymentMethod (E-Commerce)'
2025-08-08 04:23:45.239 +03:00 [INF] Route matched with {action = "CreatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CreatePaymentMethod(E_Commerce.Services.Createpaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 04:23:45.254 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:23:45.266 +03:00 [INF] Creating payment method: onlinepayemt
2025-08-08 04:23:45.270 +03:00 [INF] Executing CreateAsync for entity PaymentMethod
2025-08-08 04:23:45.315 +03:00 [INF] PaymentMethod added successfully (pending save)
2025-08-08 04:23:45.342 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (Size = 20), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `PaymentMethods` (`CreatedAt`, `DeletedAt`, `IntegrationId`, `IsActive`, `Method`, `ModifiedAt`, `Name`, `PaymentProviderId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `PaymentMethods`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:23:45.355 +03:00 [INF] Payment method created successfully with ID 1
2025-08-08 04:23:45.357 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:23:45.358 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:23:45.360 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:23:45.362 +03:00 [INF] Admin operation logged for payment method 1
2025-08-08 04:23:45.394 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:23:45.400 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.CreatePaymentMethod (E-Commerce) in 157.6474ms
2025-08-08 04:23:45.405 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.CreatePaymentMethod (E-Commerce)'
2025-08-08 04:23:45.407 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/PaymentMethod - 200 122 application/json; charset=utf-8 214.3208ms
2025-08-08 04:23:49.434 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-08 04:23:49.750 +03:00 [WRN] No cache entries found for tag: Paymentmethodcache
2025-08-08 04:23:55.723 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?isActive=true&page=1&pageSize=10 - null null
2025-08-08 04:23:55.732 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:23:55.741 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:23:55.747 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 04:23:55.755 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 04:23:55.762 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: True, isDeleted: , Page: 1, PageSize: 10
2025-08-08 04:23:55.769 +03:00 [INF] Getting cache for key: paymentmethods_True__page1_size10
2025-08-08 04:23:55.772 +03:00 [WRN] Cache miss for key: paymentmethods_True__page1_size10
2025-08-08 04:23:55.774 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 04:23:55.822 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_isActive_Value_0='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
WHERE `p`.`IsActive` = @__8__locals1_isActive_Value_0
2025-08-08 04:23:55.857 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_isActive_Value_0='?' (DbType = Boolean), @__p_2='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`
FROM `PaymentMethods` AS `p`
WHERE `p`.`IsActive` = @__8__locals1_isActive_Value_0
ORDER BY `p`.`Id`
LIMIT @__p_2 OFFSET @__p_1
2025-08-08 04:23:55.889 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-08-08 04:23:55.892 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:23:55.898 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 139.5456ms
2025-08-08 04:23:55.901 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 04:23:55.903 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?isActive=true&page=1&pageSize=10 - 200 120 application/json; charset=utf-8 180.3641ms
2025-08-08 04:23:59.404 +03:00 [INF] Setting cache for key: paymentmethods_True__page1_size10
2025-08-08 04:23:59.412 +03:00 [INF] Cache set successfully for key: paymentmethods_True__page1_size10 with tags: [Paymentmethodcache]
2025-08-08 04:24:08.125 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-08-08 04:24:08.131 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:24:08.139 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:24:08.145 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 04:24:08.148 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 04:24:08.175 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-08-08 04:24:08.177 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-08-08 04:24:08.179 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-08-08 04:24:08.181 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 04:24:08.186 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-08-08 04:24:08.193 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-08 04:24:08.220 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-08-08 04:24:08.223 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:24:08.226 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 73.1649ms
2025-08-08 04:24:08.229 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 04:24:08.233 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 120 application/json; charset=utf-8 107.8736ms
2025-08-08 04:24:09.467 +03:00 [INF] Setting cache for key: paymentmethods___page1_size10
2025-08-08 04:24:09.473 +03:00 [INF] Cache set successfully for key: paymentmethods___page1_size10 with tags: [Paymentmethodcache]
2025-08-08 04:26:27.458 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 04:26:31.924 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:26:31.945 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:26:31.991 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 04:26:32.017 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 04:26:32.059 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 04:26:32.567 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:26:32.673 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:26:32.710 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 04:26:33.595 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 04:26:33.731 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 04:26:33.855 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 04:26:33.969 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 04:26:33.971 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 04:26:33.973 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 04:26:33.998 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:26:34.027 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 04:26:34.122 +03:00 [INF] Hosting environment: Development
2025-08-08 04:26:34.131 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 04:26:34.131 +03:00 [INF] Server mrrobot:968:86931bd5 successfully announced in 86.8954 ms
2025-08-08 04:26:34.170 +03:00 [INF] Server mrrobot:968:86931bd5 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 04:26:34.347 +03:00 [INF] Server mrrobot:968:86931bd5 all the dispatchers started
2025-08-08 04:26:34.496 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 498.5514ms
2025-08-08 04:26:35.515 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:26:35.517 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:26:35.526 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 10.9902ms
2025-08-08 04:26:35.537 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:26:35.555 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 17.624ms
2025-08-08 04:26:35.589 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 71.7207ms
2025-08-08 04:26:36.971 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:26:37.258 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 286.7433ms
2025-08-08 04:27:01.138 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/PaymentMethod - multipart/form-data; boundary=--------------------------748809225444680998160550 512
2025-08-08 04:27:01.147 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 04:27:01.408 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:27:01.482 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:27:01.506 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.CreatePaymentMethod (E-Commerce)'
2025-08-08 04:27:01.543 +03:00 [INF] Route matched with {action = "CreatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CreatePaymentMethod(E_Commerce.Services.Createpaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 04:27:01.713 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:27:01.746 +03:00 [INF] Creating payment method: onlinepayemt
2025-08-08 04:27:01.751 +03:00 [INF] Executing CreateAsync for entity PaymentMethod
2025-08-08 04:27:01.844 +03:00 [INF] PaymentMethod added successfully (pending save)
2025-08-08 04:27:02.003 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (Size = 20), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `PaymentMethods` (`CreatedAt`, `DeletedAt`, `IntegrationId`, `IsActive`, `Method`, `ModifiedAt`, `Name`, `PaymentProviderId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `PaymentMethods`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:27:02.057 +03:00 [INF] Payment method created successfully with ID 2
2025-08-08 04:27:02.062 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:27:02.065 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:27:02.099 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:27:02.111 +03:00 [INF] Admin operation logged for payment method 2
2025-08-08 04:27:02.157 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:27:02.309 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:27:02.377 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.CreatePaymentMethod (E-Commerce) in 825.7402ms
2025-08-08 04:27:02.380 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.CreatePaymentMethod (E-Commerce)'
2025-08-08 04:27:02.388 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/PaymentMethod - 200 122 application/json; charset=utf-8 1250.0675ms
2025-08-08 04:27:04.432 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-08 04:27:04.466 +03:00 [INF] Removed 2 cache entries for tag: Paymentmethodcache
2025-08-08 04:27:05.762 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-08-08 04:27:05.775 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:27:05.782 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:27:05.787 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 04:27:05.796 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 04:27:05.818 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-08-08 04:27:05.826 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-08-08 04:27:05.834 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-08-08 04:27:05.838 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 04:27:05.907 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-08-08 04:27:05.989 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-08 04:27:06.030 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-08-08 04:27:06.035 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:27:06.045 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 245.6768ms
2025-08-08 04:27:06.048 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 04:27:06.050 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 289 application/json; charset=utf-8 287.4808ms
2025-08-08 04:27:14.358 +03:00 [INF] Setting cache for key: paymentmethods___page1_size10
2025-08-08 04:27:14.387 +03:00 [INF] Cache set successfully for key: paymentmethods___page1_size10 with tags: [Paymentmethodcache]
2025-08-08 04:28:17.465 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories - multipart/form-data; boundary=--------------------------964118689881803947907036 408
2025-08-08 04:28:17.477 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:28:17.484 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:28:17.495 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce)'
2025-08-08 04:28:17.503 +03:00 [INF] Route matched with {action = "CreateAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CategoryDtos.CategoryDto]]] CreateAsync(E_Commerce.DtoModels.CategoryDtos.CreateCategotyDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:28:17.803 +03:00 [INF] Executing CreateAsync
2025-08-08 04:28:17.809 +03:00 [INF] Execute CreateAsync
2025-08-08 04:28:17.813 +03:00 [INF] Executing IsExsistsByNameAsync for name: firstcate
2025-08-08 04:28:17.834 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__name_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE `c`.`Name` = @__name_0)
2025-08-08 04:28:17.840 +03:00 [INF] Category with name: firstcate does not exist
2025-08-08 04:28:17.857 +03:00 [INF] Executing CreateAsync for entity Category
2025-08-08 04:28:17.897 +03:00 [INF] Category added successfully (pending save)
2025-08-08 04:28:17.914 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 50), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Boolean), @p6='?' (DbType = DateTime), @p7='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Categories` (`CreatedAt`, `DeletedAt`, `Description`, `DisplayOrder`, `ImageId`, `IsActive`, `ModifiedAt`, `Name`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `Categories`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:28:17.925 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:28:17.927 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:28:17.929 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:28:17.951 +03:00 [INF] Executing GetByIdAsync for entity Category with ID: 1
2025-08-08 04:28:17.962 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`ImageId`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`
FROM `Categories` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-08 04:28:18.007 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CategoryDtos.CategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:28:18.022 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce) in 510.0189ms
2025-08-08 04:28:18.026 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce)'
2025-08-08 04:28:18.030 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories - 201 447 application/json; charset=utf-8 564.4262ms
2025-08-08 04:28:24.429 +03:00 [INF] Removing cache by tags: [category, categorywithdata]
2025-08-08 04:28:24.431 +03:00 [WRN] No cache entries found for tags: [category, categorywithdata]
2025-08-08 04:28:48.305 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories/1/images/main - multipart/form-data; boundary=--------------------------935273682715680439948129 341525
2025-08-08 04:28:48.317 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:28:48.323 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:28:48.331 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:28:48.340 +03:00 [INF] Route matched with {action = "AddMainImageAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImageAsync(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:28:48.377 +03:00 [INF] Executing AddMainImageAsync for id: 1
2025-08-08 04:28:48.385 +03:00 [INF] Executing AddMainImageToCategoryAsync for categoryId: 1
2025-08-08 04:28:48.404 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:28:48.465 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:28:48.480 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce) in 134.9894ms
2025-08-08 04:28:48.493 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:28:48.509 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories/1/images/main - 404 1076 application/json; charset=utf-8 204.1503ms
2025-08-08 04:29:47.623 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories/1/images/main - multipart/form-data; boundary=--------------------------525308849622645258748812 341525
2025-08-08 04:29:47.630 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:29:47.634 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:29:47.637 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:29:47.639 +03:00 [INF] Route matched with {action = "AddMainImageAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImageAsync(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:29:47.675 +03:00 [INF] Executing AddMainImageAsync for id: 1
2025-08-08 04:29:47.677 +03:00 [INF] Executing AddMainImageToCategoryAsync for categoryId: 1
2025-08-08 04:29:47.682 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:29:47.693 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:29:47.697 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce) in 48.406ms
2025-08-08 04:29:47.700 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:29:47.705 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories/1/images/main - 404 1076 application/json; charset=utf-8 82.0313ms
2025-08-08 04:30:18.686 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/categories/1 - null null
2025-08-08 04:30:18.695 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:30:18.700 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:30:18.706 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.GetCategoryById (E-Commerce)'
2025-08-08 04:30:18.715 +03:00 [INF] Route matched with {action = "GetCategoryById", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CategoryDtos.CategorywithdataDto]]] GetCategoryById(Int32, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:30:18.730 +03:00 [INF] Executing GetCategoryById for id: 1, isActive: , includeDeleted: 
2025-08-08 04:30:18.735 +03:00 [INF] Execute: GetCategoryByIdAsync in services for id: 1, isActive: , includeDeleted: 
2025-08-08 04:30:18.738 +03:00 [INF] Getting cache for key: categoryid:1_active:_deleted:
2025-08-08 04:30:18.741 +03:00 [WRN] Cache miss for key: categoryid:1_active:_deleted:
2025-08-08 04:30:18.746 +03:00 [INF] Executing GetCategoryByIdAsync for id: 1
2025-08-08 04:30:18.748 +03:00 [INF] Execute GetAll for entity Category
2025-08-08 04:30:18.824 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-08-08 04:30:18.841 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`Description`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`DisplayOrder`, `t0`.`Id`, `t0`.`Name`, `t0`.`Description`, `t0`.`IsActive`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`DeletedAt`, `t0`.`Id0`, `t0`.`Url`, `t0`.`IsMain`, `i0`.`Id`, `i0`.`Url`, `i0`.`IsMain`
FROM (
    SELECT `c`.`Id`, `c`.`Name`, `c`.`Description`, `c`.`IsActive`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`DisplayOrder`
    FROM `Categories` AS `c`
    WHERE `c`.`Id` = @__id_0
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `s`.`Id`, `s`.`Name`, `s`.`Description`, `s`.`IsActive`, `s`.`CreatedAt`, `s`.`ModifiedAt`, `s`.`DeletedAt`, `i`.`Id` AS `Id0`, `i`.`Url`, `i`.`IsMain`, `s`.`CategoryId`
    FROM `SubCategories` AS `s`
    LEFT JOIN `Images` AS `i` ON `s`.`Id` = `i`.`SubCategoryId`
    WHERE `s`.`IsActive` AND (`s`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CategoryId`
LEFT JOIN `Images` AS `i0` ON `t`.`Id` = `i0`.`CategoryId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`
2025-08-08 04:30:18.848 +03:00 [WRN] Category with id: 1 doesn't exist
2025-08-08 04:30:18.849 +03:00 [WRN] Category with id: 1 not found
2025-08-08 04:30:18.857 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CategoryDtos.CategorywithdataDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:30:18.865 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.GetCategoryById (E-Commerce) in 144.6825ms
2025-08-08 04:30:18.869 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.GetCategoryById (E-Commerce)'
2025-08-08 04:30:18.871 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/categories/1 - 404 1078 application/json; charset=utf-8 185.2887ms
2025-08-08 04:31:28.078 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:31:28.110 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 31.4953ms
2025-08-08 04:31:28.156 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:31:28.167 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 11.4881ms
2025-08-08 04:31:28.183 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:31:28.188 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:31:28.198 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.0273ms
2025-08-08 04:31:28.214 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.7732ms
2025-08-08 04:31:28.495 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:31:28.665 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 170.4444ms
2025-08-08 04:31:34.221 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 04:31:36.939 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories - multipart/form-data; boundary=--------------------------370255623039057552521410 408
2025-08-08 04:31:36.945 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:31:36.950 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:31:36.955 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce)'
2025-08-08 04:31:36.961 +03:00 [INF] Route matched with {action = "CreateAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CategoryDtos.CategoryDto]]] CreateAsync(E_Commerce.DtoModels.CategoryDtos.CreateCategotyDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:31:36.968 +03:00 [INF] Executing CreateAsync
2025-08-08 04:31:36.973 +03:00 [INF] Execute CreateAsync
2025-08-08 04:31:36.974 +03:00 [INF] Executing IsExsistsByNameAsync for name: firstcate
2025-08-08 04:31:36.977 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__name_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE `c`.`Name` = @__name_0)
2025-08-08 04:31:36.981 +03:00 [INF] Category with name: firstcate does not exist
2025-08-08 04:31:36.983 +03:00 [INF] Executing CreateAsync for entity Category
2025-08-08 04:31:36.985 +03:00 [INF] Category added successfully (pending save)
2025-08-08 04:31:36.988 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 50), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Boolean), @p6='?' (DbType = DateTime), @p7='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Categories` (`CreatedAt`, `DeletedAt`, `Description`, `DisplayOrder`, `ImageId`, `IsActive`, `ModifiedAt`, `Name`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `Categories`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:31:36.993 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:31:36.994 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:31:36.996 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:31:37.024 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:31:37.030 +03:00 [INF] Executing GetByIdAsync for entity Category with ID: 2
2025-08-08 04:31:37.033 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`ImageId`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`
FROM `Categories` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-08 04:31:37.037 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CategoryDtos.CategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:31:37.039 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce) in 72.8037ms
2025-08-08 04:31:37.042 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce)'
2025-08-08 04:31:37.044 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories - 201 447 application/json; charset=utf-8 104.908ms
2025-08-08 04:31:43.039 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories/1/images/main - multipart/form-data; boundary=--------------------------599124789167215183499630 341525
2025-08-08 04:31:43.048 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:31:43.053 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:31:43.059 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:31:43.068 +03:00 [INF] Route matched with {action = "AddMainImageAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImageAsync(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:31:43.081 +03:00 [INF] Executing AddMainImageAsync for id: 1
2025-08-08 04:31:43.084 +03:00 [INF] Executing AddMainImageToCategoryAsync for categoryId: 1
2025-08-08 04:31:43.087 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:31:43.097 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:31:43.100 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce) in 27.3861ms
2025-08-08 04:31:43.102 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:31:43.112 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories/1/images/main - 404 1076 application/json; charset=utf-8 72.7352ms
2025-08-08 04:31:44.627 +03:00 [INF] Removing cache by tags: [category, categorywithdata]
2025-08-08 04:31:44.631 +03:00 [WRN] No cache entries found for tags: [category, categorywithdata]
2025-08-08 04:31:50.898 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/categories/1 - null null
2025-08-08 04:31:50.904 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:31:50.908 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:31:50.913 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.GetCategoryById (E-Commerce)'
2025-08-08 04:31:50.922 +03:00 [INF] Route matched with {action = "GetCategoryById", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CategoryDtos.CategorywithdataDto]]] GetCategoryById(Int32, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:31:50.929 +03:00 [INF] Executing GetCategoryById for id: 1, isActive: , includeDeleted: 
2025-08-08 04:31:50.931 +03:00 [INF] Execute: GetCategoryByIdAsync in services for id: 1, isActive: , includeDeleted: 
2025-08-08 04:31:50.934 +03:00 [INF] Getting cache for key: categoryid:1_active:_deleted:
2025-08-08 04:31:50.936 +03:00 [WRN] Cache miss for key: categoryid:1_active:_deleted:
2025-08-08 04:31:50.937 +03:00 [INF] Executing GetCategoryByIdAsync for id: 1
2025-08-08 04:31:50.938 +03:00 [INF] Execute GetAll for entity Category
2025-08-08 04:31:50.953 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`Description`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`DisplayOrder`, `t0`.`Id`, `t0`.`Name`, `t0`.`Description`, `t0`.`IsActive`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`DeletedAt`, `t0`.`Id0`, `t0`.`Url`, `t0`.`IsMain`, `i0`.`Id`, `i0`.`Url`, `i0`.`IsMain`
FROM (
    SELECT `c`.`Id`, `c`.`Name`, `c`.`Description`, `c`.`IsActive`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`DisplayOrder`
    FROM `Categories` AS `c`
    WHERE `c`.`Id` = @__id_0
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `s`.`Id`, `s`.`Name`, `s`.`Description`, `s`.`IsActive`, `s`.`CreatedAt`, `s`.`ModifiedAt`, `s`.`DeletedAt`, `i`.`Id` AS `Id0`, `i`.`Url`, `i`.`IsMain`, `s`.`CategoryId`
    FROM `SubCategories` AS `s`
    LEFT JOIN `Images` AS `i` ON `s`.`Id` = `i`.`SubCategoryId`
    WHERE `s`.`IsActive` AND (`s`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CategoryId`
LEFT JOIN `Images` AS `i0` ON `t`.`Id` = `i0`.`CategoryId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`
2025-08-08 04:31:50.969 +03:00 [WRN] Category with id: 1 doesn't exist
2025-08-08 04:31:50.970 +03:00 [WRN] Category with id: 1 not found
2025-08-08 04:31:50.978 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CategoryDtos.CategorywithdataDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:31:50.981 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.GetCategoryById (E-Commerce) in 53.3519ms
2025-08-08 04:31:50.988 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.GetCategoryById (E-Commerce)'
2025-08-08 04:31:50.990 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/categories/1 - 404 1078 application/json; charset=utf-8 92.3374ms
2025-08-08 04:31:54.920 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories - multipart/form-data; boundary=--------------------------234669168534288903293749 408
2025-08-08 04:31:54.927 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:31:54.930 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:31:54.934 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce)'
2025-08-08 04:31:54.936 +03:00 [INF] Route matched with {action = "CreateAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CategoryDtos.CategoryDto]]] CreateAsync(E_Commerce.DtoModels.CategoryDtos.CreateCategotyDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:31:54.945 +03:00 [INF] Executing CreateAsync
2025-08-08 04:31:54.947 +03:00 [INF] Execute CreateAsync
2025-08-08 04:31:54.948 +03:00 [INF] Executing IsExsistsByNameAsync for name: firstcate
2025-08-08 04:31:54.951 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__name_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE `c`.`Name` = @__name_0)
2025-08-08 04:31:54.954 +03:00 [INF] Category with name: firstcate already exists
2025-08-08 04:31:54.964 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CategoryDtos.CategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:31:54.967 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce) in 23.0465ms
2025-08-08 04:31:54.969 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.CreateAsync (E-Commerce)'
2025-08-08 04:31:54.980 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories - 409 405 application/json; charset=utf-8 59.6166ms
2025-08-08 04:32:09.256 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/categories?page=1&pageSize=10 - null null
2025-08-08 04:32:09.262 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:32:09.268 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:32:09.273 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce)'
2025-08-08 04:32:09.285 +03:00 [INF] Route matched with {action = "GetCategories", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.CategoryDtos.CategoryDto]]]] GetCategories(System.String, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:32:09.293 +03:00 [INF] Executing GetCategories with search: , isActive: , isDeleted: , page: 1
2025-08-08 04:32:09.298 +03:00 [INF] Executing FilterAsync with filters
2025-08-08 04:32:09.300 +03:00 [INF] Getting cache for key: category_all____1_10
2025-08-08 04:32:09.304 +03:00 [WRN] Cache miss for key: category_all____1_10
2025-08-08 04:32:09.309 +03:00 [INF] Execute GetAll for entity Category
2025-08-08 04:32:09.317 +03:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-08-08 04:32:09.319 +03:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-08-08 04:32:09.386 +03:00 [INF] Executed DbCommand (54ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`Description`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`DisplayOrder`, `i`.`Id`, `i`.`Url`, `i`.`IsMain`
FROM (
    SELECT `c`.`Id`, `c`.`Name`, `c`.`Description`, `c`.`IsActive`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`DisplayOrder`
    FROM `Categories` AS `c`
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
LEFT JOIN `Images` AS `i` ON `t`.`Id` = `i`.`CategoryId`
ORDER BY `t`.`Id`
2025-08-08 04:32:09.427 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.CategoryDtos.CategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:32:09.433 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce) in 143.0488ms
2025-08-08 04:32:09.439 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce)'
2025-08-08 04:32:09.442 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/categories?page=1&pageSize=10 - 200 458 application/json; charset=utf-8 185.1993ms
2025-08-08 04:32:14.655 +03:00 [INF] Setting cache for key: category_all____1_10
2025-08-08 04:32:14.666 +03:00 [INF] Cache set successfully for key: category_all____1_10 with tags: [category]
2025-08-08 04:32:19.484 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - multipart/form-data; boundary=--------------------------114612504846797268046821 341525
2025-08-08 04:32:19.491 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:32:19.495 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:32:19.500 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:32:19.504 +03:00 [INF] Route matched with {action = "AddMainImageAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImageAsync(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:32:19.513 +03:00 [INF] Executing AddMainImageAsync for id: 2
2025-08-08 04:32:19.516 +03:00 [INF] Executing AddMainImageToCategoryAsync for categoryId: 2
2025-08-08 04:32:19.520 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:32:19.530 +03:00 [INF] 📥 Saving main image to CategoryPhotos
2025-08-08 04:32:19.551 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:32:19.618 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:32:19.649 +03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:32:19.695 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Column 'CustomerId' cannot be null
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Column 'CustomerId' cannot be null
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-08 04:32:19.711 +03:00 [ERR] ❌ Error saving main image: An error occurred while saving the entity changes. See the inner exception for details.
2025-08-08 04:32:19.746 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:32:19.750 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce) in 242.712ms
2025-08-08 04:32:19.764 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:32:19.771 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - 500 1298 application/json; charset=utf-8 287.1098ms
2025-08-08 04:34:54.425 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 04:34:58.904 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:34:58.951 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:34:58.989 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 04:34:59.031 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 04:34:59.086 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 04:34:59.691 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:34:59.802 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:34:59.835 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 04:35:02.791 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 04:35:02.984 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 04:35:03.082 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 04:35:03.084 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 04:35:03.085 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 04:35:03.087 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 04:35:03.164 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 04:35:03.167 +03:00 [INF] Hosting environment: Development
2025-08-08 04:35:03.174 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 04:35:03.197 +03:00 [INF] Server mrrobot:7476:45ffaa73 successfully announced in 28.0547 ms
2025-08-08 04:35:03.209 +03:00 [INF] Server mrrobot:7476:45ffaa73 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 04:35:04.057 +03:00 [INF] Server mrrobot:7476:45ffaa73 all the dispatchers started
2025-08-08 04:35:04.189 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:35:04.771 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 606.5643ms
2025-08-08 04:35:04.850 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:35:04.856 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:35:05.077 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:35:05.291 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 455.4749ms
2025-08-08 04:35:05.304 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 447.4966ms
2025-08-08 04:35:05.526 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 448.8708ms
2025-08-08 04:35:05.753 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:35:06.237 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 483.9884ms
2025-08-08 04:35:09.387 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - multipart/form-data; boundary=--------------------------223948384909598903442505 341525
2025-08-08 04:35:09.397 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 04:35:09.840 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:35:09.925 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:35:10.000 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:35:10.050 +03:00 [INF] Route matched with {action = "AddMainImageAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImageAsync(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:35:10.875 +03:00 [INF] Executing AddMainImageAsync for id: 2
2025-08-08 04:35:10.909 +03:00 [INF] Executing AddMainImageToCategoryAsync for categoryId: 2
2025-08-08 04:35:11.056 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:35:22.419 +03:00 [INF] 📥 Saving main image to CategoryPhotos
2025-08-08 04:35:59.678 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:36:01.022 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:36:05.492 +03:00 [ERR] Failed executing DbCommand (48ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:36:05.593 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Column 'CustomerId' cannot be null
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Column 'CustomerId' cannot be null
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-08 04:36:26.664 +03:00 [ERR] ❌ Error saving main image: An error occurred while saving the entity changes. See the inner exception for details.
2025-08-08 04:36:27.017 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:36:27.088 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce) in 77019.3682ms
2025-08-08 04:36:27.091 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:36:27.106 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - 500 1298 application/json; charset=utf-8 77719.5226ms
2025-08-08 04:36:42.927 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:36:42.950 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 22.4824ms
2025-08-08 04:36:43.017 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:36:43.018 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:36:43.027 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:36:43.106 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 89.089ms
2025-08-08 04:36:43.112 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 85.9834ms
2025-08-08 04:36:43.122 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 105.3813ms
2025-08-08 04:36:43.205 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:36:43.467 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 261.6377ms
2025-08-08 04:38:45.156 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 04:38:46.314 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 04:39:09.921 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 04:39:10.611 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:39:10.635 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:39:10.669 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 04:39:10.695 +03:00 [INF] Applying migration '20250808013847_updateimagemodel'.
2025-08-08 04:39:10.968 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` DROP FOREIGN KEY `FK_AspNetUsers_Images_ImageId`;
2025-08-08 04:39:10.976 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Categories` DROP FOREIGN KEY `FK_Categories_Images_ImageId`;
2025-08-08 04:39:10.988 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Products` DROP FOREIGN KEY `FK_Products_Images_ImageId`;
2025-08-08 04:39:10.998 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `SubCategories` DROP FOREIGN KEY `FK_SubCategories_Images_ImageId`;
2025-08-08 04:39:11.019 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `SubCategories` DROP INDEX `IX_SubCategories_ImageId`;
2025-08-08 04:39:11.032 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Products` DROP INDEX `IX_Products_ImageId`;
2025-08-08 04:39:11.044 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Categories` DROP INDEX `IX_Categories_ImageId`;
2025-08-08 04:39:11.059 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` DROP INDEX `IX_AspNetUsers_ImageId`;
2025-08-08 04:39:11.072 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `SubCategories` DROP COLUMN `ImageId`;
2025-08-08 04:39:11.079 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Products` DROP COLUMN `ImageId`;
2025-08-08 04:39:11.087 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Categories` DROP COLUMN `ImageId`;
2025-08-08 04:39:11.157 +03:00 [INF] Executed DbCommand (70ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Images` MODIFY COLUMN `CustomerId` longtext CHARACTER SET utf8mb4 NULL;
2025-08-08 04:39:11.166 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` ADD `ImageId1` int NULL;
2025-08-08 04:39:11.187 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUsers_ImageId1` ON `AspNetUsers` (`ImageId1`);
2025-08-08 04:39:11.259 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` ADD CONSTRAINT `FK_AspNetUsers_Images_ImageId1` FOREIGN KEY (`ImageId1`) REFERENCES `Images` (`Id`);
2025-08-08 04:39:11.264 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20250808013847_updateimagemodel', '8.0.13');
2025-08-08 04:39:18.924 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 04:39:20.577 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 04:39:20.968 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:39:20.984 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:39:21.013 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 04:39:21.034 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 04:39:21.077 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 04:39:21.539 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:39:21.643 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:39:21.676 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 04:39:23.618 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 04:39:23.755 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 04:39:23.776 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 04:39:23.778 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 04:39:23.782 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 04:39:23.784 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 04:39:23.821 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 04:39:23.834 +03:00 [INF] Hosting environment: Development
2025-08-08 04:39:23.855 +03:00 [INF] Server mrrobot:24628:110f066a successfully announced in 28.5453 ms
2025-08-08 04:39:23.867 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 04:39:23.880 +03:00 [INF] Server mrrobot:24628:110f066a is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 04:39:23.898 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 04:39:24.044 +03:00 [INF] Server mrrobot:24628:110f066a all the dispatchers started
2025-08-08 04:39:24.920 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:39:25.520 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 600.0509ms
2025-08-08 04:39:25.580 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:39:25.608 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:39:25.614 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 34.3472ms
2025-08-08 04:39:25.873 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 265.4909ms
2025-08-08 04:39:25.878 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:39:26.007 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 128.5026ms
2025-08-08 04:39:26.406 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:39:26.680 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 273.7451ms
2025-08-08 04:39:31.864 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - multipart/form-data; boundary=--------------------------069337734691579638168555 341525
2025-08-08 04:39:31.874 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 04:39:32.151 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:39:32.252 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:39:32.291 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:39:32.340 +03:00 [INF] Route matched with {action = "AddMainImageAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImageAsync(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:39:33.146 +03:00 [INF] Executing AddMainImageAsync for id: 2
2025-08-08 04:39:33.153 +03:00 [INF] Executing AddMainImageToCategoryAsync for categoryId: 2
2025-08-08 04:39:33.213 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:39:33.223 +03:00 [INF] 📥 Saving main image to CategoryPhotos
2025-08-08 04:39:33.246 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:39:33.401 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:39:33.673 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:39:33.764 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:39:33.778 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:39:33.842 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:39:33.846 +03:00 [INF] ✅ Main image saved: /CategoryPhotos/ed54bc79-04e4-4bf1-8ef2-ef4816d82ed3.jpg
2025-08-08 04:39:33.975 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:39:34.477 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:39:34.690 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce) in 2320.094ms
2025-08-08 04:39:34.748 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:39:34.773 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - 200 1093 application/json; charset=utf-8 2902.5655ms
2025-08-08 04:39:44.134 +03:00 [INF] Removing cache by tags: [category, categorywithdata]
2025-08-08 04:39:44.181 +03:00 [INF] Removed 1 cache entries for tags: [category, categorywithdata]
2025-08-08 04:40:41.043 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/subcategories - multipart/form-data; boundary=--------------------------383142793731529174964318 419
2025-08-08 04:40:41.057 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:40:41.065 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:40:41.079 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.Create (E-Commerce)'
2025-08-08 04:40:41.090 +03:00 [INF] Route matched with {action = "Create", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.SubCategorydto.SubCategoryDto]]] Create(E_Commerce.DtoModels.SubCategorydto.CreateSubCategoryDto) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:40:41.113 +03:00 [INF] Executing Create
2025-08-08 04:40:41.119 +03:00 [INF] Execute CreateAsync
2025-08-08 04:40:41.127 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:40:41.133 +03:00 [INF] Executing IsExsistByNameAsync for name: first subcategory
2025-08-08 04:40:41.144 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__name_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE `s`.`Name` = @__name_0)
2025-08-08 04:40:41.148 +03:00 [INF] Category with name: first subcategory does not exist
2025-08-08 04:40:41.163 +03:00 [INF] Executing CreateAsync for entity SubCategory
2025-08-08 04:40:41.196 +03:00 [INF] SubCategory added successfully (pending save)
2025-08-08 04:40:41.210 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `SubCategories` (`CategoryId`, `CreatedAt`, `DeletedAt`, `Description`, `IsActive`, `ModifiedAt`, `Name`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `SubCategories`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:40:41.218 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:40:41.219 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:40:41.223 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:40:41.249 +03:00 [INF] Successfully mapped subcategory to DTO
2025-08-08 04:40:41.254 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.SubCategorydto.SubCategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:40:41.267 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.Create (E-Commerce) in 173.0393ms
2025-08-08 04:40:41.272 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.Create (E-Commerce)'
2025-08-08 04:40:41.276 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/subcategories - 201 365 application/json; charset=utf-8 233.0841ms
2025-08-08 04:40:44.092 +03:00 [INF] Removing cache by tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:40:44.103 +03:00 [INF] Removed 1 cache entries for tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:41:06.370 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - multipart/form-data; boundary=--------------------------467550728825912038338274 341525
2025-08-08 04:41:06.392 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:41:06.397 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:41:06.408 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:41:06.454 +03:00 [INF] Route matched with {action = "AddMainImage", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImage(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:41:06.486 +03:00 [INF] Executing AddMainImage for id: 1
2025-08-08 04:41:06.503 +03:00 [INF] Executing AddMainImageToSubCategoryAsync for subCategoryId: 1
2025-08-08 04:41:06.514 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE (`s`.`Id` = @__id_0) AND `s`.`DeletedAt` IS NULL)
2025-08-08 04:41:06.536 +03:00 [INF] 📥 Saving main image to SubCategoryPhotos
2025-08-08 04:41:06.579 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:41:06.600 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:41:06.632 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:41:06.647 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:41:06.649 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:41:06.650 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:41:06.652 +03:00 [INF] ✅ Main image saved: /SubCategoryPhotos/6eb68098-96d0-465f-b415-918553b25b8d.jpg
2025-08-08 04:41:06.654 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:41:06.667 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:41:06.669 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:41:06.701 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime), @p8='?' (Size = 255), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:41:06.778 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:41:06.781 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce) in 313.6417ms
2025-08-08 04:41:06.783 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:41:06.785 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - 200 955 application/json; charset=utf-8 415.1684ms
2025-08-08 04:41:14.142 +03:00 [INF] Removing cache by tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:41:14.145 +03:00 [WRN] No cache entries found for tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:42:01.480 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Products - application/json 127
2025-08-08 04:42:01.486 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:42:01.491 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:42:01.497 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductController.CreateProduct (E-Commerce)'
2025-08-08 04:42:01.507 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductDto]]] CreateProduct(E_Commerce.DtoModels.ProductDtos.CreateProductDto) on controller E_Commerce.Controllers.ProductController (E-Commerce).
2025-08-08 04:42:01.559 +03:00 [INF] Executing CreateProduct
2025-08-08 04:42:01.568 +03:00 [INF] Creating new product: T
iwYTGK
2025-08-08 04:42:01.574 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE (`s`.`Id` = @__id_0) AND `s`.`DeletedAt` IS NULL)
2025-08-08 04:42:01.588 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__name_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE `p`.`Name` = @__name_0)
2025-08-08 04:42:01.598 +03:00 [INF] Executing CreateAsync for entity Product
2025-08-08 04:42:01.673 +03:00 [INF] Product added successfully (pending save)
2025-08-08 04:42:01.676 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:42:01.678 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:42:01.680 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:42:01.716 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 50), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Boolean), @p6='?' (DbType = DateTime), @p7='?' (Size = 20), @p8='?' (DbType = Decimal), @p9='?' (DbType = Int32), @p10='?' (DbType = Int32), @p11='?' (DbType = Int32), @p12='?' (Size = 255), @p13='?' (DbType = DateTime), @p14='?' (DbType = DateTime), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (DbType = DateTime), @p18='?' (DbType = Int32), @p19='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Products` (`CreatedAt`, `DeletedAt`, `Description`, `DiscountId`, `Gender`, `IsActive`, `ModifiedAt`, `Name`, `Price`, `Quantity`, `SubCategoryId`, `fitType`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:42:01.766 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:42:01.785 +03:00 [INF] Executed action E_Commerce.Controllers.ProductController.CreateProduct (E-Commerce) in 272.6906ms
2025-08-08 04:42:01.788 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductController.CreateProduct (E-Commerce)'
2025-08-08 04:42:01.790 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Products - 201 446 application/json; charset=utf-8 309.8296ms
2025-08-08 04:42:04.201 +03:00 [INF] Removing cache by tags: [product_search, categorywithdata, productwithvariantdata, CollectionWithProduct, cart]
2025-08-08 04:42:04.209 +03:00 [WRN] No cache entries found for tags: [product_search, categorywithdata, productwithvariantdata, CollectionWithProduct, cart]
2025-08-08 04:42:39.604 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Products/1/images - multipart/form-data; boundary=--------------------------487819215979114865848042 341526
2025-08-08 04:42:39.611 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:42:39.619 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:42:39.624 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductController.AddProductImages (E-Commerce)'
2025-08-08 04:42:39.631 +03:00 [INF] Route matched with {action = "AddProductImages", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]]] AddProductImages(Int32, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller E_Commerce.Controllers.ProductController (E-Commerce).
2025-08-08 04:42:39.668 +03:00 [INF] Adding images to product: 1
2025-08-08 04:42:39.676 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL)
2025-08-08 04:42:39.684 +03:00 [INF] 📥 Saving 1 images to ProductPhotos
2025-08-08 04:42:39.689 +03:00 [INF] 📥 Saving image to ProductPhotos
2025-08-08 04:42:39.696 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:42:39.699 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:42:39.706 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:42:39.718 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:42:39.721 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:42:39.722 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:42:39.723 +03:00 [INF] ✅ Image saved: /ProductPhotos/a39a3a77-f522-4a82-bbcb-67b8ce79a946.jpg
2025-08-08 04:42:39.732 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:42:39.735 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:42:39.736 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:42:39.739 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime), @p8='?' (Size = 255), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:42:39.768 +03:00 [INF] Successfully added 1 images to product 1
2025-08-08 04:42:39.771 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:42:39.780 +03:00 [INF] Executed action E_Commerce.Controllers.ProductController.AddProductImages (E-Commerce) in 144.0882ms
2025-08-08 04:42:39.783 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductController.AddProductImages (E-Commerce)'
2025-08-08 04:42:39.786 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Products/1/images - 201 234 application/json; charset=utf-8 182.419ms
2025-08-08 04:42:44.238 +03:00 [INF] Removing cache by tags: [product_search, categorywithdata, productwithvariantdata]
2025-08-08 04:42:44.254 +03:00 [WRN] No cache entries found for tags: [product_search, categorywithdata, productwithvariantdata]
2025-08-08 04:43:20.321 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Products/1/Variants - application/json 87
2025-08-08 04:43:20.338 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:43:20.351 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:43:20.362 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce)'
2025-08-08 04:43:20.374 +03:00 [INF] Route matched with {action = "CreateVariant", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] CreateVariant(Int32, E_Commerce.DtoModels.ProductDtos.CreateProductVariantDto) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-08 04:43:20.607 +03:00 [INF] Adding variant to product: 1
2025-08-08 04:43:20.650 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL)
2025-08-08 04:43:20.658 +03:00 [INF] Checking if variant with color=string, size=XXL, waist=60, length=166 already exists for product 1
2025-08-08 04:43:20.689 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `ProductVariants` AS `p`
    WHERE `p`.`ProductId` = @__productid_0)
2025-08-08 04:43:20.697 +03:00 [WRN] Attempt to add duplicate variant for product 1 with color=string, size=XXL
2025-08-08 04:43:20.704 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:43:20.717 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce) in 315.3116ms
2025-08-08 04:43:20.719 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce)'
2025-08-08 04:43:20.721 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Products/1/Variants - 400 290 application/json; charset=utf-8 400.0729ms
2025-08-08 04:43:32.638 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Products/1/Variants - application/json 87
2025-08-08 04:43:32.644 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:43:32.649 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:43:32.655 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce)'
2025-08-08 04:43:32.656 +03:00 [INF] Route matched with {action = "CreateVariant", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] CreateVariant(Int32, E_Commerce.DtoModels.ProductDtos.CreateProductVariantDto) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-08 04:43:32.661 +03:00 [INF] Adding variant to product: 1
2025-08-08 04:43:32.664 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL)
2025-08-08 04:43:32.672 +03:00 [INF] Checking if variant with color=string, size=XXL, waist=61, length=166 already exists for product 1
2025-08-08 04:43:32.674 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `ProductVariants` AS `p`
    WHERE `p`.`ProductId` = @__productid_0)
2025-08-08 04:43:32.678 +03:00 [WRN] Attempt to add duplicate variant for product 1 with color=string, size=XXL
2025-08-08 04:43:32.679 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:43:32.683 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce) in 23.4338ms
2025-08-08 04:43:32.686 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce)'
2025-08-08 04:43:32.688 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Products/1/Variants - 400 290 application/json; charset=utf-8 50.216ms
2025-08-08 04:44:23.988 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 04:44:31.937 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:44:31.955 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 18.5372ms
2025-08-08 04:44:32.018 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:44:32.018 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:44:32.019 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:44:32.065 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 47.4794ms
2025-08-08 04:44:32.070 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 51.9003ms
2025-08-08 04:44:32.100 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.0168ms
2025-08-08 04:44:32.202 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:44:32.404 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 201.8531ms
2025-08-08 04:44:35.904 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Products/1/Variants - application/json 87
2025-08-08 04:44:35.913 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:44:36.018 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:44:36.107 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce)'
2025-08-08 04:44:36.124 +03:00 [INF] Route matched with {action = "CreateVariant", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] CreateVariant(Int32, E_Commerce.DtoModels.ProductDtos.CreateProductVariantDto) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-08 04:44:36.176 +03:00 [INF] Adding variant to product: 1
2025-08-08 04:44:36.180 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL)
2025-08-08 04:44:36.184 +03:00 [INF] Checking if variant with color=string, size=XXL, waist=61, length=166 already exists for product 1
2025-08-08 04:44:36.188 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `ProductVariants` AS `p`
    WHERE `p`.`ProductId` = @__productid_0)
2025-08-08 04:44:36.199 +03:00 [INF] Executing CreateAsync for entity ProductVariant
2025-08-08 04:44:36.275 +03:00 [INF] ProductVariant added successfully (pending save)
2025-08-08 04:44:36.303 +03:00 [INF] Updating product 1 quantity after adding variant
2025-08-08 04:44:36.438 +03:00 [INF] Recording admin operation for adding variant to product 1 by user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:44:36.439 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-08 04:44:36.440 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:44:36.447 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:44:36.448 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:44:36.450 +03:00 [INF] Committing transaction for adding variant to product 1
2025-08-08 04:44:36.474 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `ProductVariants` (`Color`, `CreatedAt`, `DeletedAt`, `IsActive`, `Length`, `ModifiedAt`, `ProductId`, `Quantity`, `Size`, `Waist`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `ProductVariants`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:44:36.486 +03:00 [INF] Successfully added variant to product 1
2025-08-08 04:44:36.492 +03:00 [INF] Removing product caches after adding variant to product 1
2025-08-08 04:44:36.524 +03:00 [INF] Successfully completed adding variant (ID: 1) to product 1
2025-08-08 04:44:36.526 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:44:36.533 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce) in 402.9058ms
2025-08-08 04:44:36.538 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.CreateVariant (E-Commerce)'
2025-08-08 04:44:36.541 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Products/1/Variants - 201 305 application/json; charset=utf-8 637.3143ms
2025-08-08 04:44:44.441 +03:00 [INF] Removing cache by tags: [productwithvariantdata, product_search, variantdata]
2025-08-08 04:44:44.446 +03:00 [WRN] No cache entries found for tags: [productwithvariantdata, product_search, variantdata]
2025-08-08 04:44:57.815 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/activate - null 0
2025-08-08 04:44:57.827 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:44:57.832 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:44:57.839 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce)'
2025-08-08 04:44:57.847 +03:00 [INF] Route matched with {action = "ActiveProduct", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] ActiveProduct(Int32) on controller E_Commerce.Controllers.ProductController (E-Commerce).
2025-08-08 04:44:57.869 +03:00 [INF] Execute GetAll for entity Product
2025-08-08 04:44:57.922 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IsActive`, `p`.`DeletedAt` IS NOT NULL AS `isdeleted`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`, EXISTS (
    SELECT 1
    FROM `ProductVariants` AS `p0`
    WHERE (`p`.`Id` = `p0`.`ProductId`) AND (`p0`.`IsActive` AND (`p0`.`DeletedAt` IS NULL))) AS `HasActiveVariants`
FROM `Products` AS `p`
WHERE `p`.`Id` = @__productId_0
LIMIT 1
2025-08-08 04:44:57.934 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
FROM `Products` AS `p`
WHERE ((`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL) AND NOT (`p`.`IsActive`)
LIMIT 1
2025-08-08 04:44:57.939 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:44:57.940 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:44:57.941 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:44:57.953 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Boolean), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `IsActive` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:44:57.984 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:44:57.990 +03:00 [INF] Executed action E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce) in 135.5894ms
2025-08-08 04:44:57.992 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce)'
2025-08-08 04:44:57.995 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/activate - 200 133 application/json; charset=utf-8 179.9621ms
2025-08-08 04:45:04.481 +03:00 [INF] Removing cache by tags: [product_search, categorywithdata, productwithvariantdata, CollectionWithProduct, cart]
2025-08-08 04:45:04.484 +03:00 [WRN] No cache entries found for tags: [product_search, categorywithdata, productwithvariantdata, CollectionWithProduct, cart]
2025-08-08 04:45:22.209 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/activate - null 0
2025-08-08 04:45:22.215 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:45:22.220 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:45:22.226 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce)'
2025-08-08 04:45:22.237 +03:00 [INF] Route matched with {action = "Activate", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Activate(Int32) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:45:22.245 +03:00 [INF] Executing Activate for id: 1
2025-08-08 04:45:22.251 +03:00 [INF] Activating subcategory 1
2025-08-08 04:45:22.253 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-08 04:45:22.271 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__subCategoryId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `s`.`IsActive`, EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`s`.`Id` = `p`.`SubCategoryId`) AND (`p`.`IsActive` AND (`p`.`DeletedAt` IS NULL))) AS `HasActiveProduct`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`s`.`Id` = `i`.`SubCategoryId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`
FROM `SubCategories` AS `s`
WHERE (`s`.`Id` = @__subCategoryId_0) AND `s`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 04:45:22.281 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:45:22.283 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce) in 41.0884ms
2025-08-08 04:45:22.287 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce)'
2025-08-08 04:45:22.289 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/activate - 400 350 application/json; charset=utf-8 79.5856ms
2025-08-08 04:45:41.924 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/subcategories/1 - null null
2025-08-08 04:45:41.938 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:45:41.943 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:45:41.949 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce)'
2025-08-08 04:45:41.956 +03:00 [INF] Route matched with {action = "GetById", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.SubCategorydto.SubCategoryDtoWithData]]] GetById(Int32, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:45:41.964 +03:00 [INF] Executing GetById for id: 1
2025-08-08 04:45:41.969 +03:00 [INF] Execute: GetSubCategoryByIdAsync in services for id: 1, isActive: , isDeleted: 
2025-08-08 04:45:41.973 +03:00 [INF] Getting cache for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:45:41.981 +03:00 [WRN] Cache miss for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:45:41.985 +03:00 [INF] Executing privateGetSubCategoryByIdAsync for id: 1
2025-08-08 04:45:41.986 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-08 04:45:42.067 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-08-08 04:45:42.142 +03:00 [INF] Executed DbCommand (60ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`ModifiedAt`, `t`.`DeletedAt`, `t`.`Description`, `t0`.`Id`, `t0`.`IsMain`, `t0`.`Url`, `t1`.`Id`, `t1`.`Name`, `t1`.`Description`, `t1`.`Quantity`, `t1`.`Gender`, `t1`.`SubCategoryId`, `t1`.`Price`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`DeletedAt`, `t1`.`c`, `t1`.`fitType`, `t1`.`Id0`, `t1`.`Id1`, `t1`.`Url`, `t1`.`c0`, `t1`.`c1`, `t1`.`c2`, `t1`.`IsActive`
FROM (
    SELECT `s`.`Id`, `s`.`Name`, `s`.`IsActive`, `s`.`CreatedAt`, `s`.`ModifiedAt`, `s`.`DeletedAt`, `s`.`Description`
    FROM `SubCategories` AS `s`
    WHERE `s`.`Id` = @__id_0
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `i`.`Id`, `i`.`IsMain`, `i`.`Url`, `i`.`SubCategoryId`
    FROM `Images` AS `i`
    WHERE `i`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`SubCategoryId`
LEFT JOIN (
    SELECT `p`.`Id`, `p`.`Name`, `p`.`Description`, `p`.`Quantity`, `p`.`Gender`, `p`.`SubCategoryId`, `p`.`Price`, `p`.`CreatedAt`, `p`.`ModifiedAt`, `p`.`DeletedAt`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`))
        ELSE `p`.`Price`
    END AS `c`, `p`.`fitType`, `d`.`Id` AS `Id0`, `t2`.`Id` AS `Id1`, `t2`.`Url`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP())) AND `d`.`IsActive` THEN `d`.`EndDate`
        ELSE NULL
    END AS `c0`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `c1`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `c2`, `p`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN (
        SELECT `i0`.`Id`, `i0`.`Url`, `i0`.`ProductId`
        FROM `Images` AS `i0`
        WHERE `i0`.`DeletedAt` IS NULL
    ) AS `t2` ON `p`.`Id` = `t2`.`ProductId`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t1` ON `t`.`Id` = `t1`.`SubCategoryId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t1`.`Id`, `t1`.`Id0`
2025-08-08 04:45:42.160 +03:00 [INF] Category with id: 1 exists
2025-08-08 04:45:42.201 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.SubCategorydto.SubCategoryDtoWithData, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:45:42.209 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce) in 249.1588ms
2025-08-08 04:45:42.211 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce)'
2025-08-08 04:45:42.214 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/subcategories/1 - 200 1449 application/json; charset=utf-8 289.7785ms
2025-08-08 04:45:44.606 +03:00 [INF] Setting cache for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:45:44.661 +03:00 [INF] Cache set successfully for key: subcategorydataid:1_active:_deleted: with tags: [subcategorydata]
2025-08-08 04:45:44.698 +03:00 [INF] Execution Worker recovered from the Faulted state after 00:00:40.1657408 and is in the Running state now
2025-08-08 04:47:46.035 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 04:47:48.879 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 04:47:49.609 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:47:49.626 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 04:47:49.672 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 04:47:49.716 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 04:47:49.773 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 04:47:50.699 +03:00 [INF] Executed DbCommand (67ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:47:50.882 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 04:47:50.936 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 04:47:52.375 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 04:47:52.583 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 04:47:52.748 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 04:47:52.751 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 04:47:52.752 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 04:47:52.754 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 04:47:52.813 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 04:47:52.846 +03:00 [INF] Hosting environment: Development
2025-08-08 04:47:52.849 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 04:47:52.879 +03:00 [INF] Server mrrobot:10016:be1eb8c7 successfully announced in 28.2284 ms
2025-08-08 04:47:52.910 +03:00 [INF] Server mrrobot:10016:be1eb8c7 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 04:47:54.055 +03:00 [INF] Server mrrobot:10016:be1eb8c7 all the dispatchers started
2025-08-08 04:47:54.131 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:47:54.724 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:47:54.724 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:47:54.752 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:47:54.757 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 833.8337ms
2025-08-08 04:47:54.842 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 120.593ms
2025-08-08 04:47:54.847 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 122.7659ms
2025-08-08 04:47:54.947 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 194.1672ms
2025-08-08 04:47:55.007 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:47:55.427 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 419.5431ms
2025-08-08 04:48:04.715 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/activate - null 0
2025-08-08 04:48:04.733 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 04:48:05.364 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:48:05.463 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:48:05.520 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce)'
2025-08-08 04:48:05.568 +03:00 [INF] Route matched with {action = "Activate", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Activate(Int32) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:48:06.195 +03:00 [INF] Executing Activate for id: 1
2025-08-08 04:48:06.242 +03:00 [INF] Activating subcategory 1
2025-08-08 04:48:06.244 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-08 04:48:06.441 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__subCategoryId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `s`.`IsActive`, EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`s`.`Id` = `p`.`SubCategoryId`) AND (`p`.`IsActive` AND (`p`.`DeletedAt` IS NULL))) AS `HasActiveProduct`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`s`.`Id` = `i`.`SubCategoryId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`
FROM `SubCategories` AS `s`
WHERE (`s`.`Id` = @__subCategoryId_0) AND `s`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 04:48:44.020 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:48:44.095 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce) in 38517.8615ms
2025-08-08 04:48:44.098 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce)'
2025-08-08 04:48:44.116 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/activate - 400 350 application/json; charset=utf-8 39401.1716ms
2025-08-08 04:49:10.471 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/subcategories?page=1&pageSize=10 - null null
2025-08-08 04:49:10.497 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:49:10.535 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:49:10.542 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.GetAll (E-Commerce)'
2025-08-08 04:49:10.556 +03:00 [INF] Route matched with {action = "GetAll", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:49:10.580 +03:00 [INF] Executing GetAll with isActive=, isDeleted=, page=1, pageSize=10
2025-08-08 04:49:10.586 +03:00 [INF] Executing GetAllSubCategoriesAsync in SubCategoryService with isActive: , isDeleted: , page: 1, pageSize: 10
2025-08-08 04:49:10.590 +03:00 [INF] Getting cache for key: subcategory_all___1_10
2025-08-08 04:49:10.604 +03:00 [WRN] Cache miss for key: subcategory_all___1_10
2025-08-08 04:49:10.607 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-08 04:49:10.779 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`ModifiedAt`, `t`.`DeletedAt`, `t`.`Description`, `t0`.`Id`, `t0`.`Url`
FROM (
    SELECT `s`.`Id`, `s`.`Name`, `s`.`IsActive`, `s`.`CreatedAt`, `s`.`ModifiedAt`, `s`.`DeletedAt`, `s`.`Description`
    FROM `SubCategories` AS `s`
    ORDER BY `s`.`Id`
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
LEFT JOIN (
    SELECT `i`.`Id`, `i`.`Url`, `i`.`SubCategoryId`
    FROM `Images` AS `i`
    WHERE `i`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`SubCategoryId`
ORDER BY `t`.`Id`
2025-08-08 04:49:10.963 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.Services.Result`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.SubCategorydto.SubCategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:49:10.973 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.GetAll (E-Commerce) in 411.7036ms
2025-08-08 04:49:10.975 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.GetAll (E-Commerce)'
2025-08-08 04:49:10.977 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/subcategories?page=1&pageSize=10 - 200 273 application/json; charset=utf-8 507.7524ms
2025-08-08 04:49:14.993 +03:00 [INF] Setting cache for key: subcategory_all___1_10
2025-08-08 04:49:15.062 +03:00 [INF] Cache set successfully for key: subcategory_all___1_10 with tags: [subcategory]
2025-08-08 04:50:00.602 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - multipart/form-data; boundary=--------------------------693065848730182812893511 341525
2025-08-08 04:50:00.627 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:50:00.633 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:50:00.641 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:50:00.653 +03:00 [INF] Route matched with {action = "AddMainImage", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImage(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:50:00.827 +03:00 [INF] Executing AddMainImage for id: 1
2025-08-08 04:50:00.832 +03:00 [INF] Executing AddMainImageToSubCategoryAsync for subCategoryId: 1
2025-08-08 04:50:00.842 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE (`s`.`Id` = @__id_0) AND `s`.`DeletedAt` IS NULL)
2025-08-08 04:50:00.863 +03:00 [INF] 📥 Saving main image to SubCategoryPhotos
2025-08-08 04:50:04.460 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:50:05.096 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:50:05.651 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:50:05.943 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:50:05.950 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:50:06.016 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:50:06.028 +03:00 [INF] ✅ Main image saved: /SubCategoryPhotos/e427dd6c-5fd4-44d0-a2b8-90fd75f751fa.jpg
2025-08-08 04:50:06.030 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:50:06.034 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:50:06.045 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:50:06.128 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime), @p8='?' (Size = 255), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:50:06.217 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:50:06.231 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce) in 5569.8229ms
2025-08-08 04:50:06.262 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:50:06.294 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - 200 955 application/json; charset=utf-8 5692.3879ms
2025-08-08 04:50:14.841 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/subcategories/1 - null null
2025-08-08 04:50:14.848 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:50:14.854 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:50:14.865 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce)'
2025-08-08 04:50:14.888 +03:00 [INF] Route matched with {action = "GetById", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.SubCategorydto.SubCategoryDtoWithData]]] GetById(Int32, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:50:14.895 +03:00 [INF] Executing GetById for id: 1
2025-08-08 04:50:14.900 +03:00 [INF] Execute: GetSubCategoryByIdAsync in services for id: 1, isActive: , isDeleted: 
2025-08-08 04:50:14.906 +03:00 [INF] Getting cache for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:50:14.911 +03:00 [INF] Cache hit for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:50:14.969 +03:00 [INF] Cache hit for subcategory 1 with filters
2025-08-08 04:50:14.974 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.SubCategorydto.SubCategoryDtoWithData, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:50:15.000 +03:00 [INF] Removing cache by tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:50:15.003 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce) in 111.9495ms
2025-08-08 04:50:15.005 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce)'
2025-08-08 04:50:15.012 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/subcategories/1 - 200 1458 application/json; charset=utf-8 170.8726ms
2025-08-08 04:50:15.018 +03:00 [INF] Removed 2 cache entries for tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:51:21.874 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/subcategories/1 - null null
2025-08-08 04:51:21.881 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:51:21.886 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:51:21.890 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce)'
2025-08-08 04:51:21.892 +03:00 [INF] Route matched with {action = "GetById", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.SubCategorydto.SubCategoryDtoWithData]]] GetById(Int32, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:51:21.896 +03:00 [INF] Executing GetById for id: 1
2025-08-08 04:51:21.897 +03:00 [INF] Execute: GetSubCategoryByIdAsync in services for id: 1, isActive: , isDeleted: 
2025-08-08 04:51:21.899 +03:00 [INF] Getting cache for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:51:21.901 +03:00 [WRN] Cache miss for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:51:21.905 +03:00 [INF] Executing privateGetSubCategoryByIdAsync for id: 1
2025-08-08 04:51:21.907 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-08 04:51:21.990 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-08-08 04:51:22.053 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`ModifiedAt`, `t`.`DeletedAt`, `t`.`Description`, `t0`.`Id`, `t0`.`IsMain`, `t0`.`Url`, `t1`.`Id`, `t1`.`Name`, `t1`.`Description`, `t1`.`Quantity`, `t1`.`Gender`, `t1`.`SubCategoryId`, `t1`.`Price`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`DeletedAt`, `t1`.`c`, `t1`.`fitType`, `t1`.`Id0`, `t1`.`Id1`, `t1`.`Url`, `t1`.`c0`, `t1`.`c1`, `t1`.`c2`, `t1`.`IsActive`
FROM (
    SELECT `s`.`Id`, `s`.`Name`, `s`.`IsActive`, `s`.`CreatedAt`, `s`.`ModifiedAt`, `s`.`DeletedAt`, `s`.`Description`
    FROM `SubCategories` AS `s`
    WHERE `s`.`Id` = @__id_0
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `i`.`Id`, `i`.`IsMain`, `i`.`Url`, `i`.`SubCategoryId`
    FROM `Images` AS `i`
    WHERE `i`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`SubCategoryId`
LEFT JOIN (
    SELECT `p`.`Id`, `p`.`Name`, `p`.`Description`, `p`.`Quantity`, `p`.`Gender`, `p`.`SubCategoryId`, `p`.`Price`, `p`.`CreatedAt`, `p`.`ModifiedAt`, `p`.`DeletedAt`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`))
        ELSE `p`.`Price`
    END AS `c`, `p`.`fitType`, `d`.`Id` AS `Id0`, `t2`.`Id` AS `Id1`, `t2`.`Url`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP())) AND `d`.`IsActive` THEN `d`.`EndDate`
        ELSE NULL
    END AS `c0`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `c1`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `c2`, `p`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN (
        SELECT `i0`.`Id`, `i0`.`Url`, `i0`.`ProductId`
        FROM `Images` AS `i0`
        WHERE `i0`.`DeletedAt` IS NULL
    ) AS `t2` ON `p`.`Id` = `t2`.`ProductId`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t1` ON `t`.`Id` = `t1`.`SubCategoryId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t1`.`Id`, `t1`.`Id0`
2025-08-08 04:51:22.063 +03:00 [INF] Category with id: 1 exists
2025-08-08 04:51:22.098 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.SubCategorydto.SubCategoryDtoWithData, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:51:22.100 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce) in 205.6772ms
2025-08-08 04:51:22.103 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.GetById (E-Commerce)'
2025-08-08 04:51:22.107 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/subcategories/1 - 200 1449 application/json; charset=utf-8 233.3919ms
2025-08-08 04:51:25.112 +03:00 [INF] Setting cache for key: subcategorydataid:1_active:_deleted:
2025-08-08 04:51:25.133 +03:00 [INF] Cache set successfully for key: subcategorydataid:1_active:_deleted: with tags: [subcategorydata]
2025-08-08 04:51:32.746 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - multipart/form-data; boundary=--------------------------366416588732536008487636 341525
2025-08-08 04:51:32.755 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:51:32.760 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:51:32.769 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:51:32.772 +03:00 [INF] Route matched with {action = "AddMainImage", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImage(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:51:32.788 +03:00 [INF] Executing AddMainImage for id: 1
2025-08-08 04:51:32.789 +03:00 [INF] Executing AddMainImageToSubCategoryAsync for subCategoryId: 1
2025-08-08 04:51:32.793 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE (`s`.`Id` = @__id_0) AND `s`.`DeletedAt` IS NULL)
2025-08-08 04:51:32.806 +03:00 [INF] 📥 Saving main image to SubCategoryPhotos
2025-08-08 04:51:37.201 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:51:37.279 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:51:37.284 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:51:37.293 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:51:37.294 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:51:37.296 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:51:37.297 +03:00 [INF] ✅ Main image saved: /SubCategoryPhotos/7720b3a1-616f-4555-8475-95634b530965.jpg
2025-08-08 04:51:37.300 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:51:37.310 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:51:37.311 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:51:37.314 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime), @p8='?' (Size = 255), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:51:37.351 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:51:37.354 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce) in 4578.6924ms
2025-08-08 04:51:37.363 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:51:37.366 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - 200 955 application/json; charset=utf-8 4619.4377ms
2025-08-08 04:51:47.281 +03:00 [INF] Removing cache by tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:51:47.307 +03:00 [INF] Removed 1 cache entries for tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:52:36.327 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:52:36.416 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 89.4409ms
2025-08-08 04:52:36.506 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:52:36.510 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:52:36.511 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:52:36.625 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 115.1969ms
2025-08-08 04:52:36.648 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 142.1872ms
2025-08-08 04:52:36.654 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 143.4326ms
2025-08-08 04:52:36.735 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:52:37.004 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 269.2824ms
2025-08-08 04:52:41.495 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - multipart/form-data; boundary=--------------------------610858402522431788073415 341525
2025-08-08 04:52:41.502 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:52:41.508 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:52:41.512 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:52:41.519 +03:00 [INF] Route matched with {action = "AddMainImage", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImage(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:52:41.534 +03:00 [INF] Executing AddMainImage for id: 1
2025-08-08 04:52:41.535 +03:00 [INF] Executing AddMainImageToSubCategoryAsync for subCategoryId: 1
2025-08-08 04:52:41.542 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE (`s`.`Id` = @__id_0) AND `s`.`DeletedAt` IS NULL)
2025-08-08 04:52:41.552 +03:00 [INF] 📥 Saving main image to SubCategoryPhotos
2025-08-08 04:52:41.570 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:52:41.575 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:52:41.584 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:52:41.591 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:52:41.593 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:52:41.595 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:52:41.596 +03:00 [INF] ✅ Main image saved: /SubCategoryPhotos/654c769e-995c-4a6b-8e79-e79c2446b75c.jpg
2025-08-08 04:52:41.598 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:52:41.601 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:52:41.603 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:52:41.718 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime), @p8='?' (Size = 255), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:52:41.812 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:52:41.813 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce) in 287.7968ms
2025-08-08 04:52:41.819 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.AddMainImage (E-Commerce)'
2025-08-08 04:52:41.821 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/subcategories/1/images/main - 200 955 application/json; charset=utf-8 325.7036ms
2025-08-08 04:52:47.511 +03:00 [INF] Removing cache by tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:52:47.582 +03:00 [WRN] No cache entries found for tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:52:52.608 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/subcategories?page=1&pageSize=10 - null null
2025-08-08 04:52:52.620 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:52:52.634 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:52:52.638 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.GetAll (E-Commerce)'
2025-08-08 04:52:52.650 +03:00 [INF] Route matched with {action = "GetAll", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:52:52.660 +03:00 [INF] Executing GetAll with isActive=, isDeleted=, page=1, pageSize=10
2025-08-08 04:52:52.661 +03:00 [INF] Executing GetAllSubCategoriesAsync in SubCategoryService with isActive: , isDeleted: , page: 1, pageSize: 10
2025-08-08 04:52:52.662 +03:00 [INF] Getting cache for key: subcategory_all___1_10
2025-08-08 04:52:52.667 +03:00 [WRN] Cache miss for key: subcategory_all___1_10
2025-08-08 04:52:52.669 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-08 04:52:52.703 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`ModifiedAt`, `t`.`DeletedAt`, `t`.`Description`, `t0`.`Id`, `t0`.`Url`
FROM (
    SELECT `s`.`Id`, `s`.`Name`, `s`.`IsActive`, `s`.`CreatedAt`, `s`.`ModifiedAt`, `s`.`DeletedAt`, `s`.`Description`
    FROM `SubCategories` AS `s`
    ORDER BY `s`.`Id`
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
LEFT JOIN (
    SELECT `i`.`Id`, `i`.`Url`, `i`.`SubCategoryId`
    FROM `Images` AS `i`
    WHERE `i`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`SubCategoryId`
ORDER BY `t`.`Id`
2025-08-08 04:52:52.733 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.Services.Result`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.SubCategorydto.SubCategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:52:52.737 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.GetAll (E-Commerce) in 81.9777ms
2025-08-08 04:52:52.745 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.GetAll (E-Commerce)'
2025-08-08 04:52:52.747 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/subcategories?page=1&pageSize=10 - 200 385 application/json; charset=utf-8 139.3263ms
2025-08-08 04:52:53.251 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 04:52:57.542 +03:00 [INF] Setting cache for key: subcategory_all___1_10
2025-08-08 04:52:57.557 +03:00 [INF] Cache set successfully for key: subcategory_all___1_10 with tags: [subcategory]
2025-08-08 04:53:00.039 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/activate - null 0
2025-08-08 04:53:00.052 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:53:00.076 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:53:00.115 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce)'
2025-08-08 04:53:00.126 +03:00 [INF] Route matched with {action = "Activate", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Activate(Int32) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-08 04:53:00.155 +03:00 [INF] Executing Activate for id: 1
2025-08-08 04:53:00.164 +03:00 [INF] Activating subcategory 1
2025-08-08 04:53:00.166 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-08 04:53:00.171 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__subCategoryId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `s`.`IsActive`, EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`s`.`Id` = `p`.`SubCategoryId`) AND (`p`.`IsActive` AND (`p`.`DeletedAt` IS NULL))) AS `HasActiveProduct`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`s`.`Id` = `i`.`SubCategoryId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`
FROM `SubCategories` AS `s`
WHERE (`s`.`Id` = @__subCategoryId_0) AND `s`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 04:53:03.330 +03:00 [INF] Executing GetByIdAsync for entity SubCategory with ID: 1
2025-08-08 04:53:03.351 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `s`.`Id`, `s`.`CategoryId`, `s`.`CreatedAt`, `s`.`DeletedAt`, `s`.`Description`, `s`.`IsActive`, `s`.`ModifiedAt`, `s`.`Name`
FROM `SubCategories` AS `s`
WHERE `s`.`Id` = @__id_0
LIMIT 1
2025-08-08 04:53:03.436 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `SubCategories` SET `IsActive` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 04:53:03.475 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:53:03.477 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce) in 3323.0093ms
2025-08-08 04:53:03.483 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.Activate (E-Commerce)'
2025-08-08 04:53:03.485 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/activate - 200 216 application/json; charset=utf-8 3445.5547ms
2025-08-08 04:53:07.575 +03:00 [INF] Removing cache by tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:53:07.585 +03:00 [INF] Removed 1 cache entries for tags: [subcategorydata, categorywithdata, subcategory]
2025-08-08 04:53:39.067 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/categories/2/activate - null 0
2025-08-08 04:53:39.073 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:53:39.079 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:53:39.086 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.ActivateCategoryAsync (E-Commerce)'
2025-08-08 04:53:39.095 +03:00 [INF] Route matched with {action = "ActivateCategoryAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] ActivateCategoryAsync(Int32) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:53:39.113 +03:00 [INF] Executing ActivateCategoryAsync for id: 2
2025-08-08 04:53:39.131 +03:00 [INF] [ActivateCategory] Start activation for CategoryId: 2
2025-08-08 04:53:39.136 +03:00 [INF] Execute GetAll for entity Category
2025-08-08 04:53:39.154 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__categoryId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`IsActive`, EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE (`c`.`Id` = `s`.`CategoryId`) AND (`s`.`IsActive` AND (`s`.`DeletedAt` IS NULL))) AS `HasActiveSubCategories`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`c`.`Id` = `i`.`CategoryId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`
FROM `Categories` AS `c`
WHERE (`c`.`Id` = @__categoryId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 04:53:39.163 +03:00 [WRN] [ActivateCategory] Category 2 has no active images.
2025-08-08 04:53:39.185 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:53:39.189 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.ActivateCategoryAsync (E-Commerce) in 86.8498ms
2025-08-08 04:53:39.193 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.ActivateCategoryAsync (E-Commerce)'
2025-08-08 04:53:39.198 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/categories/2/activate - 400 1183 application/json; charset=utf-8 131.2168ms
2025-08-08 04:53:47.132 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - multipart/form-data; boundary=--------------------------631585535680176851172366 341525
2025-08-08 04:53:47.141 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:53:47.149 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:53:47.155 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:53:47.164 +03:00 [INF] Route matched with {action = "AddMainImageAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ImagesDtos.ImageDto]]] AddMainImageAsync(Int32, E_Commerce.DtoModels.CategoryDtos.AddMainImageDto) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:53:47.184 +03:00 [INF] Executing AddMainImageAsync for id: 2
2025-08-08 04:53:47.192 +03:00 [INF] Executing AddMainImageToCategoryAsync for categoryId: 2
2025-08-08 04:53:47.201 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Categories` AS `c`
    WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:53:51.103 +03:00 [INF] 📥 Saving main image to CategoryPhotos
2025-08-08 04:53:51.186 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-08 04:53:51.196 +03:00 [INF] Image added successfully (pending save)
2025-08-08 04:53:51.212 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:53:51.221 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:53:51.237 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:53:51.239 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:53:51.269 +03:00 [INF] ✅ Main image saved: /CategoryPhotos/2e2ce570-7c61-44bf-ab5d-b6385823d220.jpg
2025-08-08 04:53:51.455 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:53:51.766 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ImagesDtos.ImageDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:53:51.949 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce) in 4780.4726ms
2025-08-08 04:53:52.849 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.AddMainImageAsync (E-Commerce)'
2025-08-08 04:53:53.002 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/categories/2/images/main - 200 1093 application/json; charset=utf-8 5869.8818ms
2025-08-08 04:53:59.642 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/categories/2/activate - null 0
2025-08-08 04:53:59.654 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:53:59.666 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:53:59.672 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.ActivateCategoryAsync (E-Commerce)'
2025-08-08 04:53:59.673 +03:00 [INF] Route matched with {action = "ActivateCategoryAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] ActivateCategoryAsync(Int32) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-08 04:53:59.681 +03:00 [INF] Executing ActivateCategoryAsync for id: 2
2025-08-08 04:53:59.687 +03:00 [INF] [ActivateCategory] Start activation for CategoryId: 2
2025-08-08 04:53:59.690 +03:00 [INF] Execute GetAll for entity Category
2025-08-08 04:53:59.694 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__categoryId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`IsActive`, EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE (`c`.`Id` = `s`.`CategoryId`) AND (`s`.`IsActive` AND (`s`.`DeletedAt` IS NULL))) AS `HasActiveSubCategories`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`c`.`Id` = `i`.`CategoryId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`
FROM `Categories` AS `c`
WHERE (`c`.`Id` = @__categoryId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 04:53:59.704 +03:00 [INF] Activating category with ID: 2
2025-08-08 04:53:59.714 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__categoryId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`
FROM `Categories` AS `c`
WHERE (`c`.`Id` = @__categoryId_0) AND NOT (`c`.`IsActive`)
LIMIT 1
2025-08-08 04:53:59.756 +03:00 [INF] Category 2 set to active. Saving...
2025-08-08 04:53:59.758 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:53:59.759 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:53:59.761 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:53:59.779 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Boolean), @p1='?' (DbType = DateTime), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = DateTime), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Categories` SET `IsActive` = @p0, `ModifiedAt` = @p1
WHERE `Id` = @p2;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:53:59.806 +03:00 [INF] [ActivateCategory] Category 2 activated successfully.
2025-08-08 04:53:59.812 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:53:59.815 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.ActivateCategoryAsync (E-Commerce) in 135.3282ms
2025-08-08 04:53:59.817 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.ActivateCategoryAsync (E-Commerce)'
2025-08-08 04:53:59.820 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/categories/2/activate - 200 1052 application/json; charset=utf-8 177.6713ms
2025-08-08 04:54:01.167 +03:00 [INF] Removing cache by tags: [category, categorywithdata]
2025-08-08 04:54:01.168 +03:00 [INF] Removing cache by tags: [category, categorywithdata]
2025-08-08 04:54:01.172 +03:00 [WRN] No cache entries found for tags: [category, categorywithdata]
2025-08-08 04:54:01.174 +03:00 [WRN] No cache entries found for tags: [category, categorywithdata]
2025-08-08 04:54:34.171 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-08-08 04:54:34.177 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:54:34.184 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:54:34.191 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 04:54:34.202 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 04:54:34.594 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-08 04:54:34.734 +03:00 [INF] Adding item to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 04:54:34.886 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 04:54:34.893 +03:00 [INF] Execute GetAll for entity Product
2025-08-08 04:54:34.948 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`, `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Products` AS `p`
LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
LIMIT 1
2025-08-08 04:54:35.020 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-08 04:54:35.033 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 04:54:35.083 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:54:35.215 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 04:54:35.227 +03:00 [INF] Executing CreateAsync for entity Cart
2025-08-08 04:54:35.272 +03:00 [INF] Cart added successfully (pending save)
2025-08-08 04:54:35.512 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Cart` (`CheckoutDate`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT `Id`
FROM `Cart`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:54:35.917 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-08 04:54:35.996 +03:00 [INF] CartItem added successfully (pending save)
2025-08-08 04:54:35.998 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 04:54:35.999 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 04:54:36.003 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 04:54:36.035 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:54:36.054 +03:00 [INF] Removing cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:54:36.058 +03:00 [INF] Cache removed successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:54:36.061 +03:00 [INF] Item added to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 04:54:36.065 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:54:36.068 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 1862.7632ms
2025-08-08 04:54:36.070 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 04:54:36.072 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 1901.3511ms
2025-08-08 04:54:46.425 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-08 04:54:46.432 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:54:46.440 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:54:46.485 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-08 04:54:46.508 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 04:54:46.522 +03:00 [INF] Executing GetCart
2025-08-08 04:54:46.534 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:54:46.536 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:54:46.539 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:54:46.554 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:54:46.559 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 04:54:46.690 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 04:54:46.752 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:54:46.812 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 04:54:46.817 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:54:46.841 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 327.9863ms
2025-08-08 04:54:46.845 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-08 04:54:46.847 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 856 application/json; charset=utf-8 422.1573ms
2025-08-08 04:55:06.200 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 66
2025-08-08 04:55:06.206 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:55:06.210 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:55:06.216 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 04:55:06.222 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 04:55:06.256 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 04:55:06.279 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:06.298 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 04:55:06.317 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-08 04:55:06.321 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:06.322 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:06.326 +03:00 [INF] Cache hit for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:06.351 +03:00 [INF] Cache hit for cart user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:06.370 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:55:06.384 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 155.3827ms
2025-08-08 04:55:06.386 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 04:55:06.388 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 218 application/json; charset=utf-8 187.8361ms
2025-08-08 04:55:26.974 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-08 04:55:26.984 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:55:26.991 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:55:26.997 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 04:55:27.004 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 04:55:27.028 +03:00 [INF] Executing CheckOut
2025-08-08 04:55:27.034 +03:00 [INF] Checkout of cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:27.038 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:27.087 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 04:55:31.252 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 04:55:31.266 +03:00 [INF] Removing cache by tag: cart
2025-08-08 04:55:31.269 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 04:55:31.271 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 04:55:31.276 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 4266.5804ms
2025-08-08 04:55:31.282 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 04:55:31.284 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 4310.876ms
2025-08-08 04:55:40.258 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 66
2025-08-08 04:55:40.270 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:55:40.275 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:55:40.284 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 04:55:40.287 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 04:55:40.292 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 04:55:40.293 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:40.300 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 04:55:40.315 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-08 04:55:40.324 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:40.326 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:40.331 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:40.335 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 04:55:40.343 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 04:55:40.409 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 04:55:40.414 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 04:55:40.418 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 04:55:40.441 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 04:55:40.455 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 04:55:40.553 +03:00 [INF] Order added successfully (pending save)
2025-08-08 04:55:40.616 +03:00 [ERR] Failed executing DbCommand (31ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 04:55:40.771 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`orders`, CONSTRAINT `FK_Orders_CustomerAddresses_CustomerAddressId` FOREIGN KEY (`CustomerAddressId`) REFERENCES `customeraddresses` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`orders`, CONSTRAINT `FK_Orders_CustomerAddresses_CustomerAddressId` FOREIGN KEY (`CustomerAddressId`) REFERENCES `customeraddresses` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-08 04:55:41.381 +03:00 [ERR] Exception while creating order for user 1c431918-0061-41d2-a418-24bd6c056eda
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`orders`, CONSTRAINT `FK_Orders_CustomerAddresses_CustomerAddressId` FOREIGN KEY (`CustomerAddressId`) REFERENCES `customeraddresses` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync()
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto)
2025-08-08 04:55:41.434 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:55:41.437 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 1146.9937ms
2025-08-08 04:55:41.440 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 04:55:41.442 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 1183.8365ms
2025-08-08 04:59:03.612 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:59:03.680 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 69.2231ms
2025-08-08 04:59:03.805 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:59:03.806 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:59:03.810 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:59:03.858 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 52.8629ms
2025-08-08 04:59:03.881 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 75.341ms
2025-08-08 04:59:04.032 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 221.9307ms
2025-08-08 04:59:04.122 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:59:04.486 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 364.5102ms
2025-08-08 04:59:27.252 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 04:59:27.267 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 15.6896ms
2025-08-08 04:59:27.317 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 04:59:27.324 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 04:59:27.345 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 04:59:27.349 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 32.1061ms
2025-08-08 04:59:27.362 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 38.2935ms
2025-08-08 04:59:27.365 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 19.3532ms
2025-08-08 04:59:27.485 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 04:59:27.720 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 235.1271ms
2025-08-08 04:59:51.992 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/CustomerAddress - application/json 202
2025-08-08 04:59:52.010 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 04:59:52.028 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 04:59:52.033 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce)'
2025-08-08 04:59:52.047 +03:00 [INF] Route matched with {action = "CreateAddress", controller = "CustomerAddress"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CustomerAddressDtos.CustomerAddressDto]]] CreateAddress(E_Commerce.DtoModels.CustomerAddressDtos.CreateCustomerAddressDto) on controller E_Commerce.Controllers.CustomerAddressController (E-Commerce).
2025-08-08 04:59:52.115 +03:00 [INF] Executing CreateAddress
2025-08-08 04:59:52.127 +03:00 [WRN] ModelState errors: Invalid phone number format
2025-08-08 04:59:52.130 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CustomerAddressDtos.CustomerAddressDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 04:59:52.138 +03:00 [INF] Executed action E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce) in 86.5091ms
2025-08-08 04:59:52.140 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce)'
2025-08-08 04:59:52.143 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/CustomerAddress - 400 208 application/json; charset=utf-8 150.9886ms
2025-08-08 05:00:02.793 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/CustomerAddress - application/json 207
2025-08-08 05:00:02.803 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:00:02.809 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:00:02.813 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce)'
2025-08-08 05:00:02.815 +03:00 [INF] Route matched with {action = "CreateAddress", controller = "CustomerAddress"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CustomerAddressDtos.CustomerAddressDto]]] CreateAddress(E_Commerce.DtoModels.CustomerAddressDtos.CreateCustomerAddressDto) on controller E_Commerce.Controllers.CustomerAddressController (E-Commerce).
2025-08-08 05:00:02.823 +03:00 [INF] Executing CreateAddress
2025-08-08 05:00:02.841 +03:00 [INF] Creating new address for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:02.854 +03:00 [INF] Getting address count for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:02.924 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__customerId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `CustomerAddresses` AS `c`
WHERE (`c`.`CustomerId` = @__customerId_0) AND `c`.`DeletedAt` IS NULL
2025-08-08 05:00:02.949 +03:00 [INF] Executing CreateAsync for entity CustomerAddress
2025-08-08 05:00:02.998 +03:00 [INF] CustomerAddress added successfully (pending save)
2025-08-08 05:00:03.004 +03:00 [INF] Removing default from other addresses for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:03.018 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__customerId_0='?' (Size = 255), @__excludeAddressId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`
FROM `CustomerAddresses` AS `c`
WHERE (((`c`.`CustomerId` = @__customerId_0) AND (`c`.`Id` <> @__excludeAddressId_1)) AND `c`.`IsDefault`) AND `c`.`DeletedAt` IS NULL
2025-08-08 05:00:03.023 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 05:00:03.025 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 05:00:03.027 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 05:00:03.047 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (Size = 20), @p2='?' (Size = 50), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 255), @p6='?' (DbType = DateTime), @p7='?' (DbType = Boolean), @p8='?' (DbType = DateTime), @p9='?' (Size = 20), @p10='?' (Size = 20), @p11='?' (Size = 50), @p12='?' (Size = 200), @p13='?' (Size = 255), @p14='?' (DbType = DateTime), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime), @p19='?' (DbType = Int32), @p20='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CustomerAddresses` (`AdditionalNotes`, `AddressType`, `City`, `Country`, `CreatedAt`, `CustomerId`, `DeletedAt`, `IsDefault`, `ModifiedAt`, `PhoneNumber`, `PostalCode`, `State`, `StreetAddress`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `Id`
FROM `CustomerAddresses`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:00:03.067 +03:00 [INF] Removing cache by tag: customer_address
2025-08-08 05:00:03.072 +03:00 [WRN] No cache entries found for tag: customer_address
2025-08-08 05:00:03.100 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CustomerAddressDtos.CustomerAddressDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:00:03.119 +03:00 [INF] Executed action E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce) in 298.3273ms
2025-08-08 05:00:03.121 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce)'
2025-08-08 05:00:03.125 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/CustomerAddress - 201 578 application/json; charset=utf-8 332.0809ms
2025-08-08 05:00:24.794 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:00:24.803 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:00:24.808 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:00:24.815 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:00:24.822 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:00:24.838 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:00:24.850 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:24.862 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:00:24.870 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:00:24.892 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:00:24.899 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 70.9284ms
2025-08-08 05:00:24.901 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:00:24.904 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 188 application/json; charset=utf-8 109.9722ms
2025-08-08 05:00:42.043 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-08 05:00:42.059 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:00:42.064 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:00:42.071 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-08 05:00:42.078 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 05:00:42.089 +03:00 [INF] Executing GetCart
2025-08-08 05:00:42.092 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:42.093 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:42.096 +03:00 [INF] Cache hit for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:42.140 +03:00 [INF] Cache hit for cart user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:00:42.141 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:00:42.144 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 56.4142ms
2025-08-08 05:00:42.147 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-08 05:00:42.150 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 878 application/json; charset=utf-8 106.0923ms
2025-08-08 05:01:30.545 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 05:01:43.867 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 05:01:46.350 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:01:46.859 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:01:46.877 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:01:46.924 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:01:46.948 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 05:01:47.007 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 05:01:47.579 +03:00 [INF] Executed DbCommand (67ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:01:47.695 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:01:47.797 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 05:01:49.496 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 05:01:49.971 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 05:01:50.634 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:01:50.664 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 05:01:50.675 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 05:01:50.678 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 05:01:50.679 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 05:01:50.750 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 05:01:50.780 +03:00 [INF] Hosting environment: Development
2025-08-08 05:01:50.781 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 05:01:50.831 +03:00 [INF] Server mrrobot:16016:49fdef37 successfully announced in 35.4782 ms
2025-08-08 05:01:50.846 +03:00 [INF] Server mrrobot:16016:49fdef37 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 05:01:51.594 +03:00 [INF] Server mrrobot:16016:49fdef37 all the dispatchers started
2025-08-08 05:01:51.882 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:01:51.882 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:01:51.882 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:01:51.909 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1363.1579ms
2025-08-08 05:01:51.916 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 36.881ms
2025-08-08 05:01:51.949 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 68.7743ms
2025-08-08 05:01:52.090 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 207.3573ms
2025-08-08 05:01:52.153 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:01:52.458 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 305.2241ms
2025-08-08 05:02:18.314 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:02:18.328 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 05:02:18.748 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:02:18.839 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:02:18.885 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:02:18.942 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:02:19.663 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:02:19.670 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:02:19.775 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:02:19.792 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:02:19.800 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:02:19.809 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:02:19.818 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:02:19.822 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:02:19.840 +03:00 [INF] Cache hit for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:02:19.954 +03:00 [INF] Cache hit for cart user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:02:19.984 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:02:19.993 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:02:20.203 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:02:20.505 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:02:20.570 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:02:20.636 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:02:20.640 +03:00 [INF] Clearing cart: 1
2025-08-08 05:02:20.656 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:02:20.694 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:02:20.698 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:02:20.733 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:02:20.792 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:02:20.813 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:02:20.816 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:02:20.868 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:02:20.877 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:02:20.884 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:02:21.768 +03:00 [ERR] Exception while creating order for user 1c431918-0061-41d2-a418-24bd6c056eda
System.InvalidOperationException: The connection is already in a transaction and cannot participate in another transaction.
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.EnsureNoTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(IsolationLevel isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(CancellationToken cancellationToken)
   at UnitOfWork.BeginTransactionAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 88
   at E_Commerce.Services.PaymentServices.CreatePaymentMethod(CreatePayment paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices.cs:line 57
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto) in D:\project_fashion\E-Commerce-API-main\Services\OrderServices\OrderServices.cs:line 355
2025-08-08 05:02:21.989 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:02:22.035 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 3080.4723ms
2025-08-08 05:02:22.038 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:02:22.066 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 3751.9653ms
2025-08-08 05:03:43.110 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:03:43.178 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 70.3332ms
2025-08-08 05:03:43.219 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:03:43.220 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:03:43.221 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:03:43.253 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 33.4803ms
2025-08-08 05:03:43.260 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 40.6819ms
2025-08-08 05:03:43.301 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 80.3497ms
2025-08-08 05:03:43.380 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:03:43.812 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 432.1568ms
2025-08-08 05:03:51.078 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:03:51.086 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:03:51.116 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:03:51.121 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:03:51.152 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:03:51.166 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:03:51.167 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:03:51.196 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:03:51.205 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:03:51.211 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:03:51.222 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:03:51.235 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:03:51.237 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:03:51.244 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:03:51.248 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:03:51.255 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:03:51.718 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:03:51.761 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:03:51.839 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:03:51.844 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:03:51.851 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:03:51.854 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:03:51.869 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:03:51.875 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:03:51.887 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:03:51.888 +03:00 [INF] Clearing cart: 1
2025-08-08 05:03:51.891 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:03:51.901 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:03:51.902 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:03:51.906 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:03:51.913 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:03:51.919 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:03:51.920 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:03:51.922 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:03:51.933 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:03:51.936 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:03:51.949 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:03:51.951 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:03:51.989 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:03:51.999 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:03:52.018 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:03:52.038 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:03:52.138 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:03:52.159 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:03:52.164 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:03:52.938 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:03:52.948 +03:00 [INF] Getting address by ID: 0
2025-08-08 05:03:52.989 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:03:52.994 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:03:53.001 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:03:53.005 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 1848.1996ms
2025-08-08 05:03:53.008 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:03:53.010 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 1932.438ms
2025-08-08 05:06:51.351 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 05:08:20.160 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:08:20.177 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 18.0934ms
2025-08-08 05:08:20.253 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:08:20.257 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:08:20.257 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 4.5239ms
2025-08-08 05:08:20.320 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 63.6438ms
2025-08-08 05:08:20.328 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:08:20.337 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.644ms
2025-08-08 05:08:21.705 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:08:21.894 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 189.2297ms
2025-08-08 05:08:45.083 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-08-08 05:08:45.112 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:08:45.142 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:08:45.151 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 05:08:45.209 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 05:08:45.256 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-08-08 05:08:45.274 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-08-08 05:08:45.278 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-08-08 05:08:45.280 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:08:45.306 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-08-08 05:08:45.370 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-08 05:08:45.459 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-08-08 05:08:45.464 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 05:08:45.476 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 262.4134ms
2025-08-08 05:08:45.478 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 05:08:45.481 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 289 application/json; charset=utf-8 397.5399ms
2025-08-08 05:08:46.067 +03:00 [INF] Setting cache for key: paymentmethods___page1_size10
2025-08-08 05:08:46.091 +03:00 [INF] Cache set successfully for key: paymentmethods___page1_size10 with tags: [Paymentmethodcache]
2025-08-08 05:09:47.432 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - null null
2025-08-08 05:09:47.798 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:09:47.810 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:09:47.815 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-08-08 05:09:47.822 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentProviderDto]]]] GetAll(System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-08-08 05:09:47.834 +03:00 [INF] GetAll PaymentProviders | isDeleted: , Page: 1, PageSize: 10
2025-08-08 05:09:47.847 +03:00 [INF] Getting cache for key: paymentproviders__page1_size10
2025-08-08 05:09:47.850 +03:00 [WRN] Cache miss for key: paymentproviders__page1_size10
2025-08-08 05:09:47.852 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:09:47.881 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`
FROM `PaymentProviders` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-08 05:09:47.934 +03:00 [INF] Fetched payment providers from DB and cached result.
2025-08-08 05:09:47.939 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 05:09:47.946 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce) in 120.1244ms
2025-08-08 05:09:47.949 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-08-08 05:09:47.953 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - 200 220 application/json; charset=utf-8 521.0842ms
2025-08-08 05:09:52.577 +03:00 [INF] Setting cache for key: paymentproviders__page1_size10
2025-08-08 05:09:52.615 +03:00 [INF] Cache set successfully for key: paymentproviders__page1_size10 with tags: [PaymentProviderCache]
2025-08-08 05:10:45.955 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:10:45.989 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:10:45.997 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:10:46.009 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:10:46.017 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:10:46.070 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:10:46.072 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:10:46.093 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:10:46.102 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:10:46.107 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:10:46.112 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:10:46.116 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:10:46.117 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:10:46.122 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:10:46.125 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:10:46.128 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:10:46.198 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:10:46.213 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:10:46.233 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:10:46.241 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:10:46.246 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:10:46.250 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:10:46.267 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:10:46.275 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:10:46.277 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:10:46.278 +03:00 [INF] Clearing cart: 1
2025-08-08 05:10:46.280 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:10:46.284 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:10:46.285 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:10:46.291 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:10:46.295 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:10:46.331 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:10:46.338 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:10:46.341 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:10:46.348 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:10:46.350 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:10:46.364 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:10:46.373 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:10:46.381 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:10:46.389 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:10:46.393 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:10:46.398 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:10:46.418 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:10:46.427 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:10:46.431 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:10:47.659 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:10:47.663 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:10:47.669 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:10:47.740 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:10:47.743 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:10:47.747 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:10:48.240 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:10:48.720 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:10:48.725 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:10:48.732 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:10:49.250 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:10:49.463 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:10:49.473 +03:00 [ERR] Failed to create order in Paymob
2025-08-08 05:10:49.479 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:10:49.486 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:10:49.492 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 3468.8207ms
2025-08-08 05:10:49.500 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:10:49.503 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 3548.3595ms
2025-08-08 05:12:34.261 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:12:34.278 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:12:34.286 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:12:34.303 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:12:34.305 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:12:34.309 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:12:34.310 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:12:34.330 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:12:34.341 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:12:34.348 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:12:34.351 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:12:34.359 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:12:34.362 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:12:34.365 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:12:34.367 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:12:34.375 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:12:34.428 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:12:34.435 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:12:34.437 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:12:34.443 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:12:34.448 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:12:34.449 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:12:34.454 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:12:34.461 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:12:34.463 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:12:34.464 +03:00 [INF] Clearing cart: 1
2025-08-08 05:12:34.466 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:12:34.469 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:12:34.472 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:12:34.474 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:12:34.479 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:12:34.485 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:12:34.486 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:12:34.490 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:12:34.491 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:12:34.493 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:12:34.497 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:12:34.499 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:12:34.501 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:12:34.507 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:12:34.509 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:12:34.512 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:12:48.343 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:12:48.367 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:13:11.333 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:13:33.763 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:13:33.778 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:13:33.784 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:13:33.793 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:13:33.797 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:15:43.018 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:15:43.122 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentProvider/1 - multipart/form-data; boundary=--------------------------060832126321419126452169 1217
2025-08-08 05:15:43.150 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:15:43.155 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:15:43.159 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce)'
2025-08-08 05:15:43.186 +03:00 [INF] Route matched with {action = "Update", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Update(Int32, E_Commerce.Services.UpdatePaymentProviderDto) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-08-08 05:15:43.336 +03:00 [INF] Executing GetByIdAsync for entity PaymentProvider with ID: 1
2025-08-08 05:15:43.355 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`ApiEndpoint`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Hmac`, `p`.`IframeId`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PrivateKey`, `p`.`Provider`, `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:15:43.448 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 05:15:43.455 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 05:15:43.498 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 05:15:43.564 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p3='?' (DbType = Int32), @p0='?' (Size = 100), @p1='?' (DbType = DateTime), @p2='?' (Size = -1), @p4='?' (Size = 255), @p5='?' (DbType = DateTime), @p6='?' (DbType = DateTime), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime), @p10='?' (DbType = Int32), @p11='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `PaymentProviders` SET `ApiEndpoint` = @p0, `ModifiedAt` = @p1, `PublicKey` = @p2
WHERE `Id` = @p3;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:15:43.616 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 05:15:43.629 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce) in 438.8538ms
2025-08-08 05:15:43.632 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce)'
2025-08-08 05:15:43.634 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentProvider/1 - 200 123 application/json; charset=utf-8 512.245ms
2025-08-08 05:15:50.560 +03:00 [ERR] Exception occurred while retrieving PayMob token
System.Net.Http.HttpRequestException: No such host is known. (accept.paymob.com:443)
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.InjectNewHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionWaiter`1.WaitForConnectionWithTelemetryAsync(HttpRequestMessage request, HttpConnectionPool pool, Boolean async, CancellationToken requestCancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at E_Commerce.Services.PayMobServices.PayMobServices.GetTokenAsync()
2025-08-08 05:16:01.410 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - null null
2025-08-08 05:16:01.419 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:16:01.425 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:16:01.429 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-08-08 05:16:01.432 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentProviderDto]]]] GetAll(System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-08-08 05:16:01.439 +03:00 [INF] GetAll PaymentProviders | isDeleted: , Page: 1, PageSize: 10
2025-08-08 05:16:01.441 +03:00 [INF] Getting cache for key: paymentproviders__page1_size10
2025-08-08 05:16:01.444 +03:00 [WRN] Cache miss for key: paymentproviders__page1_size10
2025-08-08 05:16:01.447 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:16:01.452 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`
FROM `PaymentProviders` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-08 05:16:01.475 +03:00 [INF] Fetched payment providers from DB and cached result.
2025-08-08 05:16:01.479 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 05:16:01.482 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce) in 44.9148ms
2025-08-08 05:16:01.484 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-08-08 05:16:01.487 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - 200 244 application/json; charset=utf-8 76.5483ms
2025-08-08 05:16:01.996 +03:00 [ERR] Exception occurred while creating order in PayMob
System.Net.Http.HttpRequestException: No such host is known. (accept.paymob.com:443)
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.InjectNewHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionWaiter`1.WaitForConnectionWithTelemetryAsync(HttpRequestMessage request, HttpConnectionPool pool, Boolean async, CancellationToken requestCancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at E_Commerce.Services.PayMobServices.PayMobServices.CreateOrderInPaymobAsync(CreateOrderRequest order)
2025-08-08 05:16:02.003 +03:00 [ERR] Failed to create order in Paymob
2025-08-08 05:16:02.004 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:16:02.008 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:16:02.015 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 207707.944ms
2025-08-08 05:16:02.017 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:16:02.019 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 207759.6013ms
2025-08-08 05:16:03.156 +03:00 [INF] Setting cache for key: paymentproviders__page1_size10
2025-08-08 05:16:03.162 +03:00 [INF] Cache set successfully for key: paymentproviders__page1_size10 with tags: [PaymentProviderCache]
2025-08-08 05:16:04.643 +03:00 [ERR] Failed to send error notification email
System.InvalidOperationException: Failed to send email.
 ---> System.Net.Mail.SmtpException: Failure sending mail.
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at System.Threading.Tasks.TaskToAsyncResult.End(IAsyncResult asyncResult)
   at System.Net.Sockets.TcpClient.EndConnect(IAsyncResult asyncResult)
   at System.Net.Mail.SmtpConnection.ConnectAndHandshakeAsyncResult.InitializeConnectionCallback(IAsyncResult result)
--- End of stack trace from previous location ---
   at System.Net.Mail.SmtpClient.ConnectCallback(IAsyncResult result)
   --- End of inner exception stack trace ---
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage)
   --- End of inner exception stack trace ---
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage)
   at E_Commerce.Services.EmailServices.ErrorNotificationService.SendErrorNotificationAsync(String errorMessage, String stackTrace)
2025-08-08 05:16:04.906 +03:00 [ERR] Failed to send error notification email
System.InvalidOperationException: Failed to send email.
 ---> System.Net.Mail.SmtpException: Failure sending mail.
 ---> System.Net.Sockets.SocketException (10060): A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at System.Threading.Tasks.TaskToAsyncResult.End(IAsyncResult asyncResult)
   at System.Net.Sockets.TcpClient.EndConnect(IAsyncResult asyncResult)
   at System.Net.Mail.SmtpConnection.ConnectAndHandshakeAsyncResult.InitializeConnectionCallback(IAsyncResult result)
--- End of stack trace from previous location ---
   at System.Net.Mail.SmtpClient.ConnectCallback(IAsyncResult result)
   --- End of inner exception stack trace ---
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage)
   --- End of inner exception stack trace ---
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage)
   at E_Commerce.Services.EmailServices.ErrorNotificationService.SendErrorNotificationAsync(String errorMessage, String stackTrace)
2025-08-08 05:16:12.041 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:16:12.047 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:16:12.055 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:16:12.060 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:16:12.063 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:16:12.268 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:16:12.269 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:16:12.276 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:16:12.284 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:16:12.289 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:16:12.291 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:16:12.298 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:16:12.299 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:16:12.304 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:16:12.308 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:16:12.313 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:16:12.367 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:16:12.379 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:16:12.384 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:16:12.387 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:16:12.391 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:16:12.393 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:16:12.399 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:16:12.405 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:16:12.407 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:16:12.407 +03:00 [INF] Clearing cart: 1
2025-08-08 05:16:12.417 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:16:12.426 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:16:12.431 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:16:12.435 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:16:12.439 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:16:12.444 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:16:12.447 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:16:12.448 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:16:12.450 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:16:12.453 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:16:12.456 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:16:12.458 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:16:12.465 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:16:12.468 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:16:12.471 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:16:12.473 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:16:12.479 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:16:12.481 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:16:16.566 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:16:27.962 +03:00 [ERR] Exception occurred while retrieving PayMob token
System.Net.Http.HttpRequestException: No such host is known. (accept.paymob.com:443)
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.InjectNewHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionWaiter`1.WaitForConnectionWithTelemetryAsync(HttpRequestMessage request, HttpConnectionPool pool, Boolean async, CancellationToken requestCancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at E_Commerce.Services.PayMobServices.PayMobServices.GetTokenAsync()
2025-08-08 05:16:27.986 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:16:27.988 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:16:27.997 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:16:28.000 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:16:36.553 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:16:38.954 +03:00 [ERR] Failed to send error notification email
System.InvalidOperationException: Failed to send email.
 ---> System.Net.Mail.SmtpException: Failure sending mail.
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at System.Threading.Tasks.TaskToAsyncResult.End(IAsyncResult asyncResult)
   at System.Net.Sockets.TcpClient.EndConnect(IAsyncResult asyncResult)
   at System.Net.Mail.SmtpConnection.ConnectAndHandshakeAsyncResult.InitializeConnectionCallback(IAsyncResult result)
--- End of stack trace from previous location ---
   at System.Net.Mail.SmtpClient.ConnectCallback(IAsyncResult result)
   --- End of inner exception stack trace ---
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage)
   --- End of inner exception stack trace ---
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage)
   at E_Commerce.Services.EmailServices.ErrorNotificationService.SendErrorNotificationAsync(String errorMessage, String stackTrace)
2025-08-08 05:16:39.795 +03:00 [ERR] Exception occurred while retrieving PayMob token
System.Net.Http.HttpRequestException: No such host is known. (accept.paymob.com:443)
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.InjectNewHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionWaiter`1.WaitForConnectionWithTelemetryAsync(HttpRequestMessage request, HttpConnectionPool pool, Boolean async, CancellationToken requestCancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at E_Commerce.Services.PayMobServices.PayMobServices.GetTokenAsync()
2025-08-08 05:16:40.434 +03:00 [ERR] Exception occurred while creating order in PayMob
System.Net.Http.HttpRequestException: No such host is known. (accept.paymob.com:443)
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.InjectNewHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionWaiter`1.WaitForConnectionWithTelemetryAsync(HttpRequestMessage request, HttpConnectionPool pool, Boolean async, CancellationToken requestCancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at E_Commerce.Services.PayMobServices.PayMobServices.CreateOrderInPaymobAsync(CreateOrderRequest order)
2025-08-08 05:16:40.449 +03:00 [ERR] Failed to create order in Paymob
2025-08-08 05:16:40.452 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:16:40.456 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:16:40.492 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 28226.0815ms
2025-08-08 05:16:40.496 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:16:40.499 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 28457.4018ms
2025-08-08 05:18:41.621 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:18:41.674 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:18:41.727 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:18:41.743 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:18:41.810 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:18:41.835 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:18:41.841 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:18:41.876 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:18:41.896 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:18:41.901 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:18:41.908 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:18:41.916 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:18:41.923 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:18:41.924 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:18:41.928 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:18:41.942 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:18:41.955 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:18:41.977 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 81.3866ms
2025-08-08 05:18:42.124 +03:00 [INF] Executed DbCommand (148ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:18:42.211 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:18:42.403 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:18:42.423 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:18:42.435 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:18:42.444 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:18:42.476 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:18:42.490 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:18:42.493 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:18:42.494 +03:00 [INF] Clearing cart: 1
2025-08-08 05:18:42.497 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:18:42.511 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:18:42.512 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:18:42.530 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:18:43.029 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:18:43.090 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:18:43.091 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:18:43.093 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:18:43.094 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:18:43.097 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:18:43.104 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:18:43.105 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:18:43.109 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:18:43.112 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:18:43.115 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:18:43.124 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:18:43.154 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:18:43.158 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:18:45.139 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:18:45.140 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:18:45.139 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:18:45.139 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:18:45.225 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 85.6185ms
2025-08-08 05:18:45.247 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 108.3194ms
2025-08-08 05:18:45.234 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 94.8419ms
2025-08-08 05:18:51.677 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:19:05.579 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:19:05.581 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:19:05.590 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:19:05.853 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 14176.4786ms
2025-08-08 05:19:06.174 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:19:06.177 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:19:09.779 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:19:11.285 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:19:11.508 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:19:11.511 +03:00 [ERR] Failed to create order in Paymob
2025-08-08 05:19:11.521 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:19:11.531 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:19:11.537 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 29723.9407ms
2025-08-08 05:19:11.539 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:19:11.543 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 29924.5305ms
2025-08-08 05:19:38.672 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:19:38.685 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 13.886ms
2025-08-08 05:19:38.747 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:19:38.790 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 43.2252ms
2025-08-08 05:19:38.799 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:19:38.800 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:19:38.824 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.6501ms
2025-08-08 05:19:38.827 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 26.7407ms
2025-08-08 05:19:39.913 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:19:40.403 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 489.852ms
2025-08-08 05:20:24.288 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:20:24.294 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:20:24.329 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:20:24.345 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:20:24.376 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:20:24.396 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:20:24.397 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:20:24.407 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:20:24.415 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:20:24.426 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:20:24.429 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:20:24.436 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:20:24.442 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:20:24.443 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:20:24.446 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:20:24.454 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:20:24.590 +03:00 [INF] Executed DbCommand (54ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:20:24.647 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:20:24.686 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:20:24.720 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:20:24.728 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:20:24.748 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:20:24.779 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:20:24.792 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:20:24.794 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:20:24.797 +03:00 [INF] Clearing cart: 1
2025-08-08 05:20:24.801 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:20:24.804 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:20:24.806 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:20:24.809 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:20:24.815 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:20:24.822 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:20:24.824 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:20:24.826 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:20:24.827 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:20:24.831 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:20:24.837 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:20:24.838 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:20:24.842 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:20:24.847 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:20:24.851 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:20:24.854 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:20:24.865 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:20:24.869 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:20:24.873 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:20:28.266 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:20:28.291 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:20:28.298 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:20:28.347 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:20:28.364 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:20:28.378 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:20:37.056 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:20:37.614 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:20:37.790 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:20:37.794 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:20:46.474 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:20:46.675 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:20:46.680 +03:00 [ERR] Failed to create order in Paymob
2025-08-08 05:20:46.683 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:20:46.700 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:20:46.799 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 22405.8226ms
2025-08-08 05:20:46.878 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:20:46.881 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 22592.8131ms
2025-08-08 05:21:10.418 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:21:10.537 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 119.4014ms
2025-08-08 05:21:10.660 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:21:10.667 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.2224ms
2025-08-08 05:21:10.670 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:21:10.776 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 106.0722ms
2025-08-08 05:21:12.466 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:21:12.477 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.2713ms
2025-08-08 05:21:17.771 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:21:18.106 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 335.1083ms
2025-08-08 05:21:20.332 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:21:20.550 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:21:20.608 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:21:20.793 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:21:20.841 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:21:21.053 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:21:21.376 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:21:21.545 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:21:21.588 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:21:21.596 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:21:21.600 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:21:21.614 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:21:21.616 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:21:21.623 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:21:21.633 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:21:22.044 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:21:22.842 +03:00 [INF] Executed DbCommand (148ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:21:23.934 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:21:24.129 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:21:24.218 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:21:24.334 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:21:24.430 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:21:24.442 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:21:24.599 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:21:24.683 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:21:24.718 +03:00 [INF] Clearing cart: 1
2025-08-08 05:21:24.799 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:21:24.829 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:21:24.830 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:21:24.834 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:21:24.917 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:21:25.029 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:21:25.049 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:21:25.060 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:21:25.063 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:21:25.066 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:21:25.073 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:21:25.074 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:21:25.077 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:21:25.080 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:21:25.081 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:21:25.083 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:21:25.144 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:21:25.293 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:21:25.332 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:21:25.951 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:21:40.243 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:21:40.266 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:21:40.784 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:21:40.791 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:21:40.795 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:21:41.313 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:21:43.365 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:21:43.368 +03:00 [ERR] Failed to create order in Paymob
2025-08-08 05:21:43.374 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:21:43.380 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:21:43.385 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 22339.067ms
2025-08-08 05:21:43.595 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:21:43.672 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 23340.4428ms
2025-08-08 05:25:10.741 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:25:10.908 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 172.7452ms
2025-08-08 05:25:11.098 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:25:11.099 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:25:11.110 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 12.4654ms
2025-08-08 05:25:11.154 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:25:11.155 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 56.5387ms
2025-08-08 05:25:11.193 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 39.8677ms
2025-08-08 05:25:11.687 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:25:12.039 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 351.4474ms
2025-08-08 05:25:27.373 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:25:27.454 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:25:27.580 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:25:27.607 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:25:27.673 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:25:27.733 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:25:27.736 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:25:27.791 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:25:27.814 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:25:27.818 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:25:27.835 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:25:27.839 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:25:27.841 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:25:27.850 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:25:27.855 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:25:27.863 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:25:28.006 +03:00 [INF] Executed DbCommand (126ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:25:28.019 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:25:28.080 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:25:28.088 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:25:28.094 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:25:28.102 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:25:28.129 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:25:28.136 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:25:28.140 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:25:28.141 +03:00 [INF] Clearing cart: 1
2025-08-08 05:25:28.144 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:25:28.150 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:25:28.151 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:25:28.157 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:25:28.166 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:25:28.175 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:25:28.177 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:25:28.180 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:25:28.182 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:25:28.184 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:25:28.190 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:25:28.192 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:25:28.197 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:25:28.241 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:25:28.250 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:25:28.255 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:25:28.306 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:25:28.315 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:25:28.319 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:25:29.068 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-08-08 05:25:29.073 +03:00 [ERR] Failed to get token for payment link generation
2025-08-08 05:25:29.074 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:25:29.083 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:25:29.088 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 1410.7996ms
2025-08-08 05:25:29.091 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:25:29.104 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 1730.6297ms
2025-08-08 05:30:51.293 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:30:52.037 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:31:10.174 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:31:10.891 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:31:10.913 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:31:10.954 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:31:10.980 +03:00 [INF] Applying migration '20250808023055_updatemethodprovider'.
2025-08-08 05:31:11.257 +03:00 [INF] Executed DbCommand (58ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PaymentProviders` MODIFY COLUMN `PublicKey` varchar(255) CHARACTER SET utf8mb4 NULL;
2025-08-08 05:31:11.262 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20250808023055_updatemethodprovider', '8.0.13');
2025-08-08 05:40:44.605 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:40:45.709 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:41:04.686 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:41:05.628 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:41:05.649 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:41:05.683 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:41:05.706 +03:00 [INF] Applying migration '20250808024046_updatemethodprovider2'.
2025-08-08 05:41:06.222 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PaymentProviders` MODIFY COLUMN `PublicKey` varchar(500) CHARACTER SET utf8mb4 NULL;
2025-08-08 05:41:06.227 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20250808024046_updatemethodprovider2', '8.0.13');
2025-08-08 05:41:31.290 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 05:41:32.866 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:41:33.218 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:41:33.235 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:41:33.263 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:41:33.287 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 05:41:33.346 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 05:41:33.820 +03:00 [INF] Executed DbCommand (58ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:41:33.917 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:41:33.949 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 05:41:35.170 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 05:41:35.391 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 05:41:35.479 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:41:35.493 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 05:41:35.525 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 05:41:35.534 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 05:41:35.536 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 05:41:35.633 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 05:41:35.646 +03:00 [INF] Hosting environment: Development
2025-08-08 05:41:35.660 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 05:41:35.690 +03:00 [INF] Server mrrobot:11164:9d53d777 successfully announced in 48.4569 ms
2025-08-08 05:41:35.714 +03:00 [INF] Server mrrobot:11164:9d53d777 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 05:41:35.752 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 05:41:35.854 +03:00 [INF] Server mrrobot:11164:9d53d777 all the dispatchers started
2025-08-08 05:41:35.990 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 508.6247ms
2025-08-08 05:41:35.993 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:41:35.997 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:41:36.048 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:41:36.053 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 60.3002ms
2025-08-08 05:41:36.111 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 62.6411ms
2025-08-08 05:41:36.165 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 167.443ms
2025-08-08 05:41:36.276 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:41:36.662 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 385.5657ms
2025-08-08 05:41:41.848 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:41:41.871 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 05:41:45.835 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:41:46.709 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:41:46.809 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:41:46.967 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:41:48.570 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:41:48.579 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:41:48.661 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:41:48.681 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:41:48.688 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:41:48.701 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:41:48.717 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:41:48.727 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:41:48.772 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:41:48.777 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:41:48.782 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:41:49.108 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:41:49.158 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:41:49.317 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:41:49.341 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:41:49.351 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:41:50.032 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:41:51.125 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:41:51.514 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:41:52.097 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:41:52.123 +03:00 [INF] Clearing cart: 1
2025-08-08 05:41:52.139 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:41:52.175 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:41:52.179 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:41:52.219 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:41:52.468 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:41:52.530 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:41:52.543 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:41:52.666 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:41:52.678 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:41:52.701 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:41:52.721 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:41:52.725 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:41:52.877 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:41:52.967 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:41:53.047 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:41:53.345 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:41:53.397 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:41:53.464 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:41:53.931 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:41:55.182 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:41:55.192 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:41:55.240 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:41:55.782 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:41:55.796 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:41:55.840 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:41:56.332 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:41:58.059 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:41:58.063 +03:00 [ERR] Failed to create order in PayMob for OrderId: 11
2025-08-08 05:41:58.066 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:41:58.118 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:41:58.167 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 11118.9325ms
2025-08-08 05:41:58.175 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:41:58.184 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 16336.1259ms
2025-08-08 05:44:26.076 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 05:44:27.879 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:44:28.311 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:44:28.334 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:44:28.369 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:44:28.398 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 05:44:28.434 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 05:44:28.925 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:44:29.026 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:44:29.072 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 05:44:29.905 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 05:44:30.037 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 05:44:30.091 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 05:44:30.092 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 05:44:30.098 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 05:44:30.104 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 05:44:30.146 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 05:44:30.152 +03:00 [INF] Hosting environment: Development
2025-08-08 05:44:30.165 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 05:44:30.334 +03:00 [INF] Server mrrobot:9968:e82e2e89 successfully announced in 166.2365 ms
2025-08-08 05:44:30.379 +03:00 [INF] Server mrrobot:9968:e82e2e89 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 05:44:30.476 +03:00 [INF] Server mrrobot:9968:e82e2e89 all the dispatchers started
2025-08-08 05:44:30.637 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:44:30.918 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 281.7971ms
2025-08-08 05:44:31.182 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:44:31.182 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:44:31.182 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:44:31.191 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.9612ms
2025-08-08 05:44:31.244 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 62.0265ms
2025-08-08 05:44:31.319 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 137.7526ms
2025-08-08 05:44:31.573 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:44:31.895 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 321.8271ms
2025-08-08 05:44:37.935 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:44:37.955 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 05:44:38.422 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:44:38.526 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:44:38.555 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:44:38.593 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:44:39.234 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:44:39.243 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:44:39.323 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:44:39.346 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:44:39.375 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:44:39.412 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:44:39.423 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:44:39.431 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:44:39.450 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:44:39.455 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:44:39.466 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:44:39.825 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:44:39.850 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:44:39.938 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:44:39.953 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:44:39.962 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:44:40.331 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:44:40.889 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:44:40.956 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:44:41.011 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:44:41.014 +03:00 [INF] Clearing cart: 1
2025-08-08 05:44:41.030 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:44:41.084 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:44:41.099 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:44:41.120 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:44:41.217 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:44:41.241 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:44:41.244 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:44:41.296 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:44:41.307 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:44:41.316 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:44:41.328 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:44:41.330 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:44:41.356 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:44:41.363 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:44:41.370 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:44:41.394 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:44:41.460 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:44:41.474 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:44:41.480 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:44:42.375 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:44:42.387 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:44:42.429 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:44:42.945 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:44:42.954 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:44:42.964 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:44:43.470 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:44:43.801 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:44:43.803 +03:00 [ERR] Failed to create order in PayMob for OrderId: 12
2025-08-08 05:44:43.805 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:44:43.850 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:44:43.896 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 5294.5885ms
2025-08-08 05:44:43.900 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:44:43.908 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 5975.0991ms
2025-08-08 05:45:42.408 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:45:42.419 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 11.4489ms
2025-08-08 05:45:42.473 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:45:42.479 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:45:42.491 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:45:42.498 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 25.8396ms
2025-08-08 05:45:42.503 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 24.1545ms
2025-08-08 05:45:42.518 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.2539ms
2025-08-08 05:45:42.568 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:45:42.784 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 215.7813ms
2025-08-08 05:45:46.029 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:45:46.039 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:45:46.052 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:45:46.067 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:45:46.080 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:45:46.100 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:45:46.102 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:45:46.121 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:45:46.132 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:45:46.139 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:45:46.142 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:45:46.148 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:45:46.151 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:45:46.153 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:45:46.158 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:45:46.167 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:45:46.225 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:45:46.243 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:45:46.255 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:45:46.259 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:45:46.263 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:45:46.268 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:45:46.272 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:45:46.277 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:45:46.279 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:45:46.283 +03:00 [INF] Clearing cart: 1
2025-08-08 05:45:46.285 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:45:46.289 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:45:46.291 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:45:46.294 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:45:46.303 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:45:46.308 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:45:46.310 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:45:46.320 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:45:46.322 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:45:46.324 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:45:46.334 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:45:46.336 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:45:46.338 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:45:46.341 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:45:46.348 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:45:46.350 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:45:46.354 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:45:46.357 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:45:46.367 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:45:47.074 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:45:47.078 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:45:47.083 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:45:47.549 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:45:47.551 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:45:47.556 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:45:48.055 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:45:48.294 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:45:48.296 +03:00 [ERR] Failed to create order in PayMob for OrderId: 13
2025-08-08 05:45:48.300 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:45:48.305 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:45:48.308 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 2224.465ms
2025-08-08 05:45:48.372 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:45:48.373 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 2343.9467ms
2025-08-08 05:46:28.219 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 05:46:31.362 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:46:31.946 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:46:31.964 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:46:32.038 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:46:32.086 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 05:46:32.164 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 05:46:33.270 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:46:33.433 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:46:33.504 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 05:46:35.964 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 05:46:36.398 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 05:46:36.846 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 05:46:36.858 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 05:46:36.921 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 05:46:36.947 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 05:46:38.108 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 05:46:38.120 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:46:38.308 +03:00 [INF] Server mrrobot:25296:5086d983 successfully announced in 197.384 ms
2025-08-08 05:46:38.371 +03:00 [INF] Hosting environment: Development
2025-08-08 05:46:38.467 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 05:46:38.524 +03:00 [INF] Server mrrobot:25296:5086d983 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 05:46:39.607 +03:00 [INF] Server mrrobot:25296:5086d983 all the dispatchers started
2025-08-08 05:46:40.042 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:46:40.061 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:46:40.117 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 2341.2363ms
2025-08-08 05:46:40.117 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 65.3326ms
2025-08-08 05:46:40.258 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:46:40.300 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 239.5911ms
2025-08-08 05:46:40.582 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 323.1279ms
2025-08-08 05:46:41.101 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:46:41.500 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 398.6607ms
2025-08-08 05:46:59.555 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:46:59.686 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 05:47:00.701 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:47:00.806 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:47:00.870 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:47:00.962 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:47:02.099 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:47:02.108 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:47:02.205 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:47:02.223 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:47:02.234 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:47:02.255 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:47:02.284 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:47:02.289 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:47:02.309 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:47:02.313 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:47:02.318 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:47:02.958 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:47:03.093 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:47:03.290 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:47:03.311 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:47:03.324 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:47:03.731 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:47:04.317 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:47:04.582 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:47:04.709 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:47:04.714 +03:00 [INF] Clearing cart: 1
2025-08-08 05:47:04.731 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:47:04.860 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:47:04.867 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:47:04.898 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:47:05.064 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:47:05.097 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:47:05.104 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:47:05.227 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:47:05.292 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:47:05.309 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:47:05.318 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:47:05.324 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:47:05.359 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:47:05.377 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:47:05.387 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:47:05.406 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:47:05.577 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:47:05.607 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:47:05.650 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:47:06.870 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:47:24.668 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:47:24.752 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:49:04.840 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:49:05.836 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:49:05.930 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:49:08.634 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:49:14.225 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:49:14.355 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 148.9893ms
2025-08-08 05:49:14.972 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:49:14.978 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.203ms
2025-08-08 05:49:14.996 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:49:15.059 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 62.3539ms
2025-08-08 05:49:15.070 +03:00 [ERR] Failed to create order in PayMob. Status: "Unauthorized", Error: {"detail":"Must be logged in"}
2025-08-08 05:49:15.085 +03:00 [ERR] Failed to create order in PayMob for OrderId: 14
2025-08-08 05:49:15.096 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:49:15.108 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:49:15.130 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 22.3232ms
2025-08-08 05:49:15.540 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:49:15.683 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 134698.4765ms
2025-08-08 05:49:15.700 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:49:15.855 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 136301.5131ms
2025-08-08 05:49:17.102 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:49:17.803 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 700.7875ms
2025-08-08 05:49:18.272 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:49:18.369 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:49:18.405 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:49:18.412 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:49:18.441 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:49:18.472 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:49:18.492 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:18.533 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:49:18.539 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:49:18.543 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:18.549 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:49:18.553 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:18.554 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:18.560 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:18.566 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:49:18.569 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:49:18.661 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:49:18.670 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:18.692 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:49:18.701 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:49:18.708 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:49:18.716 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:49:18.737 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:49:18.746 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:49:18.748 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:49:18.749 +03:00 [INF] Clearing cart: 1
2025-08-08 05:49:18.752 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:49:18.756 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:49:18.757 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:49:18.763 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:49:18.769 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:49:18.773 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:49:18.775 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:49:18.778 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:49:18.780 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:18.784 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:49:18.788 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:49:18.789 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:49:18.797 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:49:18.801 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:49:18.802 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:49:18.804 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:49:18.811 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:49:18.814 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:49:18.818 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:49:19.371 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:49:22.541 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:49:22.578 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:49:29.776 +03:00 [ERR] Exception occurred while generating payment link
System.Runtime.CompilerServices.HotReloadException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at E_Commerce.Services.PayMobServices.PayMobServices.CreateOrderRequest.set_token(String value)
   at E_Commerce.Services.PayMobServices.PayMobServices.GetPaymentLinkAsync(CreatePayment dto)
2025-08-08 05:49:29.798 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:49:29.809 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:49:29.813 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 11367.8994ms
2025-08-08 05:49:29.819 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:49:29.821 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 11548.8376ms
2025-08-08 05:49:52.298 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:49:52.704 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:49:52.776 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:49:53.158 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:49:53.171 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:49:53.226 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:49:53.327 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:53.426 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:49:53.465 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:49:53.479 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:53.497 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:49:53.660 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:53.662 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:53.664 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:53.671 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:49:53.675 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:49:53.748 +03:00 [INF] Executed DbCommand (63ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:49:53.760 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:53.780 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:49:53.787 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:49:53.791 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:49:53.793 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:49:53.800 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:49:53.806 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:49:53.809 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:49:53.810 +03:00 [INF] Clearing cart: 1
2025-08-08 05:49:53.812 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:49:53.823 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:49:53.825 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:49:53.828 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:49:53.835 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:49:53.840 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:49:53.842 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:49:53.843 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:49:53.845 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:49:53.852 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:49:53.857 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:49:53.859 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:49:53.864 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:49:53.869 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:49:53.872 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:49:53.874 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:49:53.886 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:49:53.889 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:49:53.894 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:49:55.171 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:49:55.176 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:49:55.180 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:50:07.980 +03:00 [ERR] Exception occurred while creating order in PayMob
System.Runtime.CompilerServices.HotReloadException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at E_Commerce.Services.PayMobServices.PayMobServices.CreateOrderRequest.get_token()
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.WriteCore(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Serialize(Utf8JsonWriter writer, T& rootValue, Object rootValueBoxed)
   at System.Text.Json.JsonSerializer.WriteString[TValue](TValue& value, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Serialize[TValue](TValue value, JsonSerializerOptions options)
   at E_Commerce.Services.PayMobServices.PayMobServices.CreateOrderInPaymobAsync(CreateOrderRequest order)
2025-08-08 05:50:07.997 +03:00 [ERR] Failed to create order in PayMob for OrderId: 16
2025-08-08 05:50:08.003 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:50:08.007 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:50:08.011 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 14834.4176ms
2025-08-08 05:50:08.013 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:50:08.023 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 15724.7589ms
2025-08-08 05:50:30.231 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 05:50:31.915 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:50:32.366 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:50:32.382 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:50:32.416 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:50:32.441 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 05:50:32.474 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 05:50:33.234 +03:00 [INF] Executed DbCommand (344ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:50:33.342 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:50:33.384 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 05:50:34.222 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 05:50:34.342 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 05:50:34.403 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 05:50:34.406 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 05:50:34.408 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 05:50:34.410 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 05:50:34.443 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 05:50:34.445 +03:00 [INF] Hosting environment: Development
2025-08-08 05:50:34.446 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 05:50:34.474 +03:00 [INF] Server mrrobot:22236:b011c37d successfully announced in 20.1838 ms
2025-08-08 05:50:34.485 +03:00 [INF] Server mrrobot:22236:b011c37d is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 05:50:34.504 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 05:50:34.699 +03:00 [INF] Server mrrobot:22236:b011c37d all the dispatchers started
2025-08-08 05:50:34.986 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:50:35.425 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 439.4936ms
2025-08-08 05:50:35.445 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:50:35.454 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:50:35.459 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 14.3387ms
2025-08-08 05:50:35.463 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.2472ms
2025-08-08 05:50:35.476 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:50:35.611 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 134.5975ms
2025-08-08 05:50:35.674 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:50:36.144 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 470.5989ms
2025-08-08 05:50:39.556 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 05:50:39.564 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 05:50:39.888 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:50:40.004 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:50:40.025 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:50:40.060 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 05:50:40.785 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 05:50:40.792 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:50:40.858 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 05:50:40.873 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:50:40.879 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:50:40.889 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:50:40.897 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:50:40.904 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:50:40.916 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:50:40.927 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 05:50:40.942 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 05:50:41.240 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 05:50:41.267 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:50:41.346 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 05:50:41.360 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 05:50:41.374 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 05:50:41.544 +03:00 [INF] Order added successfully (pending save)
2025-08-08 05:50:41.777 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:50:41.832 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 05:50:41.881 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 05:50:41.886 +03:00 [INF] Clearing cart: 1
2025-08-08 05:50:41.900 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 05:50:41.955 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 05:50:41.958 +03:00 [INF] Removing cache by tag: cart
2025-08-08 05:50:41.973 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 05:50:42.024 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 05:50:42.048 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 05:50:42.053 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 05:50:42.085 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 05:50:42.091 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:50:42.098 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 05:50:42.105 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 05:50:42.107 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:50:42.127 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:50:42.135 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 05:50:42.140 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 05:50:42.157 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:50:42.201 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 05:50:42.213 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 05:50:42.221 +03:00 [INF] Executing GetTokenAsync
2025-08-08 05:50:43.608 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 05:50:43.615 +03:00 [INF] Getting address by ID: 1
2025-08-08 05:50:43.660 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 05:50:44.394 +03:00 [INF] Successfully created PayMob order: 367503702 for local order: 17
2025-08-08 05:50:44.397 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:50:44.408 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 05:50:44.413 +03:00 [ERR] Integration ID not found for payment method: "Visa". Please configure the integration ID in the database.
2025-08-08 05:50:44.415 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 05:50:44.463 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 05:50:44.500 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 4431.0622ms
2025-08-08 05:50:44.504 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 05:50:44.511 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 4955.5446ms
2025-08-08 05:52:44.536 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-08-08 05:52:44.565 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:52:44.587 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:52:44.594 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 05:52:44.613 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 05:52:44.638 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-08-08 05:52:44.647 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-08-08 05:52:44.650 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-08-08 05:52:44.652 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 05:52:44.672 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-08-08 05:52:44.709 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-08 05:52:44.875 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-08-08 05:52:44.882 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 05:52:44.900 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 282.5425ms
2025-08-08 05:52:44.901 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-08 05:52:44.905 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 289 application/json; charset=utf-8 369.8841ms
2025-08-08 05:52:44.988 +03:00 [INF] Setting cache for key: paymentmethods___page1_size10
2025-08-08 05:52:45.001 +03:00 [INF] Cache set successfully for key: paymentmethods___page1_size10 with tags: [Paymentmethodcache]
2025-08-08 05:54:35.583 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:54:35.794 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 211.2251ms
2025-08-08 05:54:36.541 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:54:36.565 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 23.6782ms
2025-08-08 05:54:36.588 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:54:36.597 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:54:36.629 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 40.1638ms
2025-08-08 05:54:36.632 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 35.0394ms
2025-08-08 05:54:37.252 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:54:37.897 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 642.5248ms
2025-08-08 05:55:20.055 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:55:20.073 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 18.3226ms
2025-08-08 05:55:20.221 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:55:20.233 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 11.8105ms
2025-08-08 05:55:20.239 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:55:20.261 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 21.3673ms
2025-08-08 05:55:20.295 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:55:20.301 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.9078ms
2025-08-08 05:55:21.115 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:55:21.283 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce). See inner exception
 ---> System.Reflection.AmbiguousMatchException: Ambiguous match found for 'E_Commerce.Services.Updatepaymentmethoddto Int32 Integrationid'.
   at System.RuntimeType.GetPropertyImpl(String name, BindingFlags bindingAttr, Binder binder, Type returnType, Type[] types, ParameterModifier[] modifiers)
   at Swashbuckle.AspNetCore.SwaggerGen.ApiParameterDescriptionExtensions.PropertyInfo(ApiParameterDescription apiParameter)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateSchemaFromFormParameters(IEnumerable`1 formParameters, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateRequestBodyFromFormParameters(ApiDescription apiDescription, SchemaRepository schemaRepository, IEnumerable`1 formParameters, IEnumerable`1 contentTypes)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateRequestBodyAndFilterContext(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateRequestBodyAsync(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-08 05:55:21.826 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 711.3249ms
2025-08-08 05:55:34.569 +03:00 [INF] 2 servers were removed due to timeout
2025-08-08 05:58:06.257 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - multipart/form-data; boundary=--------------------------010205214910537246548940 506
2025-08-08 05:58:06.389 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:58:06.532 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:58:06.562 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 05:58:06.684 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 05:58:06.837 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 147.6245ms
2025-08-08 05:58:06.841 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 05:58:06.853 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.Runtime.CompilerServices.HotReloadException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at E_Commerce.Services.Updatepaymentmethoddto.get_Integrationid()
   at Microsoft.Extensions.Internal.PropertyHelper.CallNullSafePropertyGetter[TDeclaringType,TValue](Func`2 getter, Object target)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationEntry.get_Model()
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitChildren(IValidationStrategy strategy)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitComplexType(IValidationStrategy defaultStrategy)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitImplementation(ModelMetadata& metadata, String& key, Object model)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.Visit(ModelMetadata metadata, String key, Object model)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ObjectModelValidator.Validate(ActionContext actionContext, ValidationStateDictionary validationState, String prefix, Object model, ModelMetadata metadata, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.EnforceBindRequiredAndValidate(ObjectModelValidator baseObjectValidator, ActionContext actionContext, ParameterDescriptor parameter, ModelMetadata metadata, ModelBindingContext modelBindingContext, ModelBindingResult modelBindingResult, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.ResponseCaching.ResponseCachingMiddleware.Invoke(HttpContext httpContext)
   at SecurityStampMiddleware.Invoke(HttpContext context)
   at E_Commerce.Middleware.UserAuthenticationMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.RateLimiting.RateLimitingMiddleware.InvokeInternal(HttpContext context, EnableRateLimitingAttribute enableRateLimitingAttribute)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-08 05:58:06.918 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - 500 null text/plain; charset=utf-8 664.1198ms
2025-08-08 05:59:07.087 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 05:59:09.379 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 05:59:09.790 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:59:09.808 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 05:59:09.842 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 05:59:09.866 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 05:59:09.905 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 05:59:10.388 +03:00 [INF] Executed DbCommand (68ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:59:10.492 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 05:59:10.521 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 05:59:11.345 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 05:59:11.490 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 05:59:11.688 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 05:59:11.692 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 05:59:11.693 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 05:59:11.739 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 05:59:11.781 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 05:59:11.793 +03:00 [INF] Hosting environment: Development
2025-08-08 05:59:11.795 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 05:59:11.819 +03:00 [INF] Server mrrobot:5296:c4ec532d successfully announced in 27.5229 ms
2025-08-08 05:59:11.827 +03:00 [INF] Server mrrobot:5296:c4ec532d is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 05:59:11.914 +03:00 [INF] Server mrrobot:5296:c4ec532d all the dispatchers started
2025-08-08 05:59:12.024 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 05:59:12.333 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 307.4647ms
2025-08-08 05:59:12.401 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 05:59:12.404 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 05:59:12.410 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.943ms
2025-08-08 05:59:12.543 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 05:59:12.589 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 184.6325ms
2025-08-08 05:59:12.601 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 57.6548ms
2025-08-08 05:59:14.828 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - multipart/form-data; boundary=--------------------------910280097506477379885968 506
2025-08-08 05:59:15.762 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 05:59:16.710 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 05:59:16.857 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 05:59:16.896 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 05:59:16.964 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 05:59:17.281 +03:00 [INF] Starting UpdatePaymentMethod for ID 1 by user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 05:59:17.346 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-08-08 05:59:17.380 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 05:59:17.391 +03:00 [WRN] PaymentMethod with ID 1 not found or deleted
2025-08-08 05:59:17.393 +03:00 [WRN] Payment method with ID 1 not found
2025-08-08 05:59:17.442 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 05:59:17.560 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 529.6188ms
2025-08-08 05:59:17.569 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 05:59:17.592 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - 400 231 application/json; charset=utf-8 2764.6283ms
2025-08-08 05:59:19.999 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 05:59:20.282 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 282.9946ms
2025-08-08 06:00:20.699 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - multipart/form-data; boundary=--------------------------618828900706300977425383 506
2025-08-08 06:00:20.711 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:00:20.721 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:00:20.729 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:00:20.732 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 06:00:20.744 +03:00 [INF] Starting UpdatePaymentMethod for ID 2 by user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:20.757 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:00:20.761 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:00:20.812 +03:00 [INF] Updating payment method: visa
2025-08-08 06:00:20.985 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `PaymentMethods` SET `Name` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 06:00:21.015 +03:00 [INF] Payment method updated successfully with ID 2
2025-08-08 06:00:21.018 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:00:21.023 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:00:21.099 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:00:21.109 +03:00 [INF] Admin operation logged for payment method update 2
2025-08-08 06:00:21.278 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:00:21.281 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 544.4012ms
2025-08-08 06:00:21.283 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:00:21.286 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - 200 122 application/json; charset=utf-8 586.9097ms
2025-08-08 06:00:22.110 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-08 06:00:22.144 +03:00 [INF] Removed 1 cache entries for tag: Paymentmethodcache
2025-08-08 06:00:37.259 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:00:37.270 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:00:37.278 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:00:37.287 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:00:37.295 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:00:37.682 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:00:37.693 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:37.739 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:00:37.755 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:00:37.761 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:37.770 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:00:37.777 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:37.780 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:37.788 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:37.791 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:00:37.797 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:00:38.068 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:00:38.093 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:38.162 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:00:38.180 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:00:38.185 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:00:38.277 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:00:38.447 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:00:38.484 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:00:38.529 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:00:38.532 +03:00 [INF] Clearing cart: 1
2025-08-08 06:00:38.545 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:00:38.579 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:00:38.581 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:00:38.592 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:00:38.639 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:00:38.653 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:00:38.656 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:00:38.683 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:00:38.690 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:00:38.697 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:00:38.704 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:00:38.707 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:00:38.725 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:00:38.731 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:00:38.735 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:00:38.741 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:00:38.757 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:00:38.767 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:00:38.775 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:00:39.649 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:00:39.656 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:00:39.695 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:00:40.264 +03:00 [INF] Successfully created PayMob order: 367504728 for local order: 18
2025-08-08 06:00:40.266 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:00:40.275 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:00:40.279 +03:00 [ERR] Integration ID not found for payment method: "Visa". Please configure the integration ID in the database.
2025-08-08 06:00:40.282 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 06:00:40.302 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:00:40.309 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 3008.7539ms
2025-08-08 06:00:40.313 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:00:40.315 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 3055.2857ms
2025-08-08 06:01:27.651 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:01:27.665 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 13.9856ms
2025-08-08 06:01:27.731 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:01:27.745 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 14.3536ms
2025-08-08 06:01:27.746 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:01:27.774 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.039ms
2025-08-08 06:01:27.781 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:01:27.784 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 3.6822ms
2025-08-08 06:01:28.391 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:01:28.962 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 569.8869ms
2025-08-08 06:01:46.999 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:01:47.033 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 34.335ms
2025-08-08 06:01:47.211 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:01:47.379 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 167.7891ms
2025-08-08 06:03:17.163 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/payments/webhook/paymob - application/json-patch+json 560
2025-08-08 06:03:17.180 +03:00 [INF] CORS policy execution successful.
2025-08-08 06:03:17.196 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:03:17.209 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce)'
2025-08-08 06:03:17.243 +03:00 [INF] Route matched with {action = "Receive", controller = "PaymentWebhook"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Receive(E_Commerce.DtoModels.PaymentDtos.PaymobWebhookDto) on controller E_Commerce.Controllers.PaymentWebhookController (E-Commerce).
2025-08-08 06:03:17.349 +03:00 [INF] Executing CreateAsync for entity PaymentWebhook
2025-08-08 06:03:17.455 +03:00 [INF] PaymentWebhook added successfully (pending save)
2025-08-08 06:03:17.539 +03:00 [ERR] Failed executing DbCommand (28ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (Size = 100), @p2='?' (Size = 20), @p3='?' (DbType = DateTime), @p4='?' (Size = 10), @p5='?' (DbType = DateTime), @p6='?' (Size = 500), @p7='?' (DbType = Boolean), @p8='?' (Size = 50), @p9='?' (DbType = Boolean), @p10='?' (DbType = Boolean), @p11='?' (DbType = Boolean), @p12='?' (DbType = Boolean), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = Int32), @p16='?' (Size = 50), @p17='?' (Size = 50), @p18='?' (DbType = DateTime), @p19='?' (Size = 50), @p20='?' (Size = 100), @p21='?' (Size = 500), @p22='?' (Size = 100), @p23='?' (DbType = Int32), @p24='?' (Size = 100), @p25='?' (Size = 50), @p26='?' (Size = 50), @p27='?' (DbType = Boolean), @p28='?' (DbType = Int64), @p29='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `PaymentWebhooks` (`AmountCents`, `AuthorizationCode`, `CardLast4`, `CreatedAt`, `Currency`, `DeletedAt`, `ErrorMessage`, `HmacVerified`, `IntegrationId`, `Is3DSecure`, `IsCapture`, `IsRefunded`, `IsVoided`, `ModifiedAt`, `OrderId`, `PaymentId`, `PaymentMethod`, `PaymentProvider`, `ProcessedAt`, `ProfileId`, `ProviderOrderId`, `RawData`, `ReceiptNumber`, `RetryCount`, `SourceIssuer`, `SourceSubType`, `Status`, `Success`, `TransactionId`, `WebhookUniqueKey`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29);
SELECT `Id`
FROM `PaymentWebhooks`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:03:17.602 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-08 06:03:17.619 +03:00 [ERR] Error processing PayMob webhook
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync()
   at E_Commerce.Services.PaymentWebhookService.HandlePaymobAsync(PaymobWebhookDto dto)
   at E_Commerce.Controllers.PaymentWebhookController.Receive(PaymobWebhookDto payload)
2025-08-08 06:03:17.637 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-08 06:03:17.661 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce) in 412.3941ms
2025-08-08 06:03:17.666 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce)'
2025-08-08 06:03:17.672 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/payments/webhook/paymob - 500 201 application/problem+json; charset=utf-8 508.5943ms
2025-08-08 06:04:11.849 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 06:05:06.558 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:05:06.602 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 43.8701ms
2025-08-08 06:05:06.673 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:05:06.676 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:05:06.676 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:05:06.679 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.0793ms
2025-08-08 06:05:06.698 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 21.4414ms
2025-08-08 06:05:06.711 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.1282ms
2025-08-08 06:05:06.849 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:05:07.028 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 178.8562ms
2025-08-08 06:05:30.276 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/payments/webhook/paymob - application/json-patch+json 560
2025-08-08 06:05:30.286 +03:00 [INF] CORS policy execution successful.
2025-08-08 06:05:30.288 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:05:30.290 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce)'
2025-08-08 06:05:30.297 +03:00 [INF] Route matched with {action = "Receive", controller = "PaymentWebhook"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Receive(E_Commerce.DtoModels.PaymentDtos.PaymobWebhookDto) on controller E_Commerce.Controllers.PaymentWebhookController (E-Commerce).
2025-08-08 06:05:30.325 +03:00 [INF] Executing CreateAsync for entity PaymentWebhook
2025-08-08 06:05:30.331 +03:00 [INF] PaymentWebhook added successfully (pending save)
2025-08-08 06:05:30.337 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (Size = 100), @p2='?' (Size = 20), @p3='?' (DbType = DateTime), @p4='?' (Size = 10), @p5='?' (DbType = DateTime), @p6='?' (Size = 500), @p7='?' (DbType = Boolean), @p8='?' (Size = 50), @p9='?' (DbType = Boolean), @p10='?' (DbType = Boolean), @p11='?' (DbType = Boolean), @p12='?' (DbType = Boolean), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = Int32), @p16='?' (Size = 50), @p17='?' (Size = 50), @p18='?' (DbType = DateTime), @p19='?' (Size = 50), @p20='?' (Size = 100), @p21='?' (Size = 500), @p22='?' (Size = 100), @p23='?' (DbType = Int32), @p24='?' (Size = 100), @p25='?' (Size = 50), @p26='?' (Size = 50), @p27='?' (DbType = Boolean), @p28='?' (DbType = Int64), @p29='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `PaymentWebhooks` (`AmountCents`, `AuthorizationCode`, `CardLast4`, `CreatedAt`, `Currency`, `DeletedAt`, `ErrorMessage`, `HmacVerified`, `IntegrationId`, `Is3DSecure`, `IsCapture`, `IsRefunded`, `IsVoided`, `ModifiedAt`, `OrderId`, `PaymentId`, `PaymentMethod`, `PaymentProvider`, `ProcessedAt`, `ProfileId`, `ProviderOrderId`, `RawData`, `ReceiptNumber`, `RetryCount`, `SourceIssuer`, `SourceSubType`, `Status`, `Success`, `TransactionId`, `WebhookUniqueKey`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29);
SELECT `Id`
FROM `PaymentWebhooks`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:05:30.346 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-08 06:05:30.363 +03:00 [ERR] Error processing PayMob webhook
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync()
   at E_Commerce.Services.PaymentWebhookService.HandlePaymobAsync(PaymobWebhookDto dto)
   at E_Commerce.Controllers.PaymentWebhookController.Receive(PaymobWebhookDto payload)
2025-08-08 06:05:30.374 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-08 06:05:30.377 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce) in 74.0819ms
2025-08-08 06:05:30.380 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce)'
2025-08-08 06:05:30.382 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/payments/webhook/paymob - 500 201 application/problem+json; charset=utf-8 105.7885ms
2025-08-08 06:09:44.218 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/payments/webhook/paymob - application/json-patch+json 560
2025-08-08 06:09:44.276 +03:00 [INF] CORS policy execution successful.
2025-08-08 06:09:44.283 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:09:44.287 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce)'
2025-08-08 06:09:44.290 +03:00 [INF] Route matched with {action = "Receive", controller = "PaymentWebhook"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Receive(E_Commerce.DtoModels.PaymentDtos.PaymobWebhookDto) on controller E_Commerce.Controllers.PaymentWebhookController (E-Commerce).
2025-08-08 06:09:44.324 +03:00 [INF] Executing CreateAsync for entity PaymentWebhook
2025-08-08 06:09:44.331 +03:00 [INF] PaymentWebhook added successfully (pending save)
2025-08-08 06:09:44.346 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (Size = 100), @p2='?' (Size = 20), @p3='?' (DbType = DateTime), @p4='?' (Size = 10), @p5='?' (DbType = DateTime), @p6='?' (Size = 500), @p7='?' (DbType = Boolean), @p8='?' (Size = 50), @p9='?' (DbType = Boolean), @p10='?' (DbType = Boolean), @p11='?' (DbType = Boolean), @p12='?' (DbType = Boolean), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = Int32), @p16='?' (Size = 50), @p17='?' (Size = 50), @p18='?' (DbType = DateTime), @p19='?' (Size = 50), @p20='?' (Size = 100), @p21='?' (Size = 500), @p22='?' (Size = 100), @p23='?' (DbType = Int32), @p24='?' (Size = 100), @p25='?' (Size = 50), @p26='?' (Size = 50), @p27='?' (DbType = Boolean), @p28='?' (DbType = Int64), @p29='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `PaymentWebhooks` (`AmountCents`, `AuthorizationCode`, `CardLast4`, `CreatedAt`, `Currency`, `DeletedAt`, `ErrorMessage`, `HmacVerified`, `IntegrationId`, `Is3DSecure`, `IsCapture`, `IsRefunded`, `IsVoided`, `ModifiedAt`, `OrderId`, `PaymentId`, `PaymentMethod`, `PaymentProvider`, `ProcessedAt`, `ProfileId`, `ProviderOrderId`, `RawData`, `ReceiptNumber`, `RetryCount`, `SourceIssuer`, `SourceSubType`, `Status`, `Success`, `TransactionId`, `WebhookUniqueKey`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29);
SELECT `Id`
FROM `PaymentWebhooks`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:09:44.361 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-08 06:09:44.381 +03:00 [ERR] Error processing PayMob webhook
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`paymentwebhooks`, CONSTRAINT `FK_PaymentWebhooks_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`) ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync()
   at E_Commerce.Services.PaymentWebhookService.HandlePaymobAsync(PaymobWebhookDto dto)
   at E_Commerce.Controllers.PaymentWebhookController.Receive(PaymobWebhookDto payload)
2025-08-08 06:09:44.401 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-08 06:09:44.405 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce) in 109.8766ms
2025-08-08 06:09:44.408 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentWebhookController.Receive (E-Commerce)'
2025-08-08 06:09:44.411 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/payments/webhook/paymob - 500 201 application/problem+json; charset=utf-8 193.0035ms
2025-08-08 06:13:23.196 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - multipart/form-data; boundary=--------------------------437240035502656397249802 506
2025-08-08 06:13:23.226 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:13:23.264 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:13:23.271 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:13:23.316 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 06:13:23.370 +03:00 [INF] Starting UpdatePaymentMethod for ID 2 by user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:13:23.378 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:13:23.384 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:13:23.391 +03:00 [INF] Updating payment method: visa
2025-08-08 06:13:23.401 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `PaymentMethods` SET `Name` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 06:13:23.407 +03:00 [INF] Payment method updated successfully with ID 2
2025-08-08 06:13:23.409 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:13:23.411 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:13:23.421 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:13:23.422 +03:00 [INF] Admin operation logged for payment method update 2
2025-08-08 06:13:23.518 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:13:23.635 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:13:23.641 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 320.5961ms
2025-08-08 06:13:23.646 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:13:23.649 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - 200 122 application/json; charset=utf-8 454.5445ms
2025-08-08 06:13:33.049 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-08 06:13:33.055 +03:00 [WRN] No cache entries found for tag: Paymentmethodcache
2025-08-08 06:13:57.526 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 06:13:59.178 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 06:13:59.580 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:13:59.599 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:13:59.635 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 06:13:59.660 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 06:13:59.700 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 06:14:00.152 +03:00 [INF] Executed DbCommand (58ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:14:00.248 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:14:00.277 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 06:14:01.185 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 06:14:01.335 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 06:14:01.352 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:14:01.395 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 06:14:01.435 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 06:14:01.437 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 06:14:01.444 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 06:14:01.483 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 06:14:01.485 +03:00 [INF] Hosting environment: Development
2025-08-08 06:14:01.493 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 06:14:01.726 +03:00 [INF] Server mrrobot:3804:9106e804 successfully announced in 143.5062 ms
2025-08-08 06:14:01.733 +03:00 [INF] Server mrrobot:3804:9106e804 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 06:14:01.779 +03:00 [INF] Server mrrobot:3804:9106e804 all the dispatchers started
2025-08-08 06:14:03.091 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1739.9763ms
2025-08-08 06:14:03.235 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:14:03.235 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:14:03.241 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:14:03.247 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 12.6984ms
2025-08-08 06:14:03.267 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 25.793ms
2025-08-08 06:14:03.319 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 84.5968ms
2025-08-08 06:14:04.423 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:14:04.850 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 426.4753ms
2025-08-08 06:14:23.964 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - multipart/form-data; boundary=--------------------------653626727540508868771912 506
2025-08-08 06:14:23.974 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 06:14:24.519 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:14:24.590 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:14:24.611 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:14:24.644 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 06:14:24.804 +03:00 [INF] Starting UpdatePaymentMethod for ID 2 by user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:14:24.839 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:14:24.852 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:14:24.890 +03:00 [INF] Updating payment method: visa
2025-08-08 06:14:24.945 +03:00 [INF] Payment method updated successfully with ID 2
2025-08-08 06:14:24.948 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:14:24.952 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:14:25.031 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:14:25.041 +03:00 [INF] Admin operation logged for payment method update 2
2025-08-08 06:14:25.181 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:14:25.388 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:14:25.442 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 788.1682ms
2025-08-08 06:14:25.449 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:14:25.457 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - 200 122 application/json; charset=utf-8 1492.7611ms
2025-08-08 06:14:32.492 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-08 06:14:32.509 +03:00 [WRN] No cache entries found for tag: Paymentmethodcache
2025-08-08 06:15:31.501 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - multipart/form-data; boundary=--------------------------788974854102497233602810 505
2025-08-08 06:15:31.513 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:15:31.529 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:15:31.541 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:15:31.545 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 06:15:31.561 +03:00 [INF] Starting UpdatePaymentMethod for ID 2 by user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:15:31.574 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:15:31.579 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:15:31.588 +03:00 [INF] Updating payment method: visa
2025-08-08 06:15:31.590 +03:00 [INF] Payment method updated successfully with ID 2
2025-08-08 06:15:31.591 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:15:31.593 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:15:31.602 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:15:31.606 +03:00 [INF] Admin operation logged for payment method update 2
2025-08-08 06:15:31.622 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:15:31.680 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:15:31.684 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 130.379ms
2025-08-08 06:15:31.686 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:15:31.691 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - 200 122 application/json; charset=utf-8 189.4577ms
2025-08-08 06:15:32.489 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-08 06:15:32.494 +03:00 [WRN] No cache entries found for tag: Paymentmethodcache
2025-08-08 06:16:29.221 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:16:29.242 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 21.4017ms
2025-08-08 06:16:29.283 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:16:29.287 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 4.3952ms
2025-08-08 06:16:29.301 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:16:29.305 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 4.1197ms
2025-08-08 06:16:29.315 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:16:29.324 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 8.4032ms
2025-08-08 06:16:29.873 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:16:30.088 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 215.4242ms
2025-08-08 06:16:33.315 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - multipart/form-data; boundary=--------------------------308354526188651619340008 505
2025-08-08 06:16:33.323 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:16:33.327 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:16:33.333 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:16:33.341 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-08 06:16:33.375 +03:00 [INF] Starting UpdatePaymentMethod for ID 2 by user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:33.383 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:16:33.386 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:16:33.390 +03:00 [INF] Updating payment method: visa
2025-08-08 06:16:33.401 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `PaymentMethods` SET `IntegrationId` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 06:16:33.411 +03:00 [INF] Payment method updated successfully with ID 2
2025-08-08 06:16:33.413 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:16:33.414 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:16:33.416 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:16:33.418 +03:00 [INF] Admin operation logged for payment method update 2
2025-08-08 06:16:33.421 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:16:33.439 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:16:33.442 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 88.709ms
2025-08-08 06:16:33.445 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-08 06:16:33.447 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - 200 122 application/json; charset=utf-8 131.7386ms
2025-08-08 06:16:42.555 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-08 06:16:42.629 +03:00 [WRN] No cache entries found for tag: Paymentmethodcache
2025-08-08 06:16:53.918 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:16:53.931 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:16:53.937 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:16:53.945 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:16:53.960 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:16:54.324 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:16:54.331 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:54.395 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:16:54.426 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:16:54.437 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:54.448 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:16:54.460 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:54.465 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:54.479 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:54.483 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:16:54.489 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:16:54.760 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:16:54.785 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:54.865 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:16:54.875 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:16:54.884 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:16:54.966 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:16:55.037 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:16:55.053 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:16:55.087 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:16:55.091 +03:00 [INF] Clearing cart: 1
2025-08-08 06:16:55.102 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:16:55.140 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:16:55.142 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:16:55.153 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:16:55.192 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:16:55.208 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:16:55.213 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:16:55.243 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:16:55.254 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:16:55.262 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:16:55.272 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:16:55.274 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:16:55.291 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:16:55.300 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:16:55.304 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:16:55.307 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:16:55.322 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:16:55.337 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:16:55.345 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:16:56.176 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:16:56.183 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:16:56.225 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:16:56.792 +03:00 [INF] Successfully created PayMob order: 367506461 for local order: 19
2025-08-08 06:16:56.797 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:16:56.805 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:16:56.812 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-08 06:16:56.820 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 367506461, Amount: 100000
2025-08-08 06:16:57.309 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-08 06:16:57.311 +03:00 [ERR] Failed to get payment key from Paymob. Status: "BadRequest", Response: {"billing_data":{"first_name":["This field may not be blank."]}}
2025-08-08 06:16:57.341 +03:00 [ERR] Failed to generate payment key from PayMob for order: 19
2025-08-08 06:16:57.346 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 06:16:57.366 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:16:57.375 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 3409.2036ms
2025-08-08 06:16:57.380 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:16:57.384 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 3465.9199ms
2025-08-08 06:17:51.526 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:17:51.556 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 30.1013ms
2025-08-08 06:17:51.604 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:17:51.608 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 3.5863ms
2025-08-08 06:17:51.633 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:17:51.636 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:17:51.641 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 4.8404ms
2025-08-08 06:17:51.651 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 18.3134ms
2025-08-08 06:17:52.021 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:17:52.184 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 163.4834ms
2025-08-08 06:18:09.465 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 06:18:11.129 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 06:18:11.555 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:18:11.572 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:18:11.609 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 06:18:11.633 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 06:18:11.674 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 06:18:12.121 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:18:12.220 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:18:12.254 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 06:18:12.996 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 06:18:13.112 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 06:18:13.180 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 06:18:13.182 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 06:18:13.183 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 06:18:13.185 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 06:18:13.224 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 06:18:13.228 +03:00 [INF] Hosting environment: Development
2025-08-08 06:18:13.232 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 06:18:13.304 +03:00 [INF] Server mrrobot:19444:7b5d5bb6 successfully announced in 65.4894 ms
2025-08-08 06:18:13.338 +03:00 [INF] Server mrrobot:19444:7b5d5bb6 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 06:18:13.355 +03:00 [INF] 1 servers were removed due to timeout
2025-08-08 06:18:13.416 +03:00 [INF] Server mrrobot:19444:7b5d5bb6 all the dispatchers started
2025-08-08 06:18:13.505 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:18:14.012 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 504.7909ms
2025-08-08 06:18:14.307 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:18:14.316 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.9729ms
2025-08-08 06:18:15.415 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:18:15.415 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:18:15.435 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 21.122ms
2025-08-08 06:18:15.653 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 238.7552ms
2025-08-08 06:18:15.696 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:18:15.959 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 263.0885ms
2025-08-08 06:18:21.548 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:18:21.560 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 06:18:21.934 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:18:22.025 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:18:22.059 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:18:22.107 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:18:22.983 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:18:22.990 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:18:23.050 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:18:23.065 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:18:23.072 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:18:23.078 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:18:23.088 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:18:23.091 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:18:23.104 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:18:23.107 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:18:23.112 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:18:23.377 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:18:23.455 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:18:23.537 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:18:23.546 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:18:23.554 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:18:23.693 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:18:23.917 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:18:23.973 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:18:24.014 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:18:24.017 +03:00 [INF] Clearing cart: 1
2025-08-08 06:18:24.029 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:18:24.073 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:18:24.076 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:18:24.090 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:18:24.142 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:18:24.160 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:18:24.164 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:18:24.197 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:18:24.204 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:18:24.211 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:18:24.219 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:18:24.221 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:18:24.240 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:18:24.248 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:18:24.253 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:18:24.262 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:18:24.324 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:18:24.338 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:18:24.344 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:18:25.124 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:18:25.132 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:18:25.173 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:18:25.740 +03:00 [INF] Successfully created PayMob order: 367506611 for local order: 20
2025-08-08 06:18:25.743 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:18:25.753 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:18:25.757 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-08 06:18:25.769 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 367506611, Amount: 100000
2025-08-08 06:18:26.255 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-08 06:18:26.259 +03:00 [ERR] Failed to get payment key from Paymob. Status: "BadRequest", Response: {"billing_data":{"first_name":["This field may not be blank."]}}
2025-08-08 06:18:26.388 +03:00 [ERR] Failed to generate payment key from PayMob for order: 20
2025-08-08 06:18:26.390 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 06:18:26.425 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:18:26.479 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 4362.0346ms
2025-08-08 06:18:26.483 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:18:26.491 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 4942.9258ms
2025-08-08 06:19:51.929 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 06:19:53.689 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 06:19:54.101 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:19:54.117 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:19:54.154 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 06:19:54.179 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 06:19:54.212 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 06:19:54.650 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:19:54.772 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:19:54.815 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 06:19:55.989 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 06:19:56.199 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 06:19:56.419 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 06:19:56.422 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 06:19:56.426 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 06:19:56.429 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 06:19:56.468 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 06:19:56.524 +03:00 [INF] Hosting environment: Development
2025-08-08 06:19:56.526 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 06:19:56.535 +03:00 [INF] Server mrrobot:12452:748aba60 successfully announced in 67.5851 ms
2025-08-08 06:19:56.541 +03:00 [INF] Server mrrobot:12452:748aba60 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 06:19:56.678 +03:00 [INF] Server mrrobot:12452:748aba60 all the dispatchers started
2025-08-08 06:19:56.820 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:19:57.115 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 295.2771ms
2025-08-08 06:19:57.259 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:19:57.265 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:19:57.266 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.8333ms
2025-08-08 06:19:57.338 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:19:57.346 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.1394ms
2025-08-08 06:19:57.363 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 98.6556ms
2025-08-08 06:19:58.262 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:19:58.730 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 468.3342ms
2025-08-08 06:19:58.733 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:19:58.757 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 06:19:59.010 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:19:59.153 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:19:59.212 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:19:59.290 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:20:00.360 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:20:00.370 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:20:00.491 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:20:00.510 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:20:00.516 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:20:00.531 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:20:00.545 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:20:00.549 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:20:00.564 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:20:00.570 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:20:00.576 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:20:00.908 +03:00 [INF] Executed DbCommand (56ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:20:00.937 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:20:01.054 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:20:01.070 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:20:01.119 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:20:01.390 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:20:01.745 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:20:01.813 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:20:01.877 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:20:01.880 +03:00 [INF] Clearing cart: 1
2025-08-08 06:20:01.898 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:20:01.949 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:20:01.957 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:20:01.974 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:20:02.039 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:20:02.058 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:20:02.061 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:20:02.108 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:20:02.118 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:20:02.128 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:20:02.136 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:20:02.139 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:20:02.173 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:20:02.181 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:20:02.193 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:20:02.207 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:20:02.263 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:20:02.278 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:20:02.286 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:20:03.146 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:20:03.211 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:20:03.264 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:20:03.881 +03:00 [INF] Successfully created PayMob order: 367506787 for local order: 21
2025-08-08 06:20:03.884 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:20:03.905 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:20:03.908 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-08 06:20:03.926 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 367506787, Amount: 100000
2025-08-08 06:20:04.637 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-08 06:20:04.639 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-08 06:20:04.640 +03:00 [INF] Payment key generated successfully for Order ID: 367506787
2025-08-08 06:20:04.643 +03:00 [INF] Successfully generated payment key for order: 21
2025-08-08 06:20:04.644 +03:00 [INF] Payment Key generated successfully for Paymob order: 367506787
2025-08-08 06:20:04.646 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:20:04.657 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:20:04.662 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-08 06:20:04.729 +03:00 [INF] Payment added successfully (pending save)
2025-08-08 06:20:04.845 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:20:04.879 +03:00 [INF] Payment created successfully with ID 1
2025-08-08 06:20:04.882 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:20:04.889 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:20:04.930 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:20:04.959 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:20:04.991 +03:00 [INF] Getting order by ID: 21
2025-08-08 06:20:05.144 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-08 06:20:05.164 +03:00 [INF] Removing cache by tag: order
2025-08-08 06:20:05.169 +03:00 [WRN] No cache entries found for tag: order
2025-08-08 06:20:05.198 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:20:05.383 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 6010.5585ms
2025-08-08 06:20:05.410 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:20:05.425 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 3135 application/json; charset=utf-8 6691.6151ms
2025-08-08 06:23:30.960 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:23:30.973 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:23:30.985 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:23:30.993 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:23:30.996 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:23:31.010 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:23:31.012 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:23:31.027 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:23:31.034 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:23:31.038 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:23:31.042 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:23:31.048 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:23:31.049 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:23:31.052 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:23:31.054 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:23:31.061 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:23:31.119 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:23:31.317 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:23:31.320 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:23:31.325 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:23:31.331 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:23:31.335 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:23:31.346 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:23:31.352 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:23:31.354 +03:00 [WRN] CreateRangeAsync called with null or empty models
2025-08-08 06:23:31.355 +03:00 [INF] Clearing cart: 1
2025-08-08 06:23:31.358 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:23:31.365 +03:00 [INF] No items to clear for cart 1
2025-08-08 06:23:31.366 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:23:31.369 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:23:31.372 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:23:31.376 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:23:31.378 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:23:31.380 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:23:31.382 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:23:31.386 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:23:31.388 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:23:31.394 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:23:31.397 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:23:31.400 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:23:31.402 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:23:31.531 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:23:31.533 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:23:31.538 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:23:32.117 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:23:32.120 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:23:32.124 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:23:32.734 +03:00 [ERR] Failed to create order in PayMob. Status: "BadRequest", Error: {"amount_cents":["Ensure this value is greater than or equal to 10."]}
2025-08-08 06:23:32.738 +03:00 [ERR] Failed to create order in PayMob for OrderId: 22
2025-08-08 06:23:32.740 +03:00 [WRN] Failed to generate online payment link.
2025-08-08 06:23:32.771 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:23:32.784 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 1782.9997ms
2025-08-08 06:23:32.787 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:23:32.789 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 1828.9818ms
2025-08-08 06:24:56.581 +03:00 [INF] 2 servers were removed due to timeout
2025-08-08 06:25:27.372 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:25:27.387 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 15.6091ms
2025-08-08 06:25:27.673 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:25:27.682 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.7579ms
2025-08-08 06:25:27.689 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:25:27.706 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 16.8351ms
2025-08-08 06:25:27.716 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:25:27.720 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 3.8428ms
2025-08-08 06:25:30.747 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:25:30.914 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:25:30.974 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:25:30.989 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:25:31.014 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:25:31.352 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:25:31.472 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:31.517 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:25:31.522 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:25:31.538 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:31.540 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:25:31.552 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:31.555 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:31.557 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:31.570 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:25:31.574 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:25:31.699 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:25:31.989 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:32.221 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:25:32.341 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:25:32.371 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 1101.8977ms
2025-08-08 06:25:32.473 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:25:32.538 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 202 application/json; charset=utf-8 1791.0366ms
2025-08-08 06:25:34.119 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:25:34.365 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 246.0158ms
2025-08-08 06:25:54.025 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-08-08 06:25:54.034 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:25:54.042 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:25:54.046 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:25:54.056 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:25:54.084 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-08 06:25:54.099 +03:00 [INF] Adding item to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:25:54.104 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:25:54.108 +03:00 [INF] Execute GetAll for entity Product
2025-08-08 06:25:54.195 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`, `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Products` AS `p`
LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
LIMIT 1
2025-08-08 06:25:54.274 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-08 06:25:54.290 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:25:54.342 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:54.461 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:25:54.498 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-08 06:25:54.515 +03:00 [INF] CartItem added successfully (pending save)
2025-08-08 06:25:54.517 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:25:54.518 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:25:54.520 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:25:54.595 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:25:54.655 +03:00 [INF] Removing cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:54.658 +03:00 [INF] Cache removed successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:25:54.661 +03:00 [INF] Item added to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:25:54.668 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:25:54.678 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 616.748ms
2025-08-08 06:25:54.680 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:25:54.682 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 656.4823ms
2025-08-08 06:26:23.082 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-08 06:26:23.092 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:26:23.095 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:26:23.100 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:26:23.106 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:26:23.112 +03:00 [INF] Executing CheckOut
2025-08-08 06:26:23.115 +03:00 [INF] Checkout of cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:23.117 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:23.170 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:26:23.195 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 06:26:23.200 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:26:23.203 +03:00 [WRN] No cache entries found for tag: cart
2025-08-08 06:26:23.206 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:26:23.208 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 98.2133ms
2025-08-08 06:26:23.210 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:26:23.211 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 129.2829ms
2025-08-08 06:26:33.126 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:26:33.131 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:26:33.142 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:26:33.172 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:26:33.175 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:26:33.180 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:26:33.181 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:33.191 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:26:33.197 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:26:33.200 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:33.206 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:26:33.212 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:33.213 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:33.214 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:33.216 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:26:33.223 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:26:33.272 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:26:33.277 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:33.287 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:26:33.291 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:26:33.295 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:26:33.297 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:26:33.301 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:26:33.306 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:26:33.308 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:26:33.310 +03:00 [INF] Clearing cart: 1
2025-08-08 06:26:33.314 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:26:33.318 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:26:33.319 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:26:33.322 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:26:33.326 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:26:33.335 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:26:33.337 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:26:33.338 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:26:33.340 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:26:33.343 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:26:33.346 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:26:33.348 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:26:33.350 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:26:33.354 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:26:33.356 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:26:33.359 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:26:33.363 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:26:33.366 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:26:33.369 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:26:34.462 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:26:34.472 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:26:34.476 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:26:34.990 +03:00 [INF] Successfully created PayMob order: 367507432 for local order: 23
2025-08-08 06:26:34.992 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:26:34.995 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:26:34.998 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-08 06:26:35.003 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 367507432, Amount: 100000
2025-08-08 06:26:35.530 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-08 06:26:35.534 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-08 06:26:35.535 +03:00 [INF] Payment key generated successfully for Order ID: 367507432
2025-08-08 06:26:35.537 +03:00 [INF] Successfully generated payment key for order: 23
2025-08-08 06:26:35.538 +03:00 [INF] Payment Key generated successfully for Paymob order: 367507432
2025-08-08 06:26:35.540 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:26:35.542 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:26:35.545 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-08 06:26:35.546 +03:00 [INF] Payment added successfully (pending save)
2025-08-08 06:26:35.568 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:26:35.573 +03:00 [INF] Payment created successfully with ID 2
2025-08-08 06:26:35.574 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:26:35.576 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:26:35.578 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:26:35.583 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:26:35.590 +03:00 [INF] Getting order by ID: 23
2025-08-08 06:26:35.634 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-08 06:26:35.640 +03:00 [INF] Removing cache by tag: order
2025-08-08 06:26:35.642 +03:00 [WRN] No cache entries found for tag: order
2025-08-08 06:26:35.644 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:26:35.647 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 2467.7513ms
2025-08-08 06:26:35.652 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:26:35.654 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 3120 application/json; charset=utf-8 2527.8897ms
2025-08-08 06:31:40.313 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:31:40.360 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 47.2507ms
2025-08-08 06:31:40.594 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:31:40.597 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 3.1397ms
2025-08-08 06:31:41.129 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:31:41.145 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 16.0257ms
2025-08-08 06:31:41.201 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:31:41.207 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.1694ms
2025-08-08 06:31:41.662 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:31:41.886 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 223.8152ms
2025-08-08 06:31:58.819 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-08-08 06:31:58.842 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:31:58.871 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:31:58.883 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:31:58.906 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:31:58.927 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-08 06:31:58.930 +03:00 [INF] Adding item to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:31:58.943 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:31:58.955 +03:00 [INF] Execute GetAll for entity Product
2025-08-08 06:31:58.968 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`, `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Products` AS `p`
LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
LIMIT 1
2025-08-08 06:31:58.976 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-08 06:31:58.982 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:31:58.989 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:31:59.121 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:31:59.147 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-08 06:31:59.159 +03:00 [INF] CartItem added successfully (pending save)
2025-08-08 06:31:59.163 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:31:59.166 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:31:59.169 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:31:59.186 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:31:59.198 +03:00 [INF] Removing cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:31:59.206 +03:00 [INF] Cache removed successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:31:59.208 +03:00 [INF] Item added to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:31:59.211 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:31:59.216 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 305.9826ms
2025-08-08 06:31:59.218 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:31:59.226 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 405.8456ms
2025-08-08 06:32:11.050 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-08 06:32:11.062 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:32:11.077 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:32:11.085 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:32:11.095 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:32:11.102 +03:00 [INF] Executing CheckOut
2025-08-08 06:32:11.105 +03:00 [INF] Checkout of cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:11.109 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:11.158 +03:00 [INF] Executed DbCommand (45ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:32:11.180 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 06:32:11.185 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:32:11.189 +03:00 [WRN] No cache entries found for tag: cart
2025-08-08 06:32:11.192 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:32:11.196 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 96.2293ms
2025-08-08 06:32:11.198 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:32:11.201 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 150.7489ms
2025-08-08 06:32:39.900 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:32:39.910 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:32:39.917 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:32:39.925 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:32:39.932 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:32:39.941 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:32:39.944 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:39.948 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:32:39.959 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:32:39.968 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:39.973 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:32:39.978 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:39.980 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:39.984 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:40.015 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:32:40.019 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:32:40.077 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:32:40.085 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:40.108 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:32:40.113 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:32:40.117 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:32:40.120 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:32:40.125 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:32:40.131 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:32:40.132 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:32:40.134 +03:00 [INF] Clearing cart: 1
2025-08-08 06:32:40.136 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:32:40.140 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:32:40.142 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:32:40.146 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:32:40.150 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:32:40.155 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:32:40.160 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:32:40.162 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:32:40.164 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:32:40.166 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:32:40.170 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:32:40.173 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:32:40.176 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:32:40.180 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:32:40.181 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:32:40.183 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:32:40.197 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:32:40.200 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:32:40.204 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:32:40.963 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:32:40.966 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:32:40.970 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:32:41.497 +03:00 [INF] Successfully created PayMob order: 367508062 for local order: 24
2025-08-08 06:32:41.501 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:32:41.516 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:32:41.524 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-08 06:32:41.527 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 367508062, Amount: 100000
2025-08-08 06:32:42.028 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-08 06:32:42.031 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-08 06:32:42.032 +03:00 [INF] Payment key generated successfully for Order ID: 367508062
2025-08-08 06:32:42.037 +03:00 [INF] Successfully generated payment key for order: 24
2025-08-08 06:32:42.040 +03:00 [INF] Payment Key generated successfully for Paymob order: 367508062
2025-08-08 06:32:42.042 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:32:42.045 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:32:42.050 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-08 06:32:42.054 +03:00 [INF] Payment added successfully (pending save)
2025-08-08 06:32:42.061 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:32:42.070 +03:00 [INF] Payment created successfully with ID 3
2025-08-08 06:32:42.073 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:32:42.075 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:32:42.078 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:32:42.083 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:32:42.090 +03:00 [INF] Getting order by ID: 24
2025-08-08 06:32:42.130 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-08 06:32:42.135 +03:00 [INF] Removing cache by tag: order
2025-08-08 06:32:42.138 +03:00 [WRN] No cache entries found for tag: order
2025-08-08 06:32:42.140 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:32:42.143 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 2206.1614ms
2025-08-08 06:32:42.147 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:32:42.149 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 3071 application/json; charset=utf-8 2248.462ms
2025-08-08 06:43:00.174 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-08-08 06:43:00.292 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:43:00.376 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:43:00.393 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:43:00.402 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:43:00.431 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-08 06:43:00.434 +03:00 [INF] Adding item to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:43:00.461 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:43:00.471 +03:00 [INF] Execute GetAll for entity Product
2025-08-08 06:43:00.490 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`, `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Products` AS `p`
LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
LIMIT 1
2025-08-08 06:43:00.512 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-08 06:43:00.517 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:43:00.524 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:00.577 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:43:00.590 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-08 06:43:00.594 +03:00 [INF] CartItem added successfully (pending save)
2025-08-08 06:43:00.596 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:43:00.598 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:43:00.600 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:43:00.616 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:43:00.625 +03:00 [INF] Removing cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:00.631 +03:00 [INF] Cache removed successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:00.633 +03:00 [INF] Item added to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:43:00.636 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:43:00.640 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 230.8352ms
2025-08-08 06:43:00.643 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:43:00.646 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 476.1228ms
2025-08-08 06:43:05.127 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-08 06:43:05.134 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:43:05.139 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:43:05.145 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:43:05.148 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:43:05.154 +03:00 [INF] Executing CheckOut
2025-08-08 06:43:05.155 +03:00 [INF] Checkout of cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:05.157 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:05.196 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:43:05.210 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 06:43:05.215 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:43:05.218 +03:00 [WRN] No cache entries found for tag: cart
2025-08-08 06:43:05.219 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:43:05.222 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 70.3177ms
2025-08-08 06:43:05.224 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:43:05.227 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 99.8719ms
2025-08-08 06:43:13.290 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:43:13.298 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:43:13.303 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:43:13.308 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:43:13.310 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:43:13.316 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:43:13.318 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:13.323 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:43:13.329 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:43:13.335 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:13.340 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:43:13.344 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:13.347 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:13.349 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:13.352 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:43:13.356 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:43:13.404 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:43:13.417 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:13.423 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:43:13.426 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:43:13.430 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:43:13.433 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:43:13.439 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:43:13.444 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:43:13.446 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:43:13.447 +03:00 [INF] Clearing cart: 1
2025-08-08 06:43:13.450 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:43:13.454 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:43:13.455 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:43:13.461 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:43:13.465 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:43:13.473 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:43:13.475 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:43:13.477 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:43:13.479 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:43:13.481 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:43:13.484 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:43:13.486 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:43:13.488 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:43:13.492 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:43:13.494 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:43:13.496 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:43:13.500 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:43:13.502 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:43:13.506 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:43:14.253 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:43:14.257 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:43:14.261 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:43:14.754 +03:00 [INF] Successfully created PayMob order: 367509175 for local order: 25
2025-08-08 06:43:14.758 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:43:14.761 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:43:14.766 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-08 06:43:14.768 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 367509175, Amount: 100000
2025-08-08 06:43:15.285 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-08 06:43:15.288 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-08 06:43:15.290 +03:00 [INF] Payment key generated successfully for Order ID: 367509175
2025-08-08 06:43:15.292 +03:00 [INF] Successfully generated payment key for order: 25
2025-08-08 06:43:15.294 +03:00 [INF] Payment Key generated successfully for Paymob order: 367509175
2025-08-08 06:43:15.296 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:43:15.298 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:43:15.302 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-08 06:43:15.305 +03:00 [INF] Payment added successfully (pending save)
2025-08-08 06:43:15.311 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:43:15.318 +03:00 [INF] Payment created successfully with ID 4
2025-08-08 06:43:15.322 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:43:15.324 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:43:15.326 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:43:15.329 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:43:15.336 +03:00 [INF] Getting order by ID: 25
2025-08-08 06:43:15.386 +03:00 [INF] Executed DbCommand (45ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-08 06:43:15.393 +03:00 [INF] Removing cache by tag: order
2025-08-08 06:43:15.397 +03:00 [WRN] No cache entries found for tag: order
2025-08-08 06:43:15.399 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:43:15.405 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 2092.2739ms
2025-08-08 06:43:15.408 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:43:15.411 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 3071 application/json; charset=utf-8 2121.3056ms
2025-08-08 06:44:32.117 +03:00 [INF] DB tables already exist. Exit install
2025-08-08 06:44:35.302 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-08 06:44:36.231 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:44:36.282 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-08 06:44:36.376 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-08 06:44:36.441 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-08 06:44:36.529 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-08 06:44:37.418 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:44:37.595 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-08 06:44:37.665 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-08 06:44:40.403 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-08 06:44:40.790 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-08 06:44:42.004 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-08 06:44:42.122 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-08 06:44:42.174 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-08 06:44:42.283 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-08 06:44:42.321 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-08 06:44:42.741 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-08 06:44:42.880 +03:00 [INF] Hosting environment: Development
2025-08-08 06:44:42.885 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-08 06:44:43.001 +03:00 [INF] Server mrrobot:10916:e47ad248 successfully announced in 121.1782 ms
2025-08-08 06:44:43.130 +03:00 [INF] Server mrrobot:10916:e47ad248 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-08 06:44:44.314 +03:00 [INF] Server mrrobot:10916:e47ad248 all the dispatchers started
2025-08-08 06:44:44.536 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 2428.6204ms
2025-08-08 06:44:45.265 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-08 06:44:45.279 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 14.1029ms
2025-08-08 06:44:45.455 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-08 06:44:45.472 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 17.3653ms
2025-08-08 06:44:45.484 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-08 06:44:47.942 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 2457.0898ms
2025-08-08 06:44:48.130 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-08 06:44:48.564 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 434.4896ms
2025-08-08 06:46:16.413 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-08-08 06:46:16.429 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-08 06:46:16.923 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:46:16.991 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:46:17.036 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:46:17.104 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:46:17.862 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-08 06:46:17.871 +03:00 [INF] Adding item to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:46:17.982 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:46:17.987 +03:00 [INF] Execute GetAll for entity Product
2025-08-08 06:46:18.108 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`, `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Products` AS `p`
LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
LIMIT 1
2025-08-08 06:46:18.221 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-08 06:46:18.233 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:46:18.331 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:18.535 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:46:18.583 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-08 06:46:18.722 +03:00 [INF] CartItem added successfully (pending save)
2025-08-08 06:46:18.725 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:46:18.729 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:46:18.784 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:46:19.386 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:46:19.508 +03:00 [INF] Removing cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:19.617 +03:00 [INF] Cache removed successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:19.627 +03:00 [INF] Item added to cart for user: 1c431918-0061-41d2-a418-24bd6c056eda, product: 1
2025-08-08 06:46:19.701 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:46:19.783 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2649.7811ms
2025-08-08 06:46:19.815 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-08 06:46:19.860 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 3446.6798ms
2025-08-08 06:46:25.568 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-08 06:46:26.126 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:46:26.141 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:46:26.149 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:46:26.159 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-08 06:46:26.170 +03:00 [INF] Executing CheckOut
2025-08-08 06:46:26.173 +03:00 [INF] Checkout of cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:26.175 +03:00 [INF] Retrieving cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:26.250 +03:00 [INF] Executed DbCommand (70ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-08 06:46:26.288 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-08 06:46:26.308 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:46:26.326 +03:00 [WRN] No cache entries found for tag: cart
2025-08-08 06:46:26.358 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-08 06:46:26.364 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 198.9122ms
2025-08-08 06:46:26.367 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-08 06:46:26.369 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 803.2244ms
2025-08-08 06:46:37.073 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 63
2025-08-08 06:46:37.082 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-08 06:46:37.089 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-08 06:46:37.101 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:46:37.107 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-08 06:46:37.141 +03:00 [INF] Executing CreateOrderFromCart
2025-08-08 06:46:37.153 +03:00 [INF] Creating order from cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:37.169 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-08 06:46:37.181 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:46:37.190 +03:00 [INF] Checking if address 1 exists for customer: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:37.200 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:46:37.209 +03:00 [INF] Getting cart for user: 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:37.214 +03:00 [INF] Getting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:37.222 +03:00 [WRN] Cache miss for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:37.224 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-08 06:46:37.230 +03:00 [INF] Execute GetAll for entity Cart
2025-08-08 06:46:37.452 +03:00 [INF] Executed DbCommand (67ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-08 06:46:37.496 +03:00 [INF] Setting cache for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:37.609 +03:00 [INF] Cache set successfully for key: cart_user_1c431918-0061-41d2-a418-24bd6c056eda with tags: [cart]
2025-08-08 06:46:37.620 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-08 06:46:37.626 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-08 06:46:37.707 +03:00 [INF] Order added successfully (pending save)
2025-08-08 06:46:37.739 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:46:37.754 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-08 06:46:37.789 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-08 06:46:37.792 +03:00 [INF] Clearing cart: 1
2025-08-08 06:46:37.809 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-08 06:46:37.819 +03:00 [INF] Cart 1 cleared successfully
2025-08-08 06:46:37.821 +03:00 [INF] Removing cache by tag: cart
2025-08-08 06:46:37.829 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-08 06:46:37.853 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:46:37.869 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-08 06:46:37.872 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-08 06:46:37.916 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-08 06:46:37.926 +03:00 [INF] Starting CreatePaymentMethod for user 1c431918-0061-41d2-a418-24bd6c056eda
2025-08-08 06:46:37.948 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-08 06:46:37.955 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-08 06:46:37.958 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:46:37.976 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:46:37.984 +03:00 [INF] Found payment method ID 2 for enum "Visa"
2025-08-08 06:46:37.989 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-08 06:46:37.997 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-08 06:46:38.036 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:46:38.046 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:46:38.054 +03:00 [INF] Executing GetTokenAsync
2025-08-08 06:46:38.959 +03:00 [INF] Successfully retrieved PayMob token
2025-08-08 06:46:38.973 +03:00 [INF] Getting address by ID: 1
2025-08-08 06:46:39.007 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-08 06:46:39.623 +03:00 [INF] Successfully created PayMob order: 367509570 for local order: 26
2025-08-08 06:46:39.625 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-08 06:46:39.676 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-08 06:46:39.691 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-08 06:46:39.710 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 367509570, Amount: 40000
2025-08-08 06:46:40.257 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-08 06:46:40.259 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-08 06:46:40.265 +03:00 [INF] Payment key generated successfully for Order ID: 367509570
2025-08-08 06:46:40.267 +03:00 [INF] Successfully generated payment key for order: 26
2025-08-08 06:46:40.268 +03:00 [INF] Payment Key generated successfully for Paymob order: 367509570
2025-08-08 06:46:40.270 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-08 06:46:40.275 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-08 06:46:40.283 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-08 06:46:40.355 +03:00 [INF] Payment added successfully (pending save)
2025-08-08 06:46:40.484 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:46:40.502 +03:00 [INF] Payment created successfully with ID 5
2025-08-08 06:46:40.504 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-08 06:46:40.505 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-08 06:46:40.509 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-08 06:46:40.514 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-08 06:46:40.530 +03:00 [INF] Getting order by ID: 26
2025-08-08 06:46:40.688 +03:00 [INF] Executed DbCommand (54ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-08 06:46:40.703 +03:00 [INF] Removing cache by tag: order
2025-08-08 06:46:40.705 +03:00 [WRN] No cache entries found for tag: order
2025-08-08 06:46:40.716 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-08 06:46:40.830 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 3717.0628ms
2025-08-08 06:46:40.850 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-08 06:46:40.852 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 3063 application/json; charset=utf-8 3779.7799ms
2025-08-08 06:49:44.029 +03:00 [INF] 1 servers were removed due to timeout
