2025-08-06 04:34:15.236 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 04:34:17.876 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:34:17.897 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:34:17.998 +03:00 [INF] Executed DbCommand (69ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 04:34:18.028 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 04:34:18.072 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 04:34:18.540 +03:00 [INF] Executed DbCommand (58ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:34:18.637 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:34:18.709 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 04:34:20.276 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 04:34:20.426 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 04:34:20.463 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 04:34:20.465 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 04:34:20.467 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 04:34:20.469 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 04:34:20.496 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 04:34:20.500 +03:00 [INF] Hosting environment: Development
2025-08-06 04:34:20.503 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 04:34:20.585 +03:00 [INF] Server mrrobot:17476:fc5d583e successfully announced in 63.0022 ms
2025-08-06 04:34:20.621 +03:00 [INF] Server mrrobot:17476:fc5d583e is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 04:34:20.717 +03:00 [INF] 3 servers were removed due to timeout
2025-08-06 04:34:20.818 +03:00 [INF] Server mrrobot:17476:fc5d583e all the dispatchers started
2025-08-06 04:34:22.086 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:34:22.830 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:34:22.852 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 771.6222ms
2025-08-06 04:34:22.907 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:34:23.073 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 243.1045ms
2025-08-06 04:34:23.119 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:34:23.190 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 71.3426ms
2025-08-06 04:34:23.237 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 329.9495ms
2025-08-06 04:34:23.316 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:34:23.652 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 336.0785ms
2025-08-06 04:34:31.568 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`ImageId`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`
FROM `Categories` AS `c`
WHERE `c`.`DeletedAt` IS NOT NULL
2025-08-06 04:35:08.102 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:35:08.114 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 04:35:10.559 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:35:10.751 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:35:10.804 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:35:10.873 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:35:11.449 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:35:11.457 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:35:11.544 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:35:11.600 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`UserId` = @__userId_0
LIMIT 1
2025-08-06 04:35:11.707 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:35:11.756 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 867.6057ms
2025-08-06 04:35:11.760 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:35:11.774 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 188 application/json; charset=utf-8 3671.5846ms
2025-08-06 04:38:47.495 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-06 04:38:47.512 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:38:47.524 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:38:47.540 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:38:47.559 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:38:47.585 +03:00 [INF] Executing GetCart
2025-08-06 04:38:47.594 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:38:47.601 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:38:47.616 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:38:47.631 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 04:38:47.643 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 04:38:48.016 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 04:38:48.058 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:38:48.226 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 04:38:48.237 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:38:48.277 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 705.3106ms
2025-08-06 04:38:48.286 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:38:48.289 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 936 application/json; charset=utf-8 794.2864ms
2025-08-06 04:39:41.399 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart/is-empty - null null
2025-08-06 04:39:41.416 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:39:41.429 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:39:41.447 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce)'
2025-08-06 04:39:41.460 +03:00 [INF] Route matched with {action = "IsCartEmpty", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] IsCartEmpty() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:39:41.472 +03:00 [INF] Executing IsCartEmpty
2025-08-06 04:39:41.482 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`UserId` = @__userId_0
LIMIT 1
2025-08-06 04:39:41.495 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 04:39:41.511 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce) in 43.1123ms
2025-08-06 04:39:41.515 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce)'
2025-08-06 04:39:41.524 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart/is-empty - 200 130 application/json; charset=utf-8 125.3093ms
2025-08-06 04:44:07.929 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 04:44:09.956 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:44:09.978 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:44:10.023 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 04:44:10.048 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 04:44:10.079 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 04:44:10.547 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:44:10.643 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:44:10.717 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 04:44:11.462 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 04:44:11.651 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 04:44:11.772 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 04:44:11.774 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 04:44:11.776 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 04:44:11.778 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 04:44:11.809 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 04:44:11.853 +03:00 [INF] Server mrrobot:5056:17e260e0 successfully announced in 34.4647 ms
2025-08-06 04:44:11.858 +03:00 [INF] Hosting environment: Development
2025-08-06 04:44:11.909 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 04:44:11.913 +03:00 [INF] Server mrrobot:5056:17e260e0 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 04:44:11.991 +03:00 [INF] Server mrrobot:5056:17e260e0 all the dispatchers started
2025-08-06 04:44:12.103 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:44:12.367 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 264.0617ms
2025-08-06 04:44:12.466 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:44:12.473 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:44:12.476 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 10.3343ms
2025-08-06 04:44:12.522 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:44:12.536 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.58ms
2025-08-06 04:44:12.537 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 63.7323ms
2025-08-06 04:44:13.201 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:44:13.448 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 247.1235ms
2025-08-06 04:44:21.787 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart/is-empty - null null
2025-08-06 04:44:21.847 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 04:44:22.142 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:44:22.256 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:44:22.295 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce)'
2025-08-06 04:44:22.335 +03:00 [INF] Route matched with {action = "IsCartEmpty", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] IsCartEmpty() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:44:23.002 +03:00 [INF] Executing IsCartEmpty
2025-08-06 04:44:23.030 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:44:23.072 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 04:44:23.140 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce) in 786.9784ms
2025-08-06 04:44:23.145 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce)'
2025-08-06 04:44:23.160 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart/is-empty - 200 130 application/json; charset=utf-8 1373.1265ms
2025-08-06 04:44:33.493 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:44:33.505 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:44:33.517 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:44:33.527 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:44:33.550 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:44:33.649 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:44:33.662 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:44:33.743 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:44:33.751 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:44:33.776 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:44:33.794 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 239.6348ms
2025-08-06 04:44:33.804 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:44:33.810 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 188 application/json; charset=utf-8 316.5176ms
2025-08-06 04:45:10.787 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 04:45:15.881 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:45:15.900 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:45:15.941 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 04:45:16.001 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 04:45:16.094 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 04:45:17.089 +03:00 [INF] Executed DbCommand (120ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:45:17.280 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:45:17.320 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 04:45:18.751 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 04:45:19.009 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 04:45:19.566 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 04:45:19.571 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 04:45:19.583 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 04:45:19.586 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 04:45:19.674 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 04:45:19.741 +03:00 [INF] Server mrrobot:428:f584638a successfully announced in 38.7281 ms
2025-08-06 04:45:20.115 +03:00 [INF] Hosting environment: Development
2025-08-06 04:45:20.207 +03:00 [INF] Server mrrobot:428:f584638a is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 04:45:20.209 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 04:45:20.320 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:45:21.215 +03:00 [INF] Server mrrobot:428:f584638a all the dispatchers started
2025-08-06 04:45:21.817 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:45:21.817 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:45:21.818 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:45:21.827 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1624.6749ms
2025-08-06 04:45:21.902 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 84.6521ms
2025-08-06 04:45:21.910 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 91.4596ms
2025-08-06 04:45:22.038 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 221.2481ms
2025-08-06 04:45:22.171 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:45:22.663 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 491.7982ms
2025-08-06 04:45:46.647 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:45:46.667 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 04:45:47.246 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:45:47.359 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:45:47.467 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:45:47.532 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:45:48.637 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:45:48.649 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:45:48.783 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:45:56.937 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:46:26.360 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 04:46:29.298 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:46:29.330 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:46:29.384 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 04:46:29.433 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 04:46:29.511 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 04:46:30.435 +03:00 [INF] Executed DbCommand (123ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:46:30.555 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:46:30.603 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 04:46:31.973 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 04:46:32.739 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:46:32.884 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 04:46:32.996 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 04:46:33.008 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 04:46:33.015 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 04:46:33.021 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 04:46:33.141 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 04:46:33.146 +03:00 [INF] Hosting environment: Development
2025-08-06 04:46:33.186 +03:00 [INF] Server mrrobot:9696:a58ad2e7 successfully announced in 43.239 ms
2025-08-06 04:46:33.191 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 04:46:33.220 +03:00 [INF] Server mrrobot:9696:a58ad2e7 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 04:46:33.990 +03:00 [INF] Server mrrobot:9696:a58ad2e7 all the dispatchers started
2025-08-06 04:46:34.153 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:46:34.165 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:46:34.166 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:46:34.166 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1472.5113ms
2025-08-06 04:46:34.287 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 121.7115ms
2025-08-06 04:46:34.278 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 125.5966ms
2025-08-06 04:46:34.659 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 493.8946ms
2025-08-06 04:46:34.930 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:46:35.288 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 357.6077ms
2025-08-06 04:46:47.019 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:46:47.038 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 04:46:47.520 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:46:47.607 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:46:47.659 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:46:47.720 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:46:48.598 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:46:48.612 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:46:48.741 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:46:48.763 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:46:48.777 +03:00 [INF] Getting address by ID: 1
2025-08-06 04:46:48.973 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 04:46:49.087 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:46:49.092 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:46:49.123 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:46:49.234 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:46:49.300 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:46:49.381 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 1646.1283ms
2025-08-06 04:46:49.389 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:46:49.405 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 218 application/json; charset=utf-8 2385.7681ms
2025-08-06 04:49:58.224 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 04:50:00.209 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:50:00.230 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:50:00.261 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 04:50:00.286 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 04:50:00.318 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 04:50:00.750 +03:00 [INF] Executed DbCommand (47ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:50:00.842 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:50:00.876 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 04:50:01.474 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 04:50:01.716 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 04:50:01.762 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:50:01.953 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 04:50:02.027 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 04:50:02.030 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 04:50:02.032 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 04:50:02.062 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 04:50:02.064 +03:00 [INF] Hosting environment: Development
2025-08-06 04:50:02.065 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 04:50:02.087 +03:00 [INF] Server mrrobot:17712:137514f2 successfully announced in 20.458 ms
2025-08-06 04:50:02.095 +03:00 [INF] Server mrrobot:17712:137514f2 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 04:50:02.105 +03:00 [INF] 2 servers were removed due to timeout
2025-08-06 04:50:02.197 +03:00 [INF] Server mrrobot:17712:137514f2 all the dispatchers started
2025-08-06 04:50:02.343 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 586.9548ms
2025-08-06 04:50:02.430 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:50:02.505 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:50:02.524 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:50:02.530 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 100.0112ms
2025-08-06 04:50:02.580 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 56.0692ms
2025-08-06 04:50:02.600 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 95.5185ms
2025-08-06 04:50:02.666 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:50:02.898 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 232.0103ms
2025-08-06 04:50:33.259 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:50:33.310 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 50.7334ms
2025-08-06 04:50:33.375 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:50:33.399 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 23.6403ms
2025-08-06 04:50:33.397 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:50:33.399 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:50:33.423 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 25.4602ms
2025-08-06 04:50:33.513 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 113.6435ms
2025-08-06 04:50:33.794 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:50:34.096 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 301.7318ms
2025-08-06 04:50:43.966 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null null
2025-08-06 04:50:43.973 +03:00 [INF] CORS policy execution successful.
2025-08-06 04:50:43.976 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 04:50:44.185 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:50:44.205 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-08-06 04:50:44.218 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-06 04:50:44.225 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 401 0 null 256.1603ms
2025-08-06 04:51:01.052 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:51:01.094 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 41.8594ms
2025-08-06 04:51:01.245 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:51:01.252 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:51:01.252 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.9395ms
2025-08-06 04:51:01.322 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 69.8915ms
2025-08-06 04:51:01.352 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:51:01.359 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.6463ms
2025-08-06 04:51:01.714 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:51:01.924 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 209.7948ms
2025-08-06 04:51:07.591 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:51:07.616 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 24.2673ms
2025-08-06 04:51:07.654 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:51:07.662 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.2472ms
2025-08-06 04:51:07.698 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:51:07.715 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 17.0176ms
2025-08-06 04:51:07.729 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:51:07.735 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.8297ms
2025-08-06 04:51:07.939 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:51:08.083 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 143.9054ms
2025-08-06 04:51:22.803 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart/CheckOut - null null
2025-08-06 04:51:22.965 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:51:23.094 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:51:23.112 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-08-06 04:51:23.115 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-08-06 04:51:23.122 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart/CheckOut - 405 0 null 319.7944ms
2025-08-06 04:51:28.837 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-06 04:51:28.852 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:51:28.978 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:51:28.992 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:51:29.028 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:51:29.753 +03:00 [INF] Executing CheckOut
2025-08-06 04:51:29.763 +03:00 [INF] Checkout of cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:51:29.771 +03:00 [INF] Retrieving cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:51:30.016 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-06 04:51:30.137 +03:00 [INF] Execute Update for entity Cart
2025-08-06 04:51:30.156 +03:00 [INF] Cart marked for update (pending save)
2025-08-06 04:51:30.384 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0, `CreatedAt` = @p1, `CustomerId` = @p2, `DeletedAt` = @p3, `ModifiedAt` = @p4, `UserId` = @p5
WHERE `Id` = @p6;
SELECT ROW_COUNT();
2025-08-06 04:51:30.460 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 04:51:30.534 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 1488.2769ms
2025-08-06 04:51:30.541 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:51:30.550 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 1713.0109ms
2025-08-06 04:51:38.107 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:51:38.118 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:51:38.125 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:51:38.136 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:51:38.161 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:51:38.276 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:51:38.296 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:51:38.367 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:51:38.396 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:51:38.412 +03:00 [INF] Getting address by ID: 1
2025-08-06 04:51:38.453 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 04:51:38.524 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:51:38.535 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:51:38.552 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:51:38.650 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:51:38.710 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:51:38.732 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 565.4206ms
2025-08-06 04:51:38.736 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:51:38.739 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 218 application/json; charset=utf-8 631.6029ms
2025-08-06 04:52:31.609 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 04:52:34.935 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:52:34.955 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 04:52:35.005 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 04:52:35.068 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 04:52:35.179 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 04:52:36.067 +03:00 [INF] Executed DbCommand (156ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:52:36.246 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 04:52:36.287 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 04:52:37.590 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 04:52:38.417 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 04:52:38.535 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 04:52:38.532 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:52:38.618 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 04:52:38.624 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 04:52:38.633 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 04:52:38.752 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 04:52:38.799 +03:00 [INF] Hosting environment: Development
2025-08-06 04:52:38.832 +03:00 [INF] Server mrrobot:2620:993d241c successfully announced in 62.373 ms
2025-08-06 04:52:38.870 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 04:52:38.893 +03:00 [INF] Server mrrobot:2620:993d241c is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 04:52:39.145 +03:00 [INF] 1 servers were removed due to timeout
2025-08-06 04:52:39.855 +03:00 [INF] Server mrrobot:2620:993d241c all the dispatchers started
2025-08-06 04:52:40.069 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:52:40.109 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:52:40.126 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1624.4073ms
2025-08-06 04:52:40.184 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 115.2791ms
2025-08-06 04:52:40.187 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 78.3173ms
2025-08-06 04:52:40.203 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:52:40.387 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 184.664ms
2025-08-06 04:52:40.600 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:52:41.018 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 418.0323ms
2025-08-06 04:52:45.928 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:52:45.941 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 04:52:46.547 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:52:46.671 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:52:46.752 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:52:46.818 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:52:48.009 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:52:48.022 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:52:48.171 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:52:48.205 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:52:48.219 +03:00 [INF] Getting address by ID: 1
2025-08-06 04:52:48.413 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 04:52:48.552 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:52:48.559 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:52:48.578 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:52:48.681 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:52:53.435 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:52:53.523 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 6681.9235ms
2025-08-06 04:52:53.529 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:52:53.622 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 218 application/json; charset=utf-8 7693.4377ms
2025-08-06 04:53:51.462 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:53:51.487 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 24.5036ms
2025-08-06 04:53:51.538 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:53:51.547 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.9404ms
2025-08-06 04:53:51.572 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:53:51.577 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:53:51.590 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.6381ms
2025-08-06 04:53:51.622 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 50.1801ms
2025-08-06 04:53:51.797 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:53:52.107 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 309.6815ms
2025-08-06 04:54:22.799 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-06 04:54:22.809 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:54:22.824 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:54:22.837 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:54:22.860 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:54:22.875 +03:00 [INF] Executing CheckOut
2025-08-06 04:54:22.881 +03:00 [INF] Checkout of cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:54:22.891 +03:00 [INF] Retrieving cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:54:23.053 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-06 04:54:23.433 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-06 04:54:23.478 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 04:54:23.490 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 623.7277ms
2025-08-06 04:54:23.494 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:54:23.497 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 698.8876ms
2025-08-06 04:54:25.859 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:54:25.871 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:54:25.881 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:54:25.888 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:54:25.902 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:54:25.917 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:54:25.920 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:54:25.950 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:54:25.961 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:54:25.971 +03:00 [INF] Getting address by ID: 1
2025-08-06 04:54:25.976 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 04:54:25.986 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:54:25.991 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:54:25.997 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:54:26.020 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:54:30.317 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:54:30.323 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 4413.1649ms
2025-08-06 04:54:30.325 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:54:30.328 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 400 218 application/json; charset=utf-8 4468.8095ms
2025-08-06 04:55:42.170 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-06 04:55:42.183 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:55:42.193 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:55:42.205 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:55:42.211 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:55:42.222 +03:00 [INF] Executing CheckOut
2025-08-06 04:55:42.227 +03:00 [INF] Checkout of cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:55:42.233 +03:00 [INF] Retrieving cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:55:42.290 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-06 04:55:50.292 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-06 04:55:59.025 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 04:55:59.097 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 16877.1489ms
2025-08-06 04:55:59.186 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:55:59.188 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 17018.1926ms
2025-08-06 04:56:07.921 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-06 04:56:07.969 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:56:07.976 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:56:07.987 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:56:07.997 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:56:08.052 +03:00 [INF] Executing GetCart
2025-08-06 04:56:08.055 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:56:08.058 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:56:08.062 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:56:08.064 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:56:08.070 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:56:08.121 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 112.3905ms
2025-08-06 04:56:08.125 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:56:08.128 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 934 application/json; charset=utf-8 207.0906ms
2025-08-06 04:57:39.236 +03:00 [INF] 2 servers were removed due to timeout
2025-08-06 04:58:03.418 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 04:58:03.447 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 29.6738ms
2025-08-06 04:58:03.521 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 04:58:03.529 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.5038ms
2025-08-06 04:58:03.530 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 04:58:03.541 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 04:58:03.563 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 22.0347ms
2025-08-06 04:58:03.574 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 43.7803ms
2025-08-06 04:58:04.568 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-06 04:58:04.607 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:58:04.659 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:58:04.709 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:58:04.749 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:58:04.793 +03:00 [INF] Executing GetCart
2025-08-06 04:58:04.800 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:04.801 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:04.830 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:04.895 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:04.897 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:58:04.899 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 107.3756ms
2025-08-06 04:58:05.232 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:58:05.234 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 934 application/json; charset=utf-8 666.0307ms
2025-08-06 04:58:05.397 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 04:58:05.623 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 226.2727ms
2025-08-06 04:58:08.943 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-06 04:58:08.957 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:58:08.962 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:58:08.975 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:58:08.985 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:58:08.995 +03:00 [INF] Executing CheckOut
2025-08-06 04:58:09.006 +03:00 [INF] Checkout of cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:09.009 +03:00 [INF] Retrieving cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:09.930 +03:00 [INF] Executed DbCommand (914ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-06 04:58:11.908 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-06 04:58:11.961 +03:00 [INF] Removing cache by tag: cart
2025-08-06 04:58:12.058 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 04:58:12.062 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 04:58:12.066 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 3071.4753ms
2025-08-06 04:58:12.077 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 04:58:12.234 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 3291.7896ms
2025-08-06 04:58:18.177 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart/is-empty - null null
2025-08-06 04:58:18.190 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:58:18.197 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:58:18.214 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce)'
2025-08-06 04:58:18.226 +03:00 [INF] Route matched with {action = "IsCartEmpty", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] IsCartEmpty() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:58:18.239 +03:00 [INF] Executing IsCartEmpty
2025-08-06 04:58:18.247 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:58:18.260 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 04:58:18.267 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce) in 32.9019ms
2025-08-06 04:58:18.273 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.IsCartEmpty (E-Commerce)'
2025-08-06 04:58:18.276 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart/is-empty - 200 131 application/json; charset=utf-8 99.2663ms
2025-08-06 04:58:25.881 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-06 04:58:25.890 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:58:25.899 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:58:25.915 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:58:25.916 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 04:58:25.942 +03:00 [INF] Executing GetCart
2025-08-06 04:58:25.945 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:25.956 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:25.974 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:25.985 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 04:58:25.992 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 04:58:26.248 +03:00 [INF] Executed DbCommand (58ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 04:58:26.273 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:26.313 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 04:58:26.319 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:58:26.323 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 384.6953ms
2025-08-06 04:58:26.327 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-06 04:58:26.329 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 960 application/json; charset=utf-8 447.7271ms
2025-08-06 04:58:43.936 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:58:43.941 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:58:43.948 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:58:43.955 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:58:43.975 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:58:43.994 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:58:43.996 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:44.013 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:58:44.025 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:58:44.034 +03:00 [INF] Getting address by ID: 1
2025-08-06 04:58:44.044 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 04:58:44.051 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:44.052 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:44.056 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:44.062 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:51.132 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 04:58:51.150 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 04:58:51.342 +03:00 [INF] Order added successfully (pending save)
2025-08-06 04:58:51.352 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 04:58:51.407 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 04:58:51.412 +03:00 [INF] Clearing cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:58:51.934 +03:00 [ERR] Exception while creating order for user 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
System.InvalidOperationException: The connection is already in a transaction and cannot participate in another transaction.
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.EnsureNoTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(IsolationLevel isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(CancellationToken cancellationToken)
   at UnitOfWork.BeginTransactionAsync()
   at E_Commerce.Services.CartServices.CartServices.ClearCartAsync(String userId)
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto)
2025-08-06 04:58:52.175 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 04:58:52.178 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 8195.4072ms
2025-08-06 04:58:52.181 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:58:52.185 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 8249.1997ms
2025-08-06 04:59:19.680 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 04:59:19.693 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 04:59:19.698 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 04:59:19.707 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 04:59:19.710 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 04:59:19.719 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 04:59:19.723 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:59:19.733 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 04:59:19.751 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 04:59:19.759 +03:00 [INF] Getting address by ID: 1
2025-08-06 04:59:19.766 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 04:59:19.779 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:59:19.783 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:59:19.791 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:59:19.795 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 04:59:32.797 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 04:59:46.632 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 04:59:47.779 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:00:10.968 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:00:10.987 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:00:10.993 +03:00 [INF] Clearing cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:00:11.324 +03:00 [ERR] Exception while creating order for user 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
System.InvalidOperationException: The connection is already in a transaction and cannot participate in another transaction.
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.EnsureNoTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(IsolationLevel isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(CancellationToken cancellationToken)
   at UnitOfWork.BeginTransactionAsync()
   at E_Commerce.Services.CartServices.CartServices.ClearCartAsync(String userId)
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto)
2025-08-06 05:00:11.369 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:00:11.374 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 51655.4616ms
2025-08-06 05:00:11.380 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:00:11.385 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 51705.1731ms
2025-08-06 05:00:44.360 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:00:44.367 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:00:44.377 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:00:44.385 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:00:44.388 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:00:44.395 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:00:44.397 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:00:44.406 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:00:44.415 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:00:44.425 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:00:44.430 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:00:44.443 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:00:44.448 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:00:44.454 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:00:44.459 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:00:46.623 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:00:46.697 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:00:46.707 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:00:59.595 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:01:00.974 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:01:02.997 +03:00 [INF] Clearing cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:01:15.924 +03:00 [ERR] Exception while creating order for user 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
System.InvalidOperationException: The connection is already in a transaction and cannot participate in another transaction.
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.EnsureNoTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(IsolationLevel isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(CancellationToken cancellationToken)
   at UnitOfWork.BeginTransactionAsync()
   at E_Commerce.Services.CartServices.CartServices.ClearCartAsync(String userId)
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto)
2025-08-06 05:01:15.962 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:01:15.967 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 31573.2646ms
2025-08-06 05:01:15.970 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:01:15.974 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 31614.1121ms
2025-08-06 05:02:38.066 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 05:02:38.123 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 56.6994ms
2025-08-06 05:02:38.208 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 05:02:38.215 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 7.08ms
2025-08-06 05:02:38.230 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 05:02:38.236 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 05:02:38.248 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.2215ms
2025-08-06 05:02:38.250 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 19.9698ms
2025-08-06 05:02:39.002 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 05:02:39.204 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 201.6688ms
2025-08-06 05:02:56.871 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:02:56.883 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:02:56.890 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:02:56.900 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:02:56.912 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:02:56.922 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:02:56.937 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:02:56.949 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:02:56.964 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:02:56.971 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:02:56.984 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:02:56.993 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:02:56.999 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:02:57.003 +03:00 [INF] Cache hit for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:02:57.046 +03:00 [INF] Cache hit for cart user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:02:57.052 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:02:57.063 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:02:57.067 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:02:57.072 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:02:57.076 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:02:57.083 +03:00 [INF] Clearing cart: 1
2025-08-06 05:02:57.105 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:02:57.123 +03:00 [INF] Cart 1 cleared successfully
2025-08-06 05:02:57.126 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:02:57.134 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:02:57.140 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:02:57.146 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:02:57.190 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:02:57.193 +03:00 [INF] Initiating Paymob payment for order: 0
2025-08-06 05:02:57.204 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:02:58.175 +03:00 [INF] Return token
2025-08-06 05:02:58.636 +03:00 [ERR] Exception while creating order for user 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
System.InvalidOperationException: An invalid request URI was provided. Either the request URI must be an absolute URI or BaseAddress must be set.
   at System.Net.Http.HttpClient.PrepareRequestMessage(HttpRequestMessage request)
   at System.Net.Http.HttpClient.SendAsync(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationToken cancellationToken)
   at E_Commerce.Services.PayMobServices.PayMobServices.CreateOrderInPaymobAsync(CreateOrderRequest order)
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto)
2025-08-06 05:02:58.679 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:02:58.684 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 1764.2455ms
2025-08-06 05:02:58.688 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:02:58.694 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 1822.9691ms
2025-08-06 05:04:33.959 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 05:04:33.998 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 38.9807ms
2025-08-06 05:04:34.137 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 05:04:34.139 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 05:04:34.142 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 5.2535ms
2025-08-06 05:04:34.143 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 05:04:34.157 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 17.9134ms
2025-08-06 05:04:34.167 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 24.6198ms
2025-08-06 05:04:34.915 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 05:04:35.105 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 190.4678ms
2025-08-06 05:04:42.829 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:04:42.855 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:04:42.940 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:04:42.946 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:04:42.955 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:04:42.960 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:04:42.975 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:04:42.986 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:04:42.996 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:04:43.003 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:04:43.007 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:04:43.043 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:04:43.044 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:04:43.047 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:04:43.053 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:04:43.129 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:04:43.489 +03:00 [INF] Executed DbCommand (113ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:04:43.500 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:04:43.633 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 05:04:44.356 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:04:44.362 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:04:44.364 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:04:44.376 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:04:44.378 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:04:44.379 +03:00 [INF] Clearing cart: 1
2025-08-06 05:04:44.387 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:04:44.393 +03:00 [INF] Cart 1 cleared successfully
2025-08-06 05:04:44.394 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:04:44.403 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:04:44.645 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (DbType = Int32), @p14='?' (Size = 255), @p15='?' (DbType = DateTime), @p16='?' (DbType = DateTime), @p17='?' (DbType = Decimal), @p18='?' (DbType = DateTime), @p19='?' (Size = 500), @p20='?' (Size = 50), @p21='?' (DbType = DateTime), @p22='?' (DbType = Decimal), @p23='?' (DbType = Int32), @p24='?' (DbType = Decimal), @p25='?' (DbType = Decimal), @p26='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:04:44.760 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`orderitem`, CONSTRAINT `FK_OrderItem_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.NextResultAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 90
   at MySqlConnector.MySqlDataReader.NextResultAsync(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 49
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`orderitem`, CONSTRAINT `FK_OrderItem_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.NextResultAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 90
   at MySqlConnector.MySqlDataReader.NextResultAsync(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 49
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-06 05:04:46.961 +03:00 [ERR] Exception while creating order for user 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails (`fashion_site`.`orderitem`, CONSTRAINT `FK_OrderItem_Orders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.NextResultAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 90
   at MySqlConnector.MySqlDataReader.NextResultAsync(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 49
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync()
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto)
2025-08-06 05:04:47.071 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:04:47.075 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 4116.4874ms
2025-08-06 05:04:47.077 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:04:47.079 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 4249.9852ms
2025-08-06 05:07:08.731 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 05:07:10.900 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 05:07:10.919 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 05:07:10.955 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 05:07:10.986 +03:00 [INF] Applying migration '20250806020622_last-update-today'.
2025-08-06 05:07:11.142 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20250806020622_last-update-today', '8.0.13');
2025-08-06 05:07:11.181 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 05:07:11.678 +03:00 [INF] Executed DbCommand (68ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 05:07:11.804 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 05:07:11.839 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 05:07:12.608 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 05:07:12.718 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 05:07:12.768 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 05:07:12.771 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 05:07:12.773 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 05:07:12.776 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 05:07:12.803 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 05:07:12.805 +03:00 [INF] Hosting environment: Development
2025-08-06 05:07:12.809 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 05:07:12.835 +03:00 [INF] Server mrrobot:7540:1ba136a1 successfully announced in 19.5117 ms
2025-08-06 05:07:12.847 +03:00 [INF] Server mrrobot:7540:1ba136a1 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 05:07:12.915 +03:00 [INF] Server mrrobot:7540:1ba136a1 all the dispatchers started
2025-08-06 05:07:13.196 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 05:07:13.691 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 464.5542ms
2025-08-06 05:07:13.691 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 05:07:13.692 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 05:07:13.728 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 05:07:13.733 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 42.0902ms
2025-08-06 05:07:13.737 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 45.2181ms
2025-08-06 05:07:13.833 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 104.6869ms
2025-08-06 05:07:13.894 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 05:07:14.352 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 458.5232ms
2025-08-06 05:07:17.647 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:07:17.659 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 05:07:17.949 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:07:18.040 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:07:18.068 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:07:18.111 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:07:19.181 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:07:19.194 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:07:19.281 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:07:19.337 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:07:19.357 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:07:19.535 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:07:19.681 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:07:19.698 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:07:19.718 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:07:19.729 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:07:19.740 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:07:20.101 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:07:20.301 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:07:20.457 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 05:07:20.483 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:07:20.525 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:07:20.849 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:07:21.313 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:07:21.399 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:07:21.466 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:07:21.474 +03:00 [INF] Clearing cart: 1
2025-08-06 05:07:21.492 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:07:21.554 +03:00 [INF] Cart 1 cleared successfully
2025-08-06 05:07:21.558 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:07:21.578 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:07:21.662 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:07:21.727 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:07:21.733 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:07:21.785 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:07:21.788 +03:00 [INF] Initiating Paymob payment for order: 1
2025-08-06 05:07:21.795 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:07:22.822 +03:00 [INF] Return token
2025-08-06 05:07:22.853 +03:00 [ERR] Exception while creating order for user 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
System.InvalidOperationException: An invalid request URI was provided. Either the request URI must be an absolute URI or BaseAddress must be set.
   at System.Net.Http.HttpClient.PrepareRequestMessage(HttpRequestMessage request)
   at System.Net.Http.HttpClient.SendAsync(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationToken cancellationToken)
   at E_Commerce.Services.PayMobServices.PayMobServices.CreateOrderInPaymobAsync(CreateOrderRequest order) in D:\project_fashion\E-Commerce-API-main\Services\PayMobServices\PayMobServices.cs:line 66
   at E_Commerce.Services.Order.OrderServices.CreateOrderFromCartAsync(String userId, CreateOrderDto orderDto) in D:\project_fashion\E-Commerce-API-main\Services\OrderServices\OrderServices.cs:line 359
2025-08-06 05:07:23.105 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:07:23.155 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 5031.4314ms
2025-08-06 05:07:23.160 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:07:23.192 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 246 application/json; charset=utf-8 5543.9577ms
2025-08-06 05:12:10.772 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 05:12:12.864 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 05:12:12.894 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 05:12:12.948 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 05:12:12.982 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 05:12:13.015 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 05:12:13.489 +03:00 [INF] Executed DbCommand (58ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 05:12:13.597 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 05:12:13.635 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 05:12:14.281 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 05:12:14.449 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 05:12:14.464 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 05:12:14.468 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 05:12:14.469 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 05:12:14.473 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 05:12:14.502 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 05:12:14.505 +03:00 [INF] Hosting environment: Development
2025-08-06 05:12:14.508 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 05:12:14.529 +03:00 [INF] Server mrrobot:23676:44d462b7 successfully announced in 24.3542 ms
2025-08-06 05:12:14.552 +03:00 [INF] Server mrrobot:23676:44d462b7 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 05:12:14.600 +03:00 [INF] 1 servers were removed due to timeout
2025-08-06 05:12:14.677 +03:00 [INF] Server mrrobot:23676:44d462b7 all the dispatchers started
2025-08-06 05:12:18.646 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:12:18.905 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 05:12:19.907 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:12:20.116 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:12:20.206 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:12:20.265 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:12:21.216 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:12:21.235 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:12:21.350 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:12:21.381 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:12:21.421 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:12:21.642 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:12:21.793 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:12:21.799 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:12:21.816 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:12:21.825 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:12:21.873 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:12:22.289 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:12:22.333 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:12:22.464 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 05:12:22.488 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:12:22.504 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:12:22.703 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:12:23.072 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:12:23.153 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:12:23.222 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:12:23.230 +03:00 [INF] Clearing cart: 1
2025-08-06 05:12:23.249 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:12:23.306 +03:00 [INF] Cart 1 cleared successfully
2025-08-06 05:12:23.313 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:12:23.333 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:12:23.432 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:12:23.483 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:12:23.487 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:12:23.555 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:12:23.558 +03:00 [INF] Initiating Paymob payment for order: 2
2025-08-06 05:12:23.567 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:12:24.735 +03:00 [INF] Return token
2025-08-06 05:12:25.535 +03:00 [ERR] Failed to create order in Paymob
2025-08-06 05:12:25.640 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:12:25.823 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 5546.2302ms
2025-08-06 05:12:25.871 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:12:25.887 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 7244.3937ms
2025-08-06 05:14:05.713 +03:00 [INF] DB tables already exist. Exit install
2025-08-06 05:14:09.359 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 05:14:09.398 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-06 05:14:09.448 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-06 05:14:09.498 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-06 05:14:09.541 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-06 05:14:10.323 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 05:14:10.568 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-06 05:14:10.707 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 05:14:13.152 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-06 05:14:14.441 +03:00 [ERR] Index was outside the bounds of the array.
System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at Hangfire.MySql.MySqlStorage.<>c.<ToString>b__14_1(String[] x)
   at System.Linq.Enumerable.ArraySelectIterator`2.MoveNext()
   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)
   at Hangfire.MySql.MySqlStorage.ToString()
2025-08-06 05:14:14.439 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 05:14:14.808 +03:00 [INF] Starting Hangfire Server using job storage: '<Connection string can not be parsed>'
2025-08-06 05:14:14.814 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-06 05:14:15.025 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-06 05:14:15.107 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-06 05:14:15.459 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-06 05:14:15.587 +03:00 [INF] Server mrrobot:21680:facc3fab successfully announced in 127.0767 ms
2025-08-06 05:14:15.613 +03:00 [INF] Hosting environment: Development
2025-08-06 05:14:15.644 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-06 05:14:15.662 +03:00 [INF] Server mrrobot:21680:facc3fab is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-06 05:14:16.653 +03:00 [INF] Server mrrobot:21680:facc3fab all the dispatchers started
2025-08-06 05:14:17.260 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 05:14:17.414 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 05:14:17.462 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 3082.9275ms
2025-08-06 05:14:17.692 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 431.9965ms
2025-08-06 05:14:18.108 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 750.9529ms
2025-08-06 05:14:18.124 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 05:14:18.249 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 124.9506ms
2025-08-06 05:14:19.896 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 05:14:20.559 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 663.0383ms
2025-08-06 05:14:37.678 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:14:37.721 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-06 05:14:39.540 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:14:39.808 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:14:40.071 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:14:40.254 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:14:41.765 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:14:41.783 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:14:42.008 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:14:42.039 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:14:42.051 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:14:42.322 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:14:42.507 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:14:42.513 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:14:42.542 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:14:42.555 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:14:42.563 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:14:43.021 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:14:43.078 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:14:43.262 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 05:14:43.283 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:14:43.311 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:14:43.772 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:14:44.376 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:14:44.507 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:14:44.590 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:14:44.595 +03:00 [INF] Clearing cart: 1
2025-08-06 05:14:44.620 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:14:44.693 +03:00 [INF] Cart 1 cleared successfully
2025-08-06 05:14:44.697 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:14:44.742 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:14:44.878 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:14:44.942 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:14:44.946 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:14:45.028 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:14:45.035 +03:00 [INF] Initiating Paymob payment for order: 3
2025-08-06 05:14:45.041 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:14:45.952 +03:00 [INF] Return token
2025-08-06 05:15:06.160 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 366423012, Amount: 160000
2025-08-06 05:15:07.082 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-06 05:15:07.556 +03:00 [ERR] Failed to get payment key from Paymob. Status: "BadRequest", Response: {"billing_data":{"first_name":["This field may not be blank."]}}
2025-08-06 05:15:08.282 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 05:15:08.349 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 66.5358ms
2025-08-06 05:15:08.374 +03:00 [ERR] Failed to generate payment key from Paymob
2025-08-06 05:15:08.620 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:15:08.989 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 28601.1755ms
2025-08-06 05:15:09.274 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:15:09.317 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 31638.271ms
2025-08-06 05:15:09.612 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 05:15:09.652 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 40.3971ms
2025-08-06 05:15:09.820 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 05:15:09.945 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 120.266ms
2025-08-06 05:15:10.182 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 05:15:10.212 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 29.7781ms
2025-08-06 05:15:11.319 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:15:11.392 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:15:11.440 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:15:11.465 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:15:11.472 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:15:11.530 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:15:11.533 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:15:11.613 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:15:11.644 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:15:11.648 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:15:11.665 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:15:11.698 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:15:11.699 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:15:11.716 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:15:11.762 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:15:11.777 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:15:11.948 +03:00 [INF] Executed DbCommand (161ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:15:12.145 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:15:12.165 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 05:15:12.181 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:15:12.197 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:15:12.204 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:15:12.219 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:15:12.234 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:15:12.245 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:15:12.249 +03:00 [INF] Clearing cart: 1
2025-08-06 05:15:12.260 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:15:12.272 +03:00 [INF] Cart 1 cleared successfully
2025-08-06 05:15:12.281 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:15:12.300 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:15:12.431 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:15:12.471 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:15:12.490 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:15:12.510 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:15:12.513 +03:00 [INF] Initiating Paymob payment for order: 4
2025-08-06 05:15:12.524 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:15:13.213 +03:00 [INF] Return token
2025-08-06 05:15:21.793 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 05:15:22.707 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 366423086, Amount: 160000
2025-08-06 05:15:24.127 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 2333.6655ms
2025-08-06 05:15:24.625 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-06 05:15:24.630 +03:00 [ERR] Failed to get payment key from Paymob. Status: "BadRequest", Response: {"billing_data":{"first_name":["This field may not be blank."]}}
2025-08-06 05:15:24.731 +03:00 [ERR] Failed to generate payment key from Paymob
2025-08-06 05:15:24.737 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:15:24.742 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 13263.057ms
2025-08-06 05:15:24.745 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:15:24.749 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 13430.2804ms
2025-08-06 05:16:25.727 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:16:25.757 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:16:25.769 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:16:25.784 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:16:25.803 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:16:25.881 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:16:25.885 +03:00 [INF] Creating order from cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:16:25.905 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:16:25.916 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:16:25.932 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:16:25.942 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:16:25.954 +03:00 [INF] Getting cart for user: 5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:16:25.959 +03:00 [INF] Getting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:16:25.966 +03:00 [WRN] Cache miss for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:16:25.973 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:16:25.985 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:16:26.045 +03:00 [INF] Executed DbCommand (47ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:16:26.073 +03:00 [INF] Setting cache for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32
2025-08-06 05:16:26.116 +03:00 [INF] Cache set successfully for key: cart_user_5159b4b3-dbf3-4369-b2c5-e2cff9cf0f32 with tags: [cart]
2025-08-06 05:16:26.123 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:16:26.128 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:16:26.130 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:16:26.142 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:16:26.162 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:16:26.173 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:16:26.176 +03:00 [INF] Clearing cart: 1
2025-08-06 05:16:26.181 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:16:26.200 +03:00 [INF] Cart 1 cleared successfully
2025-08-06 05:16:26.207 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:16:26.212 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:16:26.219 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:16:26.235 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:16:26.237 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:16:26.241 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:16:26.244 +03:00 [INF] Initiating Paymob payment for order: 5
2025-08-06 05:16:26.247 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:16:27.218 +03:00 [INF] Return token
2025-08-06 05:17:15.818 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 366423238, Amount: 160000
2025-08-06 05:17:16.417 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-06 05:17:16.423 +03:00 [ERR] Failed to get payment key from Paymob. Status: "BadRequest", Response: {"billing_data":{"first_name":["This field may not be blank."]}}
2025-08-06 05:17:16.457 +03:00 [ERR] Failed to generate payment key from Paymob
2025-08-06 05:17:16.468 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:17:16.477 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 50649.5047ms
2025-08-06 05:17:16.569 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:17:16.573 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 50847.0334ms
2025-08-06 05:18:20.860 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json-patch+json 68
2025-08-06 05:18:20.915 +03:00 [INF] CORS policy execution successful.
2025-08-06 05:18:20.934 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:18:20.943 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-06 05:18:20.961 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-06 05:18:21.028 +03:00 [INF] In LoginAsync Method 
2025-08-06 05:18:21.046 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 05:18:21.064 +03:00 [WRN] Login failed: Email not found.
2025-08-06 05:18:21.183 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:18:21.210 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 235.2062ms
2025-08-06 05:18:21.217 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-06 05:18:21.220 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 401 653 application/json; charset=utf-8 360.8562ms
2025-08-06 05:18:48.005 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json-patch+json 66
2025-08-06 05:18:48.021 +03:00 [INF] CORS policy execution successful.
2025-08-06 05:18:48.037 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:18:48.136 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-06 05:18:48.144 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-06 05:18:48.152 +03:00 [INF] In LoginAsync Method 
2025-08-06 05:18:48.181 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-06 05:18:48.614 +03:00 [INF] 🔐 Generating Access Token for User ID: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:18:48.670 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-08-06 05:18:48.709 +03:00 [INF] ✅ Access Token generated successfully for User ID: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:18:48.718 +03:00 [INF] 🔑 Generating Refresh Token for User ID: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:18:48.724 +03:00 [INF] RefreshToken Generated
2025-08-06 05:18:48.735 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:18:48.745 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 594.7957ms
2025-08-06 05:18:48.750 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-06 05:18:48.753 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 200 1402 application/json; charset=utf-8 748.5414ms
2025-08-06 05:19:15.846 +03:00 [INF] 2 servers were removed due to timeout
2025-08-06 05:20:12.704 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/CustomerAddress - application/json 257
2025-08-06 05:20:12.729 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:20:12.756 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:20:12.766 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce)'
2025-08-06 05:20:12.786 +03:00 [INF] Route matched with {action = "CreateAddress", controller = "CustomerAddress"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CustomerAddressDtos.CustomerAddressDto]]] CreateAddress(E_Commerce.DtoModels.CustomerAddressDtos.CreateCustomerAddressDto) on controller E_Commerce.Controllers.CustomerAddressController (E-Commerce).
2025-08-06 05:20:12.864 +03:00 [INF] Executing CreateAddress
2025-08-06 05:20:12.871 +03:00 [INF] Creating new address for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:12.883 +03:00 [INF] Getting address count for customer: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:12.914 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__customerId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `CustomerAddresses` AS `c`
WHERE (`c`.`CustomerId` = @__customerId_0) AND `c`.`DeletedAt` IS NULL
2025-08-06 05:20:12.978 +03:00 [INF] Executing CreateAsync for entity CustomerAddress
2025-08-06 05:20:12.981 +03:00 [INF] CustomerAddress added successfully (pending save)
2025-08-06 05:20:12.989 +03:00 [INF] Removing default from other addresses for customer: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:13.010 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__customerId_0='?' (Size = 255), @__excludeAddressId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`
FROM `CustomerAddresses` AS `c`
WHERE (((`c`.`CustomerId` = @__customerId_0) AND (`c`.`Id` <> @__excludeAddressId_1)) AND `c`.`IsDefault`) AND `c`.`DeletedAt` IS NULL
2025-08-06 05:20:13.031 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-06 05:20:13.040 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-06 05:20:13.122 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-06 05:20:13.212 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (Size = 20), @p2='?' (Size = 50), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 255), @p6='?' (DbType = DateTime), @p7='?' (DbType = Boolean), @p8='?' (DbType = DateTime), @p9='?' (Size = 20), @p10='?' (Size = 20), @p11='?' (Size = 50), @p12='?' (Size = 200), @p13='?' (Size = 255), @p14='?' (DbType = DateTime), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime), @p19='?' (DbType = Int32), @p20='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CustomerAddresses` (`AdditionalNotes`, `AddressType`, `City`, `Country`, `CreatedAt`, `CustomerId`, `DeletedAt`, `IsDefault`, `ModifiedAt`, `PhoneNumber`, `PostalCode`, `State`, `StreetAddress`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `Id`
FROM `CustomerAddresses`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:20:13.279 +03:00 [INF] Removing cache by tag: customer_address
2025-08-06 05:20:13.283 +03:00 [WRN] No cache entries found for tag: customer_address
2025-08-06 05:20:13.305 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CustomerAddressDtos.CustomerAddressDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:20:13.363 +03:00 [INF] Executed action E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce) in 573.1506ms
2025-08-06 05:20:13.372 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CustomerAddressController.CreateAddress (E-Commerce)'
2025-08-06 05:20:13.376 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/CustomerAddress - 201 572 application/json; charset=utf-8 671.6766ms
2025-08-06 05:20:35.896 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 63
2025-08-06 05:20:35.904 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:20:35.921 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:20:35.936 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-06 05:20:35.949 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 05:20:35.979 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-06 05:20:36.017 +03:00 [INF] Adding item to cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2, product: 1
2025-08-06 05:20:36.029 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:20:36.041 +03:00 [INF] Execute GetAll for entity Product
2025-08-06 05:20:36.110 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`ImageId`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`, `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Products` AS `p`
LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
LIMIT 1
2025-08-06 05:20:36.257 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-06 05:20:36.270 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-06 05:20:36.346 +03:00 [INF] Retrieving cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:36.479 +03:00 [INF] Executed DbCommand (57ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-06 05:20:36.499 +03:00 [INF] Executing CreateAsync for entity Cart
2025-08-06 05:20:36.549 +03:00 [INF] Cart added successfully (pending save)
2025-08-06 05:20:36.696 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Cart` (`CheckoutDate`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT `Id`
FROM `Cart`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:20:36.716 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-06 05:20:36.738 +03:00 [INF] CartItem added successfully (pending save)
2025-08-06 05:20:36.742 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-06 05:20:36.750 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-06 05:20:36.762 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-06 05:20:36.808 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:20:36.900 +03:00 [INF] Removing cache for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:36.906 +03:00 [INF] Cache removed successfully for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:36.910 +03:00 [INF] Item added to cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2, product: 1
2025-08-06 05:20:36.923 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 05:20:36.933 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 974.7251ms
2025-08-06 05:20:36.938 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-06 05:20:36.943 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 1047.0001ms
2025-08-06 05:20:50.085 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - null 0
2025-08-06 05:20:50.094 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:20:50.110 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:20:50.118 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 05:20:50.175 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-06 05:20:50.276 +03:00 [INF] Executing CheckOut
2025-08-06 05:20:50.297 +03:00 [INF] Checkout of cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:50.305 +03:00 [INF] Retrieving cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:20:50.507 +03:00 [INF] Executed DbCommand (195ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-06 05:20:53.134 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-06 05:20:53.220 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:20:53.289 +03:00 [WRN] No cache entries found for tag: cart
2025-08-06 05:20:53.292 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-06 05:20:53.307 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 3049.2126ms
2025-08-06 05:20:53.364 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-06 05:20:53.384 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Cart/CheckOut - 200 122 application/json; charset=utf-8 3298.9307ms
2025-08-06 05:21:07.203 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:21:07.237 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:21:07.268 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:21:07.300 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Customer|Admin)
2025-08-06 05:21:07.324 +03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2025-08-06 05:21:07.331 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 403 0 null 127.7825ms
2025-08-06 05:21:53.717 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:21:53.969 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:21:53.975 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:21:54.002 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:21:54.025 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:21:54.075 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:21:54.076 +03:00 [INF] Creating order from cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:21:54.135 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:21:54.608 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:21:54.977 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:21:55.017 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:21:55.055 +03:00 [INF] Getting cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:21:55.059 +03:00 [INF] Getting cache for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:21:55.073 +03:00 [WRN] Cache miss for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:21:55.093 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:21:55.108 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:21:55.323 +03:00 [INF] Executed DbCommand (191ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:21:55.519 +03:00 [INF] Setting cache for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:21:55.675 +03:00 [INF] Cache set successfully for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2 with tags: [cart]
2025-08-06 05:21:55.701 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:21:55.725 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:21:55.727 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:21:55.818 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:21:55.852 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:21:55.929 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:21:55.953 +03:00 [INF] Clearing cart: 2
2025-08-06 05:21:55.972 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:21:55.987 +03:00 [INF] Cart 2 cleared successfully
2025-08-06 05:21:55.989 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:21:55.993 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:21:56.010 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:21:56.060 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:21:56.070 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:21:56.084 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:21:56.088 +03:00 [INF] Initiating Paymob payment for order: 6
2025-08-06 05:21:56.092 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:21:56.892 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 05:21:56.958 +03:00 [INF] Return token
2025-08-06 05:21:57.073 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 181.2957ms
2025-08-06 05:22:08.355 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 366423948, Amount: 160000
2025-08-06 05:22:08.355 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 05:22:08.361 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 05:22:12.715 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-06 05:22:13.804 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5443.2867ms
2025-08-06 05:22:13.828 +03:00 [ERR] Failed to get payment key from Paymob. Status: "Unauthorized", Response: {"message": "unrelated payment integration"}
2025-08-06 05:22:08.355 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 05:22:13.805 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 5449.5894ms
2025-08-06 05:22:14.206 +03:00 [ERR] Failed to generate payment key from Paymob
2025-08-06 05:22:14.524 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6169.0111ms
2025-08-06 05:22:14.589 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:22:15.022 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 20965.0957ms
2025-08-06 05:22:15.024 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:22:15.026 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 21309.903ms
2025-08-06 05:22:19.512 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-06 05:22:19.829 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 317.6282ms
2025-08-06 05:24:24.398 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json 44
2025-08-06 05:24:26.721 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-06 05:24:27.107 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-06 05:24:27.624 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:24:27.645 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-06 05:24:27.669 +03:00 [INF] Executing CreateOrderFromCart
2025-08-06 05:24:27.694 +03:00 [INF] Creating order from cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:24:27.716 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-06 05:24:27.742 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE `c`.`UserId` = @__userId_0)
2025-08-06 05:24:27.762 +03:00 [INF] Getting address by ID: 1
2025-08-06 05:24:27.777 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`ImageId`, `t`.`LastVisit`, `t`.`Name`, `t`.`ProfilePicture`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`, `a`.`ProfilePicture`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-06 05:24:27.826 +03:00 [INF] Getting cart for user: 0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:24:27.830 +03:00 [INF] Getting cache for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:24:27.837 +03:00 [WRN] Cache miss for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:24:27.852 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-06 05:24:27.873 +03:00 [INF] Execute GetAll for entity Cart
2025-08-06 05:24:28.048 +03:00 [INF] Executed DbCommand (150ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, (
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-06 05:24:28.556 +03:00 [INF] Setting cache for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2
2025-08-06 05:24:28.690 +03:00 [INF] Cache set successfully for key: cart_user_0a387eaa-bb75-4ab3-a8b4-24f00c4066b2 with tags: [cart]
2025-08-06 05:24:28.798 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-06 05:24:28.808 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-06 05:24:28.811 +03:00 [INF] Order added successfully (pending save)
2025-08-06 05:24:28.831 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:24:29.102 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-06 05:24:29.106 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-06 05:24:29.158 +03:00 [INF] Clearing cart: 2
2025-08-06 05:24:29.171 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-06 05:24:29.248 +03:00 [INF] Cart 2 cleared successfully
2025-08-06 05:24:29.252 +03:00 [INF] Removing cache by tag: cart
2025-08-06 05:24:29.629 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-06 05:24:29.875 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:24:30.535 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-06 05:24:30.803 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-06 05:24:30.806 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-06 05:24:30.864 +03:00 [INF] Initiating Paymob payment for order: 7
2025-08-06 05:24:30.995 +03:00 [INF] Execute System.Func`1[System.Threading.Tasks.Task`1[System.String]]
2025-08-06 05:24:31.809 +03:00 [INF] Return token
2025-08-06 05:24:32.459 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 366424257, Amount: 160000
2025-08-06 05:24:34.426 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-06 05:24:34.678 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-06 05:24:34.812 +03:00 [INF] Payment key generated successfully for Order ID: 366424257
2025-08-06 05:24:34.826 +03:00 [INF] Payment Key generated successfully for Paymob order: 366424257
2025-08-06 05:24:35.042 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-06 05:24:35.212 +03:00 [INF] Getting order by ID: 7
2025-08-06 05:24:35.790 +03:00 [INF] Executed DbCommand (263ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`ApiEndpoint`, `t0`.`PublicKey`, `t0`.`IsActive`, `t0`.`DeletedAt`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p1`.`ApiEndpoint`, `p1`.`PublicKey`, `p1`.`IsActive`, `p`.`DeletedAt`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-06 05:24:36.511 +03:00 [INF] Removing cache by tag: order
2025-08-06 05:24:36.695 +03:00 [WRN] No cache entries found for tag: order
2025-08-06 05:24:36.762 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-06 05:24:37.490 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 9829.3682ms
2025-08-06 05:24:37.774 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-06 05:24:37.779 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 2472 application/json; charset=utf-8 13501.7106ms
2025-08-06 05:27:42.026 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-06 05:27:42.200 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 174.2133ms
2025-08-06 05:27:42.526 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-06 05:27:42.274 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-06 05:27:43.571 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-06 05:27:43.628 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 1102.2275ms
2025-08-06 05:27:43.652 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 1377.6117ms
2025-08-06 05:27:43.676 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 104.8709ms
